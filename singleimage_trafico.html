<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creativos Orange Vapor - Campa√±as de Tr√°fico Ads</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Estilos generales */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Montserrat', sans-serif; background-color: #f5f5f5; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; background-color: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); }

        /* Header, Tabs, Toggles (sin cambios significativos) */
        .header { text-align: center; margin-bottom: 20px; }
        .header h1 { font-size: 26px; color: #2c2c2c; margin-bottom: 8px; }
        .header p { color: #666; font-size: 15px; }
        .tabs { display: flex; justify-content: center; flex-wrap: wrap; margin-bottom: 20px; }
        .tab-group { display: inline-flex; border-radius: 6px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); margin-bottom: 10px; }
        .tab-button { padding: 8px 14px; font-size: 13px; font-weight: 500; background-color: white; color: #333; border: 1px solid #ddd; cursor: pointer; transition: all 0.2s ease; white-space: nowrap; }
        .tab-button:first-child { border-top-left-radius: 6px; border-bottom-left-radius: 6px; }
        .tab-button:last-child { border-top-right-radius: 6px; border-bottom-right-radius: 6px; }
        .tab-button.active { color: white; }
        .tab-button.optimizacion.active { background-color: #dc3545; border-color: #dc3545; }
        .tab-button.meta.active { background-color: #1877F2; border-color: #1877F2; }
        .tab-button.google.active { background-color: #4285F4; border-color: #4285F4; }
        .tab-button.email.active { background-color: #00829b; border-color: #00829b; }
        .tab-button.chatbot.active { background-color: #6f42c1; border-color: #6f42c1; }
        .tab-button.all.active { background-color: #333333; border-color: #333333; }
        .tab-button.auditoria.active { background-color: #28a745; border-color: #28a745; }

        .color-toggle { text-align: center; margin: 15px 0; }
        .color-btn { width: 32px; height: 32px; border-radius: 50%; margin: 0 4px; cursor: pointer; display: inline-block; border: 2px solid #ddd; transition: all 0.2s ease; overflow: hidden; vertical-align: middle;}
        .color-btn.active { border-color: #ff7e00; transform: scale(1.15); }
        .color-btn-original { background: linear-gradient(135deg, #28a745 14%, #dc3545 14% 28%, #1877F2 28% 42%, #4285F4 42% 56%, #00829b 56% 70%, #6f42c1 70% 84%, #333 84%); }
        .color-btn-orange { background-color: #ff7e00; }
        .color-btn-white { background-color: #ffffff; border: 2px solid #ccc; }
        .color-btn-black { background-color: #181818; }

        .download-section { text-align: center; margin: 20px 0; }
        .download-btn { background: #ff7e00; color: white; border: none; padding: 10px 20px; font-size: 15px; font-weight: bold; border-radius: 6px; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; box-shadow: 0 3px 6px rgba(255, 126, 0, 0.3); transition: all 0.3s ease; }
        .download-btn:hover { background: #e67300; transform: translateY(-1px); }

        /* Creatives Area */
        .creatives-container { display: flex; flex-wrap: wrap; justify-content: center; margin-top: 10px; gap: 15px;}
        .creative {
            width: 360px; height: 360px; position: relative;
            border-radius: 8px; overflow: hidden; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            color: white; cursor: pointer; background-color: #eee; /* Placeholder bg */
        }
        .creative-vertical { width: 240px; height: 427px; }

        /* Banner Superior */
        .creative-service-banner {
            position: absolute; top: 0; left: 0; width: 100%; height: 35px; /* M√°s delgado */
            background-color: #333; color: white; display: flex;
            align-items: center; justify-content: center; font-size: 13px; /* Un poco m√°s peque√±o */
            font-weight: 700; /* M√°s bold */
            z-index: 5; text-transform: uppercase; letter-spacing: 0.5px;
        }

        /* Contenido Principal */
        .creative-content {
            position: relative; z-index: 2; padding: 15px;
            padding-top: 55px; /* Espacio banner(35) + logo(12) + margen(8) */
            height: 100%; display: flex; flex-direction: column;
            justify-content: center; text-align: center;
        }
        /* Zona Segura Preview Vertical */
        .creative-vertical .creative-content {
             /* Empujar contenido principal hacia abajo para margen superior */
            padding-top: 15%; /* % relativo a la altura del contenedor */
            padding-bottom: 10%;
            justify-content: center;
        }

        /* Textos */
        .creative-title { font-size: 20px; font-weight: 800; margin-bottom: 10px; line-height: 1.2; }
        .creative-subtitle { font-size: 16px; font-weight: 600; margin-bottom: 10px; line-height: 1.2; }
        .creative-description { font-size: 12px; line-height: 1.4; }

        /* Logo */
        .logo-container {
            position: absolute;
            top: 43px; /* Justo debajo del banner + peque√±o margen */
            left: 15px;
            z-index: 20; text-align: left;
        }
        .logo-container div { font-size: 11px !important; font-weight: bold; }
        /* Logo en Vertical - Asegurar que respeta margen superior visual */
        .creative-vertical .logo-container {
            top: calc(14% + 10px); /* Posicionar relativo al margen superior visual + espacio */
            /* Alternativa: top: 60px; // Posici√≥n fija si padding funciona bien */
        }


        /* Acento lateral */
        .creative-accent { position: absolute; left: 0; top: 50%; transform: translateY(-50%); width: 5px; height: 60px; background: white; border-radius: 0 2px 2px 0; z-index: 10; }
        .creative-vertical .creative-accent { height: 80px; }

        /* Bot√≥n descarga overlay */
        .creative-download { position: absolute; top: 5px; right: 5px; width: 28px; height: 28px; border-radius: 50%; background: rgba(0, 0, 0, 0.6); display: flex; align-items: center; justify-content: center; cursor: pointer; opacity: 0; transition: opacity 0.3s; z-index: 30; }
        .creative-download i { font-size: 12px; color: white;}
        .creative:hover .creative-download { opacity: 1; }

        /* Info box, Note, etc. (sin cambios visuales mayores) */
        .info-box { background-color: #e6f7ff; border-left: 4px solid #1890ff; padding: 12px 15px; margin: 20px auto; max-width: 800px; border-radius: 4px; display: flex; align-items: flex-start; gap: 10px;}
        .info-box i { color: #1890ff; font-size: 18px; margin-top: 1px; flex-shrink: 0;}
        .info-box p { color: #333; font-size: 13px; margin: 0; line-height: 1.5; }
        .info-box strong { font-weight: 600; }
        .info-box .fas.fa-download { font-size: 1em; vertical-align: middle; } /* Icono inline */

        .format-toggle { text-align: center; margin: 15px 0; }
        .format-btn { padding: 7px 14px; font-size: 13px; border: 1px solid #ddd; border-radius: 4px; background-color: white; margin: 0 4px; cursor: pointer; transition: all 0.2s ease; vertical-align: middle;}
        .format-btn.active { background-color: #ff7e00; color: white; border-color: #ff7e00; }

        .text-20-indicator { padding: 7px 12px; font-size: 12px; background-color: rgba(255, 126, 0, 0.1); border: 1px solid #ff7e00; color: #555; margin: 15px 0; border-radius: 4px; text-align: center; }
        .text-20-indicator i { color: #00b300; margin-right: 5px;}

        .best-practices { background-color: #f8f8f8; border-radius: 8px; padding: 15px; margin: 15px 0; display: none; }
        .best-practices h3 { font-size: 15px; color: #333; margin-bottom: 10px; }
        .best-practices ul { list-style-type: disc; margin-left: 20px; }
        .best-practices li { font-size: 12px; margin-bottom: 4px; color: #666; }
        .toggle-practices { display: block; margin: 10px auto; background: none; border: 1px solid #ddd; padding: 5px 10px; font-size: 12px; color: #666; cursor: pointer; border-radius: 4px; }

        .note { text-align: center; margin-top: 25px; color: #666; font-size: 11px; }

        /* Ad Copy Section */
        .ad-copy-section { margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px; }
        .ad-copy-section h3 { font-size: 16px; color: #333; text-align: center; margin-bottom: 12px; }
        .ad-copy-container { background-color: #f9f9f9; border: 1px solid #e0e0e0; border-radius: 8px; padding: 15px 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); max-width: 750px; margin: 0 auto; }
        .ad-copy-text { font-size: 14px; line-height: 1.6; color: #444; white-space: pre-line; }
        .copy-btn { background: #f1f1f1; border: 1px solid #ddd; border-radius: 4px; padding: 7px 14px; font-size: 13px; color: #555; cursor: pointer; display: flex; align-items: center; justify-content: center; margin: 12px auto 0; transition: all 0.3s ease; }
        .copy-btn:hover { background: #e9e9e9; }
        .copy-btn i { margin-right: 6px; }

        /* Loading Modal */
        .loading-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.65); display: none; justify-content: center; align-items: center; z-index: 9999; }
        .loading-container { background-color: #fff; padding: 25px 35px; border-radius: 8px; box-shadow: 0 5px 25px rgba(0,0,0,0.2); text-align: center; }
        .loading-spinner { display: inline-block; width: 28px; height: 28px; border: 3px solid rgba(0,0,0,.1); border-radius: 50%; border-top-color: #ff7e00; animation: spin 0.8s ease-in-out infinite; margin-bottom: 12px; }
        #loadingMessage { font-size: 14px; color: #555;}
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Canvas */
        #downloadCanvas { position: absolute; left: -9999px; top: -9999px; }

        /* Campaign Type Indicator */
        .campaign-type-indicator { background-color: #f8fafa; border: 1px dashed #1890ff; border-radius: 4px; padding: 8px 12px; margin: 15px 0; text-align: center; color: #1890ff; font-weight: 600; font-size: 13px; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .campaign-type-indicator i { font-size: 1.1em;}

    </style>
</head>
<body>
    <div class="container">
        <!-- Header, Tabs, Toggles, etc. -->
         <div class="header">
             <h1 id="serviceTitle">Creativos de Tr√°fico para Ads</h1>
             <p>Anuncios optimizados para tus campa√±as (Meta, Google, etc.)</p>
         </div>
         <div class="campaign-type-indicator">
             <i class="fas fa-bullhorn"></i>
             <span>Creativos Optimizados para Campa√±as de Ads</span>
         </div>
         <div class="tabs">
             <div class="tab-group">
                 <button class="tab-button auditoria" data-service="auditoria">Auditor√≠a Gratis</button>
                 <button class="tab-button optimizacion active" data-service="optimizacion">Optimizaci√≥n Express</button>
                 <button class="tab-button meta" data-service="meta">Meta Ads</button>
                 <button class="tab-button google" data-service="google">Google Ads</button>
                 <button class="tab-button email" data-service="email">Email Marketing</button>
                 <button class="tab-button chatbot" data-service="chatbot">Chatbot</button>
                 <button class="tab-button all" data-service="all">Paquete Completo</button>
             </div>
         </div>
         <div class="format-toggle">
             <button id="squareBtn" class="format-btn active">Cuadrado (1080x1080)</button>
             <button id="verticalBtn" class="format-btn">Vertical (1080x1920)</button>
         </div>
         <div class="color-toggle">
             <div class="color-btn color-btn-original active" data-color="original" title="Color original del servicio"></div>
             <div class="color-btn color-btn-orange" data-color="orange" title="Fondo naranja"></div>
             <div class="color-btn color-btn-white" data-color="white" title="Fondo blanco"></div>
             <div class="color-btn color-btn-black" data-color="black" title="Fondo negro"></div>
         </div>
         <div class="download-section">
            <button id="downloadBtn" class="download-btn">
                <i class="fas fa-download"></i>
                Descargar Creativo
            </button>
        </div>
         <div class="info-box">
            <i class="fas fa-info-circle"></i>
            <div>
                <p><strong>Instrucciones:</strong> Seleccion√° servicio, formato y color. El banner superior identifica el servicio. Hac√© clic en "Descargar" o en la imagen.</p>
                <p><strong>Formato Vertical:</strong> Optimizado para la zona segura de Stories/Reels (m√°rgenes superior/inferior).</p>
            </div>
        </div>
        <div class="text-20-indicator">
             <i class="fas fa-check-circle"></i>
             Texto optimizado (< 20%) - Aprobado para Meta
         </div>
         <button class="toggle-practices" id="togglePractices">Ver mejores pr√°cticas</button>
         <div class="best-practices">
             <h3>Mejores Pr√°cticas Ads (Tr√°fico):</h3>
             <ul>
                 <li>Mensajes claros y concisos.</li>
                 <li>Visuales atractivos y relevantes.</li>
                 <li>Texto m√≠nimo en imagen (Regla 20%).</li>
                 <li>Contraste alto entre texto y fondo.</li>
                 <li>Propuesta de valor evidente.</li>
                 <li>CTA (Llamada a la Acci√≥n) directa.</li>
                 <li>Respetar zonas seguras (vertical).</li>
             </ul>
         </div>

        <!-- Contenedor Creativos -->
        <div id="creativesContainer" class="creatives-container">
            <!-- Creativo din√°mico -->
        </div>

        <div class="note">
            <p>Dimensiones: 1080x1080px (Cuadrado), 1080x1920px (Vertical).</p>
        </div>

        <!-- Ad Copy -->
        <div class="ad-copy-section">
            <h3>Copy Sugerido (Voseo)</h3>
            <div class="ad-copy-container">
                <p id="adCopyText" class="ad-copy-text"></p>
                <button id="copyBtn" class="copy-btn"><i class="fas fa-copy"></i> Copiar</button>
            </div>
        </div>

        <!-- Canvas y Modal -->
        <canvas id="downloadCanvas"></canvas>
        <div id="loadingModal" class="loading-modal">
             <div class="loading-container">
                 <div class="loading-spinner"></div>
                 <div id="loadingMessage">Generando imagen...</div>
             </div>
         </div>
    </div>

    <script>
        const colors = {
            primary: '#ff7e00', dark: '#181818', light: '#ffffff',
            auditoria: '#28a745', optimizacion: '#dc3545', meta: '#1877F2',
            google: '#4285F4', email: '#00829b', chatbot: '#6f42c1', all: '#333333'
        };

        // --- DATOS CREATIVOS (CONCISOS) ---
        const creativesData = { /* ... (igual que la versi√≥n anterior, ya eran concisos) ... */
            auditoria: { title: 'AUDITOR√çA GRATIS', subtitle: 'DESCUBR√ç QU√â EST√Å FALLANDO', description: 'An√°lisis experto de tus campa√±as.\nRecomendaciones claras. Sin compromiso.', bgColor: colors.auditoria },
            optimizacion: { title: 'OPTIMIZACI√ìN EXPRESS', subtitle: 'MEJOR√Å TU ROAS EN 48HS', description: 'Ajuste r√°pido de campa√±as.\nReduc√≠ costos, aument√° conversiones.', bgColor: colors.optimizacion },
            meta: { title: 'VENTAS ASEGURADAS', subtitle: 'CAMPA√ëAS QUE S√ç CONVIERTEN', description: 'Gesti√≥n experta para Facebook e Instagram.\nROAS 2.8X garantizado.', bgColor: colors.meta },
            google: { title: 'ATRA√â M√ÅS CLIENTES', subtitle: 'DOMIN√Å LAS B√öSQUEDAS', description: 'Campa√±as rentables en Red de B√∫squeda.\nClientes listos para comprar.', bgColor: colors.google },
            email: { title: 'CAMPA√ëAS QUE VENDEN', subtitle: 'CONVERT√ç SUSCRIPTORES', description: 'Optimiz√° tus secuencias de correo.\nM√°s aperturas, m√°s clics, m√°s ventas.', bgColor: colors.email },
            chatbot: { title: 'AUTOMATIZ√Å Y VEND√â', subtitle: 'ATENCI√ìN INTELIGENTE 24/7', description: 'Optimiz√° la captura de leads.\nRespond√© al instante, mejor√° conversiones.', bgColor: colors.chatbot },
            all: { title: 'ESTRATEGIA INTEGRAL', subtitle: 'MAXIMIZ√Å TU ROI GLOBAL', description: 'Meta + Google + Email + Chatbot.\nTodo optimizado por $1000/mes.', bgColor: colors.all }
        };


        const serviceBannerNames = { /* ... (igual) ... */
             auditoria: 'AUDITOR√çA DE ADS', optimizacion: 'OPTIMIZACI√ìN EXPRESS', meta: 'META ADS', google: 'GOOGLE ADS', email: 'EMAIL MARKETING', chatbot: 'CHATBOTS', all: 'PAQUETE COMPLETO'
        };

        const adCopyData = { /* ... (igual, Voseo) ... */
             auditoria: `üîç ¬øTus campa√±as de Meta Ads y Google Ads no rinden como esperabas? üîç\n\nDescubr√≠ EXACTAMENTE d√≥nde est√°s perdiendo plata y qu√© corregir.\n\n¬°Solicit√° tu Auditor√≠a de Ads GRATUITA! ‚è±Ô∏è\n\n‚úÖ An√°lisis detallado de estructura y configuraci√≥n.\n‚úÖ Identificaci√≥n de fugas de presupuesto.\n‚úÖ Recomendaciones claras para optimizar YA.\n‚úÖ 100% Gratis, sin compromiso.\n\nüëâ Visit√° nuestra web y ped√≠ tu auditor√≠a antes de que se acaben los cupos semanales. ¬°Dej√° de tirar plata!\n\n‚û°Ô∏è www.orangevapor.com`, optimizacion: `‚ö° ¬øCampa√±as de Ads activas pero SIN resultados? ¬°Optimizaci√≥n Express en 48hs! ‚ö°\n\nDeten√© el gasto innecesario y empez√° a ver conversiones REALES.\n\nNuestro servicio r√°pido incluye:\n‚úÖ Diagn√≥stico de puntos d√©biles.\n‚úÖ Reestructuraci√≥n para m√°ximo rendimiento.\n‚úÖ Ajuste de segmentaciones y creativos.\n‚úÖ ¬°Resultados visibles en d√≠as!\n\nüëâ Descubr√≠ en nuestra web c√≥mo recuperamos campa√±as "perdidas" y multiplicamos su ROAS.\n\n¬øQuer√©s transformar tus Ads? Visit√° üëá\nwww.orangevapor.com`, meta: `üì± ¬øInvert√≠s en Meta Ads (Facebook/Instagram) pero las ventas no llegan? üì±\n\n¬°Dej√° de adivinar! Nuestras campa√±as tienen un ROAS m√≠nimo GARANTIZADO de 2.8x.\n\n‚úÖ Estrategia personalizada para TU negocio.\n‚úÖ Optimizaci√≥n continua basada en datos.\n‚úÖ Reducci√≥n del costo por adquisici√≥n (CPA).\n‚úÖ Reportes claros y enfocados en ROI.\n\nüëâ Mir√° casos de √©xito en nuestra web y comprob√° c√≥mo escalamos ventas con Meta Ads.\n\n¬°Es hora de que tus Ads trabajen para vos! Hac√© clic üëá\nwww.orangevapor.com`, google: `üîé ¬øTu competencia aparece en Google Ads y vos no? ¬°Perd√©s clientes! üîé\n\nConvert√≠ b√∫squedas activas en ventas con campa√±as de Google Ads OPTIMIZADAS.\n\n‚úÖ ROAS m√≠nimo 2.8x GARANTIZADO.\n‚úÖ Palabras clave que S√ç convierten.\n‚úÖ Optimizaci√≥n de concordancias y negativas.\n‚úÖ Anuncios atractivos que destacan.\n\nüëâ Visit√° nuestra web y descubr√≠ c√≥mo llevamos negocios a la cima de Google, reduciendo su CPA.\n\n¬°Aparec√© donde te buscan tus clientes! üëá\nwww.orangevapor.com`, email: `üìß ¬øTen√©s una lista de emails pero no genera ventas? ¬°Optimiz√° tus Campa√±as de Email Marketing! üìß\n\nTransform√° suscriptores inactivos en clientes recurrentes.\n\n‚úÖ Secuencias automatizadas que nutren y venden.\n‚úÖ Segmentaci√≥n avanzada para mensajes relevantes.\n‚úÖ Aumento de tasa de apertura y clics (CTR).\n‚úÖ Genera ingresos pasivos con tu base de datos.\n\nüëâ Descubr√≠ en nuestra web c√≥mo revitalizamos campa√±as de email marketing olvidadas.\n\n¬°Monetiz√° tu lista AHORA! üëá\nwww.orangevapor.com`, chatbot: `ü§ñ ¬øPerd√©s leads y ventas por no responder al instante? ¬°Potenci√° tus Campa√±as con Chatbots! ü§ñ\n\nIntegr√° chatbots inteligentes para MAXIMIZAR la conversi√≥n de tus Ads.\n\n‚úÖ Captur√° y cualific√° leads 24/7.\n‚úÖ Respond√© preguntas frecuentes al instante.\n‚úÖ Gu√≠a a los usuarios hacia la compra.\n‚úÖ Liber√° a tu equipo para tareas complejas.\n\nüëâ Visit√° nuestra web y mir√° c√≥mo los chatbots mejoran el ROI de las campa√±as de marketing.\n\n¬°No pierdas ni un lead m√°s! üëá\nwww.orangevapor.com`, all: `üöÄ ¬°La Estrategia de Ads COMPLETA que tu negocio necesita! üöÄ\n\n¬øPor qu√© optimizar un solo canal cuando pod√©s dominar TODOS?\n\nNuestro Paquete Integral incluye Optimizaci√≥n Express para:\n‚úÖ Meta Ads (Facebook & Instagram)\n‚úÖ Google Ads (B√∫squeda, Display, etc.)\n‚úÖ Campa√±as de Email Marketing\n‚úÖ Campa√±as con Chatbots\n\nüëâ Ahorr√° $200/mes con el paquete completo ($1000 vs $1200 por separado) y obten√© resultados sin√©rgicos. ¬°Visit√° nuestra web!\n\nMaximiz√° tu presencia y ROI en todos los frentes üëá\nwww.orangevapor.com`
        };

        let activeService = 'optimizacion';
        let activeFormat = 'square';
        let activeColor = 'original';
        let isProcessing = false;

        // DOM Elements
        const serviceTitle = document.getElementById('serviceTitle');
        const creativesContainer = document.getElementById('creativesContainer');
        const tabButtons = document.querySelectorAll('.tab-button');
        const formatButtons = document.querySelectorAll('.format-btn');
        const colorButtons = document.querySelectorAll('.color-btn');
        const squareBtn = document.getElementById('squareBtn');
        const verticalBtn = document.getElementById('verticalBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const togglePracticesBtn = document.getElementById('togglePractices');
        const bestPracticesBox = document.querySelector('.best-practices');
        const downloadCanvas = document.getElementById('downloadCanvas');
        const adCopyText = document.getElementById('adCopyText');
        const copyBtn = document.getElementById('copyBtn');
        const loadingModal = document.getElementById('loadingModal');
        const loadingMessage = document.getElementById('loadingMessage');


        // --- Helper Functions ---
        function getServiceFriendlyName(service) { /* ... (igual) ... */
            const nameMap={auditoria:'Auditor√≠a Gratis Ads',optimizacion:'Optimizaci√≥n Express Ads',meta:'Campa√±as Meta Ads',google:'Campa√±as Google Ads',email:'Campa√±as Email Mkt',chatbot:'Campa√±as con Chatbots',all:'Paquete Ads Completo'};return`Tr√°fico: ${nameMap[service]||'Creativos Ads'}`
        }
        function getMainBgColor() { /* ... (igual) ... */
            if(activeColor==='original'){return(activeService==='all'||!creativesData[activeService])?colors.primary:creativesData[activeService].bgColor}else if(activeColor==='orange')return colors.primary;else if(activeColor==='white')return colors.light;else if(activeColor==='black')return colors.dark;return colors.primary
        }
        function getServiceColor(service) { /* ... (igual) ... */
             // Prioriza color de 'colors', luego 'creativesData', fallback a dark
            return colors[service] || creativesData[service]?.bgColor || colors.dark;
        }
        function getTextColor(bgColor) { /* ... (igual, robusta) ... */
            if(!bgColor)return colors.dark;let r,g,b;if(bgColor.startsWith('#')){if(bgColor.length===4){r=parseInt(bgColor[1]+bgColor[1],16);g=parseInt(bgColor[2]+bgColor[2],16);b=parseInt(bgColor[3]+bgColor[3],16)}else if(bgColor.length===7){const bigint=parseInt(bgColor.slice(1),16);r=(bigint>>16)&255;g=(bigint>>8)&255;b=bigint&255}else{return colors.dark}}else if(bgColor.startsWith('rgb')){const matches=bgColor.match(/\d+/g);if(!matches||matches.length<3)return colors.dark;[r,g,b]=matches.map(Number)}else{return colors.dark}if(isNaN(r)||isNaN(g)||isNaN(b))return colors.dark;const lum=(0.2126*r+0.7152*g+0.0722*b)/255;return lum>0.55?colors.dark:colors.light // Ajustado umbral ligeramente
        }
        function getAccentColor(mainBgColor, serviceColor) { /* ... (igual) ... */
            const mainTextColor=getTextColor(mainBgColor);if(activeColor==='orange'||activeColor==='white'||activeColor==='black'){return serviceColor}return mainTextColor
        }

        // --- Core Functions ---
        function renderCreative() {
             creativesContainer.innerHTML = '';
             const creativeData = creativesData[activeService];
             if (!creativeData) { console.error("Datos no encontrados:", activeService); return; }

             const mainBgColor = getMainBgColor();
             const serviceColor = getServiceColor(activeService); // Color espec√≠fico del servicio
             const mainTextColor = getTextColor(mainBgColor);
             const bannerTextColor = getTextColor(serviceColor); // Contraste para el banner
             const accentColor = getAccentColor(mainBgColor, serviceColor);

             // Crear elemento principal
             const creativeEl = document.createElement('div');
             creativeEl.className = `creative ${activeFormat === 'vertical' ? 'creative-vertical' : ''}`;
             creativeEl.style.backgroundColor = mainBgColor;

             // Banner Superior
             const bannerEl = document.createElement('div');
             bannerEl.className = 'creative-service-banner';
             bannerEl.style.backgroundColor = serviceColor; // Usa el color del servicio
             bannerEl.style.color = bannerTextColor;       // Usa texto contrastante
             bannerEl.textContent = serviceBannerNames[activeService] || 'SERVICIO ADS';
             creativeEl.appendChild(bannerEl);

             // Logo (posici√≥n ajustada en CSS, especialmente para vertical)
             const logoContainerEl = document.createElement('div');
             logoContainerEl.className = 'logo-container';
             const logoEl = document.createElement('div');
             // Color Logo
             if (activeColor === 'white') { logoEl.innerHTML = `<span style="color: ${colors.dark};">Orange</span> <span style="color: ${colors.primary};">Vapor</span>`; }
             else if (mainBgColor === colors.primary && activeColor !== 'original') { logoEl.innerHTML = `<span style="color: ${colors.light};">Orange Vapor</span>`; }
             else { logoEl.innerHTML = `<span style="color: ${mainTextColor};">Orange</span> <span style="color: ${colors.primary};">Vapor</span>`; }
             logoContainerEl.appendChild(logoEl);
             creativeEl.appendChild(logoContainerEl);

             // Contenido de Texto (posici√≥n ajustada en CSS, esp. para vertical)
             const contentEl = document.createElement('div');
             contentEl.className = 'creative-content';
             const titleEl = document.createElement('div'); titleEl.className = 'creative-title'; titleEl.textContent = creativeData.title; titleEl.style.color = mainTextColor; contentEl.appendChild(titleEl);
             const subtitleEl = document.createElement('div'); subtitleEl.className = 'creative-subtitle'; subtitleEl.textContent = creativeData.subtitle; subtitleEl.style.color = mainTextColor; contentEl.appendChild(subtitleEl);
             const descEl = document.createElement('div'); descEl.className = 'creative-description'; descEl.style.whiteSpace = 'pre-line'; descEl.textContent = creativeData.description; descEl.style.color = mainTextColor; contentEl.appendChild(descEl);
             creativeEl.appendChild(contentEl);

             // Acento Lateral
             const accentEl = document.createElement('div'); accentEl.className = 'creative-accent'; accentEl.style.background = accentColor; creativeEl.appendChild(accentEl);

             // Bot√≥n Descarga Overlay
             const downloadOverlayEl = document.createElement('div'); downloadOverlayEl.className = 'creative-download'; downloadOverlayEl.innerHTML = `<i class="fas fa-download"></i>`; downloadOverlayEl.addEventListener('click', (e) => { e.stopPropagation(); generateAndDownloadImage(); }); creativeEl.appendChild(downloadOverlayEl);

             // Evento click en toda la imagen
             creativeEl.addEventListener('click', generateAndDownloadImage);
             creativesContainer.appendChild(creativeEl);
             updateAdCopy();
        }

        function updateAdCopy() { /* ... (igual) ... */
             adCopyText.textContent=adCopyData[activeService]||"Copy no disponible.";copyBtn.innerHTML='<i class="fas fa-copy"></i> Copiar'
        }
        function showLoadingModal(message="Generando...") { loadingMessage.textContent=message;loadingModal.style.display='flex'; }
        function hideLoadingModal() { loadingModal.style.display='none'; }


        // --- CANVAS DRAWING & DOWNLOAD (Zona Segura Ajustada) ---
        function generateAndDownloadImage() {
            if (isProcessing) return;
            isProcessing = true;
            showLoadingModal();
            console.log(`[Start] Generating: ${activeService}, Format: ${activeFormat}, Color: ${activeColor}`); // Log inicio

            requestAnimationFrame(() => {
                setTimeout(() => {
                    try {
                        const creativeData = creativesData[activeService];
                        if (!creativeData) throw new Error(`Datos no encontrados: ${activeService}`);

                        const isVertical = activeFormat === 'vertical';
                        const width = 1080;
                        const height = isVertical ? 1920 : 1080;
                        downloadCanvas.width = width;
                        downloadCanvas.height = height;
                        const ctx = downloadCanvas.getContext('2d');
                        ctx.clearRect(0, 0, width, height);

                        // Colores
                        const mainBgColor = getMainBgColor();
                        const serviceColor = getServiceColor(activeService); // Color espec√≠fico del servicio
                        const mainTextColor = getTextColor(mainBgColor);
                        const bannerTextColor = getTextColor(serviceColor); // Contraste del banner
                        const accentColor = getAccentColor(mainBgColor, serviceColor);
                        console.log(`[Canvas] Service: ${activeService}, Banner Color: ${serviceColor}, Banner Text: ${bannerTextColor}, Main BG: ${mainBgColor}, Main Text: ${mainTextColor}`); // Log colores

                        // --- DIBUJAR ---

                        // 1. Fondo
                        ctx.fillStyle = mainBgColor;
                        ctx.fillRect(0, 0, width, height);

                        // 2. Banner Superior (siempre arriba)
                        const bannerHeight = isVertical ? 100 : 80; // M√°s delgado
                        ctx.fillStyle = serviceColor; // Color del SERVICIO
                        ctx.fillRect(0, 0, width, bannerHeight);
                        const bannerText = serviceBannerNames[activeService] || 'SERVICIO ADS';
                        const bannerFontSize = isVertical ? 45 : 40;
                        ctx.font = `bold ${bannerFontSize}px Montserrat, sans-serif`;
                        ctx.fillStyle = bannerTextColor; // Color texto contrastante
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        ctx.fillText(bannerText, width / 2, bannerHeight / 2);

                        // --- ZONA SEGURA (C√°lculo Estricto) ---
                        // Meta recomienda ~14% superior/inferior libre para Stories/Reels
                        const safeTopMargin = isVertical ? Math.round(height * 0.14) : bannerHeight + 20; // 14% en vertical, o justo bajo banner en cuadrado
                        const safeBottomMargin = isVertical ? Math.round(height * 0.14) : 40;
                        const safeZoneY = safeTopMargin;
                        const safeZoneHeight = height - safeTopMargin - safeBottomMargin;
                        const textMaxWidth = width - 120; // Margen lateral texto (un poco m√°s)

                        // --- DEBUG: Dibujar Zona Segura (opcional) ---
                        // ctx.strokeStyle = 'rgba(255, 0, 0, 0.5)'; ctx.lineWidth = 3; ctx.strokeRect(60, safeZoneY, textMaxWidth, safeZoneHeight);
                        // ------------------------------------------

                        // 3. Logo (Posicionado DESPU√âS del safeTopMargin vertical)
                        const logoFontSize = isVertical ? 38 : 34;
                        ctx.font = `bold ${logoFontSize}px Montserrat, sans-serif`;
                        ctx.textAlign = 'left';
                        ctx.textBaseline = 'top';
                        const logoX = 60;
                        // Asegura que el logo empiece DESPU√âS del margen superior seguro
                        const logoY = isVertical ? safeZoneY + 10 : bannerHeight + 30; // +10px de aire extra en vertical

                         // Color Logo
                        if (activeColor === 'white') { ctx.fillStyle = colors.dark; ctx.fillText('Orange', logoX, logoY); ctx.fillStyle = colors.primary; ctx.fillText('Vapor', logoX + ctx.measureText('Orange ').width, logoY); }
                        else if (mainBgColor === colors.primary && activeColor !== 'original') { ctx.fillStyle = colors.light; ctx.fillText('Orange Vapor', logoX, logoY); }
                        else { ctx.fillStyle = mainTextColor; ctx.fillText('Orange', logoX, logoY); ctx.fillStyle = colors.primary; ctx.fillText('Vapor', logoX + ctx.measureText('Orange ').width, logoY); }


                        // 4. Bloque de Texto (Centrado en Zona Segura, debajo del logo)
                        ctx.textAlign = 'center';
                        // Estimar altura total del bloque de texto
                        const titleFontSize = isVertical ? 65 : 60;
                        const titleLineHeight = titleFontSize * 1.15;
                        const subtitleFontSize = isVertical ? 48 : 40;
                        const subtitleLineHeight = subtitleFontSize * 1.2;
                        const descFontSize = isVertical ? 34 : 30;
                        const descLineHeight = descFontSize * 1.3;
                        const spaceSub = 20; // Espacios entre bloques
                        const spaceDesc = 30;

                        const measureCtx = downloadCanvas.getContext('2d'); // Usar contexto separado para medir
                        measureCtx.font = `bold ${titleFontSize}px Montserrat, sans-serif`;
                        const titleInfo = wrapTextAndMeasure(measureCtx, creativeData.title, textMaxWidth, titleLineHeight);
                        measureCtx.font = `bold ${subtitleFontSize}px Montserrat, sans-serif`;
                        const subtitleInfo = wrapTextAndMeasure(measureCtx, creativeData.subtitle, textMaxWidth, subtitleLineHeight);
                        measureCtx.font = `${descFontSize}px Montserrat, sans-serif`;
                        const descInfo = wrapTextAndMeasure(measureCtx, creativeData.description, textMaxWidth, descLineHeight);

                        const totalTextBlockHeight = titleInfo.height + (subtitleInfo.lines > 0 ? spaceSub + subtitleInfo.height : 0) + (descInfo.lines > 0 ? spaceDesc + descInfo.height : 0);

                        // Calcular Y inicial para centrar el bloque DENTRO de la zona segura, DESPU√âS del logo
                        const availableTextHeight = height - logoY - logoFontSize - safeBottomMargin - 20; // Altura disponible bajo el logo hasta margen inferior
                        const textBlockStartY = logoY + logoFontSize + Math.max(20, (availableTextHeight - totalTextBlockHeight) / 2); // Centrar en el espacio restante, m√≠nimo 20px bajo logo


                        // Dibujar Textos
                        ctx.fillStyle = mainTextColor;
                        ctx.textBaseline = 'top';

                        // T√≠tulo
                        ctx.font = `bold ${titleFontSize}px Montserrat, sans-serif`;
                        const titleActualY = textBlockStartY;
                        const titleDrawInfo = wrapTextAndDraw(ctx, creativeData.title, width / 2, titleActualY, textMaxWidth, titleLineHeight);

                        // Subt√≠tulo
                        let subtitleActualY = titleActualY + titleInfo.height + spaceSub;
                        let subtitleDrawInfo = { endY: subtitleActualY }; // Default if no subtitle
                        if (subtitleInfo.lines > 0) {
                            ctx.font = `bold ${subtitleFontSize}px Montserrat, sans-serif`;
                            subtitleDrawInfo = wrapTextAndDraw(ctx, creativeData.subtitle, width / 2, subtitleActualY, textMaxWidth, subtitleLineHeight);
                        } else {
                             subtitleActualY = titleActualY + titleInfo.height; // Si no hay subt√≠tulo, no sumar espacio
                        }

                        // Descripci√≥n
                        let descActualY = subtitleDrawInfo.endY + spaceDesc;
                        if (descInfo.lines > 0) {
                            ctx.font = `${descFontSize}px Montserrat, sans-serif`;
                            wrapTextAndDraw(ctx, creativeData.description, width / 2, descActualY, textMaxWidth, descLineHeight);
                        }


                        // 5. Acento Lateral (Alineado con el centro del bloque de texto)
                         ctx.fillStyle = accentColor;
                         const accentWidth = isVertical ? 18 : 12;
                         const accentHeight = isVertical ? 120 : 80;
                         // Centrar verticalmente respecto al bloque de texto
                         let accentY = textBlockStartY + (totalTextBlockHeight / 2) - (accentHeight / 2);
                         accentY = Math.max(bannerHeight + 10, Math.min(accentY, height - accentHeight - 10)); // Mantener dentro de l√≠mites
                         ctx.fillRect(0, accentY, accentWidth, accentHeight);


                        // 6. Descargar
                        const dataUrl = downloadCanvas.toDataURL('image/png');
                        const link = document.createElement('a');
                        link.href = dataUrl;
                        link.download = `trafico-ads-${activeService}-${activeColor}-${activeFormat}.png`;
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        console.log(`[Success] Image downloaded: ${link.download}`);

                        hideLoadingModal();
                        isProcessing = false;

                    } catch (error) {
                        console.error('Error al generar/descargar:', error);
                        hideLoadingModal();
                        alert(`Hubo un error: ${error.message}. Intent√° de nuevo.`);
                        isProcessing = false;
                    }
                }, 100); // Aumentado ligero delay para renderizado y logs
            });
        }

        // --- Wrap Text Helpers (Devuelve endY) ---
        function wrapTextAndMeasure(ctx, text, maxWidth, lineHeight) {
            // ... (igual que la versi√≥n anterior) ...
            const words = text.split(/[\s\n]+/);let line = '';let lines = 0;let currentY = 0;if (!text || text.trim() === '') return { lines: 0, height: 0, endY: 0 };for (let n = 0; n < words.length; n++) {const testLine = line + words[n] + ' ';const metrics = ctx.measureText(testLine);if (metrics.width > maxWidth && n > 0) {lines++;currentY += lineHeight;line = words[n] + ' ';} else {line = testLine;}}lines++;const totalHeight = lines * lineHeight;return { lines: lines, height: totalHeight, endY: currentY + lineHeight }; // endY is bottom of last line
        }

        function wrapTextAndDraw(ctx, text, x, y, maxWidth, lineHeight) {
             // ... (igual que la versi√≥n anterior, pero devuelve endY) ...
            const words = text.split(/[\s\n]+/);let line = '';let currentY = y;let lines = 0; if (!text || text.trim() === '') return { lines: 0, endY: y }; for (let n = 0; n < words.length; n++) { const testLine = line + words[n] + ' '; const metrics = ctx.measureText(testLine); if (metrics.width > maxWidth && n > 0) { ctx.fillText(line.trim(), x, currentY); currentY += lineHeight; lines++; line = words[n] + ' '; } else { line = testLine; } } ctx.fillText(line.trim(), x, currentY); lines++; return { lines: lines, endY: currentY + lineHeight }; // Return Y coord after the last line drew
        }


        // --- UI Update & Event Listeners ---
        function updateUI() {
            serviceTitle.textContent = getServiceFriendlyName(activeService);
            tabButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.service === activeService));
            formatButtons.forEach(btn => btn.classList.remove('active'));
            document.getElementById(activeFormat === 'square' ? 'squareBtn' : 'verticalBtn').classList.add('active');
            colorButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.color === activeColor));
            renderCreative(); // Renderiza preview
        }

        // Event Listeners
        tabButtons.forEach(btn => btn.addEventListener('click', () => { if(isProcessing) return; activeService = btn.dataset.service; updateUI(); }));
        squareBtn.addEventListener('click', () => { if(isProcessing) return; activeFormat = 'square'; updateUI(); });
        verticalBtn.addEventListener('click', () => { if(isProcessing) return; activeFormat = 'vertical'; updateUI(); });
        colorButtons.forEach(btn => btn.addEventListener('click', () => { if(isProcessing) return; activeColor = btn.dataset.color; updateUI(); }));
        downloadBtn.addEventListener('click', generateAndDownloadImage);
        copyBtn.addEventListener('click', () => { /* ... (copy logic) ... */
            const textToCopy=adCopyText.textContent||adCopyText.innerText;navigator.clipboard.writeText(textToCopy).then(()=>{copyBtn.innerHTML='<i class="fas fa-check"></i> Copiado!';setTimeout(()=>{copyBtn.innerHTML='<i class="fas fa-copy"></i> Copiar'},2000)}).catch(err=>{console.error('Error al copiar: ',err);copyBtn.innerHTML='<i class="fas fa-times"></i> Error';setTimeout(()=>{copyBtn.innerHTML='<i class="fas fa-copy"></i> Copiar'},2000)})
        });
        togglePracticesBtn.addEventListener('click', () => {
            const isHidden=bestPracticesBox.style.display==='none'||bestPracticesBox.style.display==='';bestPracticesBox.style.display=isHidden?'block':'none';togglePracticesBtn.textContent=isHidden?'Ocultar pr√°cticas':'Ver mejores pr√°cticas'
        });

        // Initial Load
        updateUI();

    </script>
</body>
</html>
