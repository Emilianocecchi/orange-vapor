<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creativos Orange Vapor - Auditoría Gratis Optimizada</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&family=Open+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Librería html2canvas para exportación de alta fidelidad -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Open Sans', sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #F5F5F5;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            font-size: 28px;
            color: #2c2c2c;
            margin-bottom: 10px;
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
        }
        .header p {
            color: #666;
            font-size: 16px;
            font-family: 'Open Sans', sans-serif;
        }
        .tabs {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        .tab-group {
            display: inline-flex;
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 10px;
        }
        .tab-button {
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 500;
            background-color: #F5F5F5;
            color: #333;
            border: 1px solid #ddd;
            cursor: pointer;
            font-family: 'Montserrat', sans-serif;
        }
        .tab-button:first-child {
            border-top-left-radius: 6px;
            border-bottom-left-radius: 6px;
        }
        .tab-button:last-child {
            border-top-right-radius: 6px;
            border-bottom-right-radius: 6px;
        }
        .tab-button.active {
            color: white;
        }
        .tab-button.optimizacion.active { background: linear-gradient(135deg, #dc3545 0%, #ad1f2d 100%); border-color: #ad1f2d; }
        .tab-button.meta.active { background: linear-gradient(135deg, #1877F2 0%, #0e4693 100%); border-color: #0e4693; }
        .tab-button.google.active { background: linear-gradient(135deg, #4285F4 0%, #2a61c5 100%); border-color: #2a61c5; }
        .tab-button.email.active { background: linear-gradient(135deg, #00829b 0%, #00546a 100%); border-color: #00546a; }
        .tab-button.chatbot.active { background: linear-gradient(135deg, #6f42c1 0%, #502e8c 100%); border-color: #502e8c; }
        .tab-button.all.active { background: linear-gradient(135deg, #333333 0%, #222222 100%); border-color: #222222; }
        .tab-button.auditoria.active { background: linear-gradient(135deg, #2F855A 0%, #276749 100%); border-color: #276749; }

        /* Sección de descarga */
        .download-section { text-align: center; margin: 20px 0; }
        .download-btn {
            background: linear-gradient(135deg, #2F855A 0%, #276749 100%);
            color: white; border: none; padding: 12px 24px;
            font-size: 16px; font-weight: bold; border-radius: 6px; cursor: pointer;
            display: inline-flex; align-items: center; gap: 10px;
            box-shadow: 0 4px 8px rgba(47, 133, 90, 0.3);
            font-family: 'Montserrat', sans-serif;
        }

        /* Contenedor de creativos */
        .creatives-container { display: flex; flex-wrap: wrap; justify-content: center; margin-top: 20px; }
        .creative {
            width: 360px; height: 360px; margin: 10px; position: relative;
            border-radius: 8px; overflow: hidden; 
            box-shadow: 0 12px 20px rgba(0, 0, 0, 0.15);
            color: #333; cursor: pointer;
            background-color: #F5F5F5; /* Solo fondo blanco */
        }
        .creative-vertical { width: 240px; height: 427px; }
        .creative-content {
            position: relative; z-index: 2; padding: 20px; height: 100%;
            display: flex; flex-direction: column; justify-content: center; text-align: center;
        }
        .creative-title { 
            font-size: 20px; font-weight: 800; margin-bottom: 8px; line-height: 1.2; 
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            color: #2c2c2c; /* Mayor contraste */
            font-family: 'Montserrat', sans-serif;
        }
        .creative-subtitle { 
            font-size: 16px; font-weight: bold; margin-bottom: 8px; line-height: 1.2;
            text-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);
            color: #333333; /* Mayor contraste */
            font-family: 'Montserrat', sans-serif;
        }
        .creative-description { 
            font-size: 13px; line-height: 1.4; 
            margin-bottom: 15px;
            color: #333333; /* Mayor contraste */
            font-family: 'Open Sans', sans-serif;
        }
        .creative-description .highlight {
            background: rgba(47, 133, 90, 0.2);
            padding: 0 5px;
            border-radius: 3px;
            font-weight: bold;
            color: #276749; /* Color verde más oscuro para contraste */
        }
        .creative-accent {
            position: absolute; left: 0; top: 30%; width: 6px; height: 100px;
            background: #2F855A; border-radius: 0 3px 3px 0; z-index: 1;
        }

        /* CTA Button */
        .cta-button {
            background: #2F855A;
            border: none;
            border-radius: 30px;
            padding: 8px 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-weight: bold;
            font-size: 14px;
            margin: 10px auto;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
            color: white;
            font-family: 'Montserrat', sans-serif;
        }
        .cta-button .arrow-icon {
            /* Sin animación */
        }
        
        /* Friction reducer text */
        .friction-reducer {
            font-size: 11px;
            opacity: 0.8;
            margin-top: 5px;
            color: #555; /* Mayor contraste */
            font-family: 'Open Sans', sans-serif;
        }
        
        /* Service Icon */
        .service-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(47, 133, 90, 0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 22px;
            color: #2F855A; /* Verde para contraste */
        }
        
        /* Estilo para el Ribbon */
        .creative-ribbon {
            position: absolute; background: linear-gradient(135deg, #2F855A, #276749);
            color: white; padding: 5px 8px; font-size: 12px; font-weight: bold; z-index: 3;
            top: 15px; right: -35px; width: 130px; text-align: center;
            transform: rotate(45deg); box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            text-transform: uppercase;
            font-family: 'Montserrat', sans-serif;
        }
        .creative-vertical .creative-ribbon { font-size: 13px; top: 20px; right: -40px; width: 150px; }

        /* Guarantee Badge */
        .guarantee-badge {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            margin-top: 10px;
            background: rgba(47, 133, 90, 0.15);
            border-radius: 15px;
            padding: 5px 10px;
            font-size: 12px;
            width: fit-content;
            margin-left: auto;
            margin-right: auto;
            color: #276749; /* Mayor contraste */
            font-family: 'Open Sans', sans-serif;
        }
        
        /* Limited Spots */
        .limited-spots {
            background: rgba(47, 133, 90, 0.15);
            border-left: 3px solid rgba(47, 133, 90, 0.5);
            padding: 5px 10px;
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            width: fit-content;
            margin-left: auto;
            margin-right: auto;
            color: #276749; /* Mayor contraste */
            font-family: 'Open Sans', sans-serif;
        }
        
        /* Mini Testimonial */
        .mini-testimonial {
            background: rgba(47, 133, 90, 0.15);
            padding: 8px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 12px;
            width: fit-content;
            margin-left: auto;
            margin-right: auto;
            color: #444; /* Mayor contraste */
            font-family: 'Open Sans', sans-serif;
        }
        .mini-testimonial .stars {
            color: #FFD700;
            margin-bottom: 3px;
            letter-spacing: -1px;
        }
        .mini-testimonial .quote {
            font-style: italic;
        }
        
        /* Creative Download Button */
        .creative-download {
            position: absolute; top: 10px; right: 10px; width: 30px; height: 30px;
            border-radius: 50%; background: rgba(68, 68, 68, 0.8); display: flex;
            align-items: center; justify-content: center; cursor: pointer;
            z-index: 10;
        }

        /* Notas y cajas informativas */
        .note { text-align: center; margin-top: 30px; color: #666; font-size: 12px; }
        .info-box {
            background-color: #e6f7ff; border-left: 4px solid #1890ff; padding: 15px;
            margin: 20px auto; max-width: 800px; border-radius: 4px; display: flex;
            align-items: flex-start;
            font-family: 'Open Sans', sans-serif;
        }
        .info-box i { color: #1890ff; font-size: 20px; margin-right: 10px; margin-top: 2px; }
        .info-box p { color: #333; font-size: 14px; margin: 0; line-height: 1.5; }

        /* Toggle de formato */
        .format-toggle, .color-toggle { text-align: center; margin: 20px 0; }
        .format-btn, .color-btn {
            padding: 8px 16px; border: 1px solid #ddd; border-radius: 4px;
            background-color: white; margin: 0 5px; cursor: pointer;
            font-family: 'Montserrat', sans-serif;
        }
        .format-btn.active { 
            background: linear-gradient(135deg, #2F855A 0%, #276749 100%); 
            color: white; border-color: #276749; 
        }
        .color-btn.active {
            color: white; border-color: #276749;
        }
        .color-btn.white.active {
            background: linear-gradient(135deg, #2F855A 0%, #276749 100%);
        }
        .color-btn.orange.active {
            background: linear-gradient(135deg, #FF7200 0%, #cc5a00 100%);
            border-color: #cc5a00;
        }

        /* Logo */
        .logo-container {
            position: absolute; top: 10px; left: 10px; padding: 5px 10px;
            border-radius: 4px; z-index: 2; text-align: left;
        }

        /* Modal de carga */
        .loading-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.7); display: flex; justify-content: center;
            align-items: center; z-index: 9999;
        }
        .loading-container {
            background-color: #fff; padding: 20px 30px; border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3); text-align: center;
            font-family: 'Montserrat', sans-serif;
        }
        .loading-spinner {
            display: inline-block; width: 30px; height: 30px; border: 4px solid rgba(0,0,0,.1);
            border-radius: 50%; border-top-color: #2F855A;
            animation: spin 1s ease-in-out infinite; margin-bottom: 10px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Canvas oculto */
        #downloadCanvas { position: absolute; left: -9999px; top: -9999px; }

        /* Indicador 20% texto */
        .text-20-indicator {
            padding: 8px 12px; font-size: 13px; background-color: rgba(47, 133, 90, 0.1);
            border: 1px solid #2F855A; color: #666; margin: 10px 0;
            border-radius: 4px; text-align: center;
            font-family: 'Open Sans', sans-serif;
        }
        .text-20-indicator i { color: #00b300; margin-right: 5px; }

        /* Sección Ad Copy */
        .ad-copy-section { margin-top: 40px; border-top: 1px solid #eee; padding-top: 20px; }
        .ad-copy-section h3 { 
            font-size: 18px; color: #333; text-align: center; margin-bottom: 15px; 
            font-family: 'Montserrat', sans-serif;
        }
        .ad-copy-container {
            background-color: #f9f9f9; border: 1px solid #e0e0e0; border-radius: 8px;
            padding: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            max-width: 800px; margin: 0 auto;
        }
        .ad-copy-text { 
            font-size: 16px; line-height: 1.6; color: #444; white-space: pre-line; 
            font-family: 'Open Sans', sans-serif;
        }
        .copy-btn {
            background: #f1f1f1; border: 1px solid #ddd; border-radius: 4px;
            padding: 8px 16px; font-size: 14px; color: #555; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            margin: 15px auto 0;
            font-family: 'Montserrat', sans-serif;
        }
        .copy-btn i { margin-right: 8px; }

        /* Indicador tipo campaña */
        .campaign-type-indicator {
            background-color: #f8fafa; border: 1px dashed #2F855A; border-radius: 4px;
            padding: 10px; margin: 15px 0; text-align: center; color: #2F855A;
            font-weight: 600; font-size: 14px; display: flex; align-items: center;
            justify-content: center; gap: 8px;
            font-family: 'Montserrat', sans-serif;
        }
        .campaign-type-indicator i { margin-right: 8px; }
        
        /* Móvil optimizado */
        @media (max-width: 600px) {
            .tab-group {
                flex-wrap: wrap;
                box-shadow: none;
            }
            .tab-button {
                border-radius: 4px !important;
                margin: 2px;
            }
            .creative-vertical .cta-button {
                padding: 16px 24px;
                margin-top: 20px;
                font-size: 16px;
            }
            .creative-vertical .service-icon {
                width: 60px;
                height: 60px;
                font-size: 28px;
                margin-bottom: 20px;
            }
        }

        /* Optimizaciones para html2canvas */
        @media print {
            .creative {
                page-break-inside: avoid;
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
            }
        }
        .creative * {
            transform-origin: center center;
        }

        /* Contador de progreso */
        .progress-container {
            width: 100%;
            margin-top: 10px;
            background-color: #f0f0f0;
            border-radius: 3px;
            overflow: hidden;
        }
        .progress-bar {
            height: 6px;
            background: linear-gradient(to right, #2F855A, #276749);
            width: 0%;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 id="serviceTitle">Creativos de Alta Conversión para Auditoría Gratis</h1>
            <p>Anuncios optimizados para maximizar conversiones en tus campañas de Ads</p>
        </div>

        <div class="campaign-type-indicator">
            <i class="fas fa-search-dollar"></i>
            <span>Creativos Optimizados para Auditoría Flash GRATIS</span>
        </div>

        <div class="tabs">
            <div class="tab-group">
                <button class="tab-button auditoria active" data-service="auditoria">Auditoría Gratis</button>
                <button class="tab-button optimizacion" data-service="optimizacion">Optimización Express</button>
                <button class="tab-button meta" data-service="meta">Meta Ads</button>
                <button class="tab-button google" data-service="google">Google Ads</button>
                <button class="tab-button email" data-service="email">Email Marketing</button>
                <button class="tab-button chatbot" data-service="chatbot">Chatbot</button>
                <button class="tab-button all" data-service="all">Paquete Completo</button>
            </div>
        </div>

        <div class="format-toggle">
            <button id="squareBtn" class="format-btn active">Cuadrado (1080x1080)</button>
            <button id="verticalBtn" class="format-btn">Vertical (1080x1920)</button>
        </div>

        <!-- Nueva sección de toggle para color de fondo -->
        <div class="color-toggle">
            <button id="whiteBtn" class="color-btn white active">Fondo Blanco</button>
            <button id="orangeBtn" class="color-btn orange">Fondo Naranja</button>
        </div>

        <div class="download-section">
            <button id="downloadBtn" class="download-btn">
                <i class="fas fa-download"></i>
                Descargar Creativo
            </button>
        </div>

        <div class="info-box">
            <i class="fas fa-info-circle"></i>
            <div>
                <p><strong>Instrucciones:</strong></p>
                <p>1. Seleccioná el tipo de servicio de Ads que deseás generar.</p>
                <p>2. Seleccioná el formato (cuadrado 1080x1080 o vertical 1080x1920).</p>
                <p>3. Para Auditoría Gratis, podés elegir entre fondo blanco o naranja.</p>
                <p>4. Hacé clic en "Descargar Creativo" para obtener la imagen en alta resolución.</p>
            </div>
        </div>

        <div class="text-20-indicator">
            <i class="fas fa-check-circle"></i>
            Texto optimizado (menos del 20% del espacio) - Aprobado para Meta Ads
        </div>

        <div id="creativesContainer" class="creatives-container">
            <!-- El creativo se inserta dinámicamente aquí -->
        </div>

        <div class="note">
            <p>Dimensiones: 1080x1080 píxeles y 1080x1920 píxeles (imágenes descargadas en alta resolución)</p>
        </div>

        <div class="ad-copy-section">
            <h3>Copy Sugerido para Auditoría Gratis (Alta Conversión)</h3>
            <div class="ad-copy-container">
                <p id="adCopyText" class="ad-copy-text"></p>
                <button id="copyBtn" class="copy-btn">
                    <i class="fas fa-copy"></i> Copiar
                </button>
            </div>
        </div>

        <canvas id="downloadCanvas"></canvas>
    </div>

    <script>
        const colors = {
            primary: '#FF7200', dark: '#2D2D2D', light: '#ffffff',
            auditoria: '#2F855A', optimizacion: '#dc3545', meta: '#1877F2',
            google: '#4285F4', googleRed: '#DB4437', googleYellow: '#F4B400',
            googleGreen: '#0F9D58', email: '#00829b', chatbot: '#6f42c1', 
            all: '#333333'
        };
        
        const gradients = {
            auditoria: 'linear-gradient(135deg, #2F855A 0%, #276749 100%)',
            optimizacion: 'linear-gradient(135deg, #dc3545 0%, #ad1f2d 100%)',
            meta: 'linear-gradient(135deg, #1877F2 0%, #0e4693 100%)',
            google: 'linear-gradient(135deg, #4285F4 0%, #2a61c5 100%)',
            email: 'linear-gradient(135deg, #00829b 0%, #00546a 100%)',
            chatbot: 'linear-gradient(135deg, #6f42c1 0%, #502e8c 100%)',
            all: 'linear-gradient(135deg, #333333 0%, #222222 100%)',
            green: 'linear-gradient(135deg, #2F855A 0%, #276749 100%)'
        };

        // Iconos de especialización para cada servicio
        const specializationIcons = {
            auditoria: { icon: 'fa-search-dollar', tooltip: 'Diagnóstico Profesional' },
            optimizacion: { icon: 'fa-tachometer-alt', tooltip: 'Rendimiento Optimizado' },
            meta: { icon: 'fa-thumbs-up', tooltip: 'Engagement Social' },
            google: { icon: 'fa-search', tooltip: 'Búsquedas Optimizadas' },
            email: { icon: 'fa-paper-plane', tooltip: 'Entregabilidad Mejorada' },
            chatbot: { icon: 'fa-comments', tooltip: 'Conversación Automatizada' },
            all: { icon: 'fa-star', tooltip: 'Servicio Premium' }
        };

        // Datos creativos con texto reducido
        const creativesData = {
            auditoria: { 
                title: 'AUDITORÍA FLASH GRATIS', 
                subtitle: 'DESCUBRÍ QUÉ FALLA', 
                description: 'Diagnóstico profesional en 48hs.\nIdentificamos errores y oportunidades', 
                bgColor: colors.auditoria,
                icon: 'fa-search-dollar',
                cta: 'Solicitá ahora',
                guaranteeText: 'Resultados en 48h'
            },
            optimizacion: { 
                title: 'OPTIMIZACIÓN EXPRESS', 
                subtitle: 'MEJORÁ TU ROAS', 
                description: 'Ajuste rápido de campañas.\nMenos costos, más ventas', 
                bgColor: colors.optimizacion,
                icon: 'fa-bolt',
                cta: 'Ver Detalles',
                guaranteeText: '50% si no funciona',
                testimonio: '"Duplicamos ventas"'
            },
            meta: { 
                title: 'META ADS', 
                subtitle: 'CAMPAÑAS QUE CONVIERTEN', 
                description: 'Gestión experta FB/IG.\nROAS 2.8X garantizado', 
                bgColor: colors.meta,
                icon: 'fa-facebook',
                cta: 'Potenciar Ads',
                guaranteeText: 'ROAS garantizado',
                testimonio: '"Duplicamos clientes"'
            },
            google: { 
                title: 'GOOGLE ADS', 
                subtitle: 'DOMINÁ LAS BÚSQUEDAS', 
                description: 'Campañas rentables.\nClientes listos para comprar', 
                bgColor: colors.google,
                icon: 'fa-google',
                cta: 'Aparecer en Google',
                guaranteeText: 'Visibilidad garantizada',
                testimonio: '"Clientes de calidad"'
            },
            email: { 
                title: 'EMAIL MARKETING', 
                subtitle: 'CONVERTÍ SUSCRIPTORES', 
                description: 'Optimización Express.\nMás aperturas y ventas', 
                bgColor: colors.email,
                icon: 'fa-envelope-open-text',
                cta: 'Potenciar Emails',
                guaranteeText: '+38% apertura',
                testimonio: '"Hasta 10X más ingresos"'
            },
            chatbot: { 
                title: 'CHATBOTS', 
                subtitle: 'AUTOMATIZÁ Y VENDE', 
                description: 'Capturá leads 24/7.\nRespuestas instantáneas', 
                bgColor: colors.chatbot,
                icon: 'fa-robot',
                cta: 'Implementar',
                guaranteeText: 'Activo 24/7',
                testimonio: '"Triplicamos leads"'
            },
            all: { 
                title: 'PAQUETE COMPLETO', 
                subtitle: 'MAXIMIZÁ TU ROI', 
                description: 'Meta + Google + Email + Chat\nTodo por US$1000/mes', 
                bgColor: colors.all,
                icon: 'fa-rocket',
                cta: 'Obtener Pack',
                guaranteeText: 'Ahorrá US$200/mes',
                testimonio: '"Sistema que funciona"'
            }
        };

        const ribbonData = {
            auditoria: 'GRATIS', 
            optimizacion: '48HS', 
            meta: '+ROAS',
            google: '+ROI', 
            email: '+38%', 
            chatbot: '24/7',
            all: '-$200'
        };

        const adCopyData = {
            auditoria: `🔍 ¿Tus campañas de Meta Ads y Google Ads no rinden como esperabas? 🔍\n\nDescubrí EXACTAMENTE dónde estás perdiendo dinero y qué corregir.\n\n¡Solicitá tu Auditoría Flash GRATUITA! ⏱️\n\n✅ Análisis detallado de estructura y configuración\n✅ Identificación de fugas de presupuesto\n✅ Recomendaciones claras para optimizar YA\n✅ 100% Gratis, sin compromiso\n\n👉 SOLO 3 CUPOS ESTA SEMANA - Dejá de tirar dinero en anuncios ineficientes\n\n➡️ www.orangevapor.com`,
            optimizacion: `⚡ ¿Campañas de Ads activas pero SIN resultados? ¡Optimización Express en 48hs! ⚡\n\nDetené el gasto innecesario y empezá a ver conversiones REALES.\n\n✅ Diagnóstico inmediato de puntos débiles\n✅ Reestructuración para máximo rendimiento\n✅ Ajuste de segmentaciones y creativos\n✅ Resultados visibles en SOLO 48 HORAS\n\n🔥 CASO REAL: Un cliente reciente duplicó sus ventas en menos de 72 horas.\n\n⚠️ OFERTA POR TIEMPO LIMITADO: Nuestro fee se reduce a la mitad si no mejoramos tus métricas.\n\n¿Listo/a para transformar tus Ads? Visitá 👇\nwww.orangevapor.com`,
            meta: `📱 ¿Invertís en Meta Ads (Facebook/Instagram) pero las ventas no llegan? 📱\n\n¡Dejá de adivinar y tirá dinero! Nuestras campañas tienen resultados GARANTIZADOS.\n\n✅ Estrategia personalizada para TU negocio\n✅ Optimización continua basada en datos\n✅ Reducción del costo por adquisición\n✅ Reportes claros enfocados en resultados\n\n🔥 NUESTROS CLIENTES HABLAN: "Logramos duplicar nuestros clientes en 30 días con Orange Vapor"\n\n⚠️ GARANTÍA DE RESULTADOS: Si no alcanzamos los KPIs acordados, solo pagás la mitad del fee.\n\n¡Es hora de que tus Ads trabajen para vos! Hacé clic 👇\nwww.orangevapor.com`,
            google: `🔎 ¿Tu competencia aparece en Google Ads y vos no? ¡Perdés clientes TODOS LOS DÍAS! 🔎\n\nConvertí búsquedas activas en ventas con campañas de Google Ads OPTIMIZADAS.\n\n✅ Resultados comprobables y garantizados\n✅ Palabras clave que SÍ convierten\n✅ Reducción del costo por cliente\n✅ Anuncios que destacan en la competencia\n\n🔥 CUPOS LIMITADOS: Solo trabajamos con un negocio por nicho para garantizar resultados exclusivos.\n\n⚠️ Cada día que pasa sin aparecer en Google, tu competencia se lleva TUS CLIENTES.\n\n¡Aparecé donde te buscan tus clientes! 👇\nwww.orangevapor.com`,
            email: `📧 ¿Tenés una lista de emails pero no genera ventas? ¡Optimizá tus Campañas de Email Marketing! 📧\n\nConvertí suscriptores inactivos en clientes recurrentes.\n\n✅ Secuencias automatizadas que nutren y venden\n✅ Segmentación avanzada para mensajes relevantes\n✅ Aumento GARANTIZADO de tasa de apertura (+38%)\n✅ Generá ingresos pasivos con tu base de datos\n\n🔥 CASO DE ÉXITO: Una cliente multiplicó sus ingresos por 10 SOLO con email marketing.\n\n⚠️ Tu lista pierde valor cada día que no la monetizás adecuadamente.\n\n¡Monetizá tu lista AHORA! 👇\nwww.orangevapor.com`,
            chatbot: `🤖 ¿Perdés leads y ventas por no responder al instante? ¡Potenciá tus Campañas con Chatbots! 🤖\n\nIntegrá chatbots inteligentes para MAXIMIZAR la conversión de tus Ads.\n\n✅ Capturá y cualificá contactos 24/7/365\n✅ Respondé preguntas frecuentes al instante\n✅ Tasa de conversión hasta 68% (vs 22% manual)\n✅ Liberá a tu equipo para tareas complejas\n\n🔥 DATO IMPACTANTE: El 60% de los contactos se pierden por no responder en los primeros 5 minutos.\n\n⚠️ OFERTA ESPECIAL: Implementación gratuita si contratás este mes.\n\n¡No pierdas ni un cliente potencial más! 👇\nwww.orangevapor.com`,
            all: `🚀 ¡La Estrategia de Ads COMPLETA que tu negocio necesita! 🚀\n\n¿Por qué elegir un solo canal cuando podés dominar TODOS?\n\nNuestro Paquete Integral incluye:\n✅ Meta Ads optimizados (Facebook e Instagram)\n✅ Google Ads estratégico con keywords premium\n✅ Email Marketing automatizado con alta apertura\n✅ Chatbots de conversión 24/7\n\n💰 AHORRÁ $200/MES: Normalmente $1,200/mes por separado\nAHORA: $1,000/mes - ¡AHORRO REAL DE $2,400 AL AÑO!\n\n🔥 BONO EXCLUSIVO: Si contratás ahora, incluimos la Optimización Express ($299) ¡GRATIS!\n\n⚠️ GARANTÍA ÚNICA: Si no mejoramos tus métricas, solo pagás la mitad. Sin contratos largos.\n\nMaximizá tu presencia y ROI en todos los canales 👇\nwww.orangevapor.com`
        };

        let activeService = 'auditoria';
        let activeFormat = 'square';
        let activeColor = 'white';
        let exportQuality = 'high'; // Siempre alta calidad
        let isProcessing = false;

        const serviceTitle = document.getElementById('serviceTitle');
        const creativesContainer = document.getElementById('creativesContainer');
        const tabButtons = document.querySelectorAll('.tab-button');
        const formatButtons = document.querySelectorAll('.format-btn');
        const colorButtons = document.querySelectorAll('.color-btn');
        const squareBtn = document.getElementById('squareBtn');
        const verticalBtn = document.getElementById('verticalBtn');
        const whiteBtn = document.getElementById('whiteBtn');
        const orangeBtn = document.getElementById('orangeBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const downloadCanvas = document.getElementById('downloadCanvas');
        const adCopyText = document.getElementById('adCopyText');
        const copyBtn = document.getElementById('copyBtn');

        // Función para copiar el ad copy
        copyBtn.addEventListener('click', () => {
            const textToCopy = adCopyText.textContent || adCopyText.innerText;
            navigator.clipboard.writeText(textToCopy)
                .then(() => {
                    copyBtn.innerHTML = '<i class="fas fa-check"></i> ¡Copiado!';
                    setTimeout(() => { copyBtn.innerHTML = '<i class="fas fa-copy"></i> Copiar'; }, 2000);
                })
                .catch(err => {
                    console.error('Error al copiar: ', err);
                    copyBtn.innerHTML = '<i class="fas fa-times"></i> Error';
                    setTimeout(() => { copyBtn.innerHTML = '<i class="fas fa-copy"></i> Copiar'; }, 2000);
                });
        });

        // Obtener título del servicio activo
        function getServiceTitle(service) {
            const titleMap = {
                auditoria: 'Creativos para Auditoría Gratis de Ads', 
                optimizacion: 'Creativos para Optimización Express de Ads',
                meta: 'Creativos para Campañas de Meta Ads', 
                google: 'Creativos para Campañas de Google Ads',
                email: 'Creativos para Campañas de Email Marketing', 
                chatbot: 'Creativos para Campañas con Chatbots',
                all: 'Creativos para Paquete de Ads Completo'
            };
            return titleMap[service] ? `Alta Conversión: ${titleMap[service]}` : 'Creativos de Alta Conversión para Ads';
        }

        // Obtener color de acento para detalles
        function getAccentColor() {
            return colors.primary; // Siempre verde para acentos
        }
        
        // Obtener color del CTA según el servicio
        function getCTAColor(service) {
            // Usar colores más contrastantes para los CTAs
            switch(service) {
                case 'auditoria': return '#276749'; // Verde más oscuro
                case 'optimizacion': return '#c41c2c'; // Rojo más oscuro
                case 'meta': return '#0d5bdb'; // Azul de Facebook más oscuro
                case 'google': return '#2a61c5'; // Azul de Google más oscuro
                case 'email': return '#006680'; // Azul email más oscuro
                case 'chatbot': return '#5e35b1'; // Púrpura más oscuro
                case 'all': return '#262626'; // Negro más intenso
                default: return '#276749'; // Verde más oscuro
            }
        }

        // Palabras clave para destacar en verde
        const highlightTerms = {
            'auditoria': ['Diagnóstico', 'profesional', 'errores'],
            'optimizacion': ['rápido', 'Menos', 'más'],
            'meta': ['ROAS 2.8X', 'Meta Ads', 'garantizado'],
            'google': ['rentables', 'clientes', 'comprar'],
            'email': ['Email', 'aperturas', 'ventas'],
            'chatbot': ['24/7', 'leads', 'instantáneas'],
            'all': ['$1000/mes', 'Todo']
        };

        // Renderizar el creativo según selecciones actuales
        function renderCreative() {
            creativesContainer.innerHTML = '';
            const creative = creativesData[activeService];
            if (!creative) {
                console.error("Datos no encontrados para el servicio:", activeService);
                creativesContainer.innerHTML = '<p>Error: Datos del creativo no disponibles.</p>';
                return;
            }

            const accentColor = getAccentColor();
            const ctaColor = getCTAColor(activeService);
            
            const creativeEl = document.createElement('div');
            creativeEl.className = `creative ${activeFormat === 'vertical' ? 'creative-vertical' : ''}`;
            
            // Establecer el color de fondo según la selección
            if (activeService === 'auditoria' && activeColor === 'orange') {
                // Fondo naranja para auditoría
                creativeEl.style.backgroundColor = '#FF7200';
            } else {
                // Fondo blanco para los demás
                creativeEl.style.backgroundColor = '#ffffff';
            }
            
            const ribbonText = ribbonData[activeService];
            if (ribbonText) {
                const ribbonEl = document.createElement('div');
                ribbonEl.className = 'creative-ribbon';
                ribbonEl.textContent = ribbonText;
                creativeEl.appendChild(ribbonEl);
            }

            const contentEl = document.createElement('div');
            contentEl.className = 'creative-content';

            // Logo con color adaptado según el fondo
            const logoContainerEl = document.createElement('div');
            logoContainerEl.className = 'logo-container';
            const logoEl = document.createElement('div');
            logoEl.style.fontWeight = 'bold';
            logoEl.style.fontSize = '14px';
            
            // Ajustar colores del logo según el fondo
            if (activeService === 'auditoria' && activeColor === 'orange') {
                logoEl.innerHTML = `<span style="color: #ffffff;">Orange</span> <span style="color: #ffffff;">Vapor</span>`;
                logoEl.style.textShadow = '0 1px 2px rgba(0,0,0,0.3)';
            } else {
                logoEl.innerHTML = `<span style="color: ${colors.dark};">Orange</span> <span style="color: ${colors.primary};">Vapor</span>`;
            }
            
            logoContainerEl.appendChild(logoEl);
            contentEl.appendChild(logoContainerEl);
            
            // Icono de servicio con colores adaptados
            if (creative.icon) {
                const iconEl = document.createElement('div');
                iconEl.className = 'service-icon';
                
                // Ajustar colores del icono según el fondo
                if (activeService === 'auditoria' && activeColor === 'orange') {
                    iconEl.style.backgroundColor = 'rgba(255,255,255,0.2)';
                    iconEl.style.color = '#ffffff';
                } else {
                    iconEl.style.backgroundColor = 'rgba(47, 133, 90, 0.15)';
                    iconEl.style.color = '#2F855A';
                }
                
                iconEl.innerHTML = `<i class="fas ${creative.icon}"></i>`;
                contentEl.appendChild(iconEl);
            }

            // Título con colores adaptados
            const titleEl = document.createElement('div');
            titleEl.className = 'creative-title';
            titleEl.textContent = creative.title;
            
            // Ajustar color del título según el fondo
            if (activeService === 'auditoria' && activeColor === 'orange') {
                titleEl.style.color = '#ffffff';
                titleEl.style.textShadow = '0 1px 3px rgba(0,0,0,0.4)';
            }
            
            contentEl.appendChild(titleEl);

            // Subtítulo con colores adaptados
            const subtitleEl = document.createElement('div');
            subtitleEl.className = 'creative-subtitle';
            subtitleEl.textContent = creative.subtitle;
            
            // Ajustar color del subtítulo según el fondo
            if (activeService === 'auditoria' && activeColor === 'orange') {
                subtitleEl.style.color = '#ffffff';
                subtitleEl.style.textShadow = '0 1px 2px rgba(0,0,0,0.3)';
            }
            
            contentEl.appendChild(subtitleEl);

            // Descripción con palabras destacadas y colores adaptados
            const descEl = document.createElement('div');
            descEl.className = 'creative-description';
            
            // Resaltar palabras clave con estilos adaptados al fondo
            let enhancedDescription = creative.description;
            
            if (activeService === 'auditoria' && activeColor === 'orange') {
                // Para fondo naranja, usamos un estilo diferente de resaltado
                if (highlightTerms[activeService]) {
                    highlightTerms[activeService].forEach(term => {
                        enhancedDescription = enhancedDescription.replace(
                            new RegExp(term, 'g'), 
                            `<span style="background: rgba(255,255,255,0.3); padding: 0 5px; border-radius: 3px; font-weight: bold; color: #ffffff;">${term}</span>`
                        );
                    });
                }
                descEl.style.color = '#ffffff';
                descEl.style.textShadow = '0 1px 1px rgba(0,0,0,0.2)';
            } else {
                // Para fondo blanco, usamos el estilo original
                if (highlightTerms[activeService]) {
                    highlightTerms[activeService].forEach(term => {
                        enhancedDescription = enhancedDescription.replace(
                            new RegExp(term, 'g'), 
                            `<span class="highlight">${term}</span>`
                        );
                    });
                }
            }
            
            descEl.innerHTML = enhancedDescription;
            contentEl.appendChild(descEl);
            
            // CTA Button con colores adaptados
            if (creative.cta) {
                const ctaEl = document.createElement('button');
                ctaEl.className = 'cta-button';
                ctaEl.innerHTML = `
                    <span class="cta-text">${creative.cta}</span>
                    <i class="fas fa-arrow-right arrow-icon"></i>
                `;
                
                // Ajustar color del CTA según el fondo
                if (activeService === 'auditoria' && activeColor === 'orange') {
                    // Para fondo naranja, usamos un CTA con más contraste
                    ctaEl.style.backgroundColor = '#276749'; // Verde oscuro para contraste
                    ctaEl.style.boxShadow = '0 4px 8px rgba(0,0,0,0.25)';
                } else {
                    ctaEl.style.backgroundColor = ctaColor;
                }
                
                contentEl.appendChild(ctaEl);
                
                // Texto de reducción de fricción para auditoría
                if (activeService === 'auditoria') {
                    const frictionReducerEl = document.createElement('div');
                    frictionReducerEl.className = 'friction-reducer';
                    frictionReducerEl.textContent = 'Meta y Google Ads • Acceso solo lectura';
                    
                    // Ajustar color del texto de fricción según el fondo
                    if (activeColor === 'orange') {
                        frictionReducerEl.style.color = 'rgba(255,255,255,0.9)';
                    }
                    
                    contentEl.appendChild(frictionReducerEl);
                }
            }
            
            // Garantía si está disponible, con colores adaptados
            if (creative.guaranteeText) {
                const guaranteeEl = document.createElement('div');
                guaranteeEl.className = 'guarantee-badge';
                guaranteeEl.innerHTML = `
                    <i class="fas fa-shield-alt"></i>
                    <span>${creative.guaranteeText}</span>
                `;
                
                // Ajustar colores de la garantía según el fondo
                if (activeService === 'auditoria' && activeColor === 'orange') {
                    guaranteeEl.style.backgroundColor = 'rgba(255,255,255,0.2)';
                    guaranteeEl.style.color = '#ffffff';
                }
                
                contentEl.appendChild(guaranteeEl);
            }
            
            // Urgencia para auditoría modificada según lo solicitado, con colores adaptados
            if (activeService === 'auditoria') {
                const urgencyEl = document.createElement('div');
                urgencyEl.className = 'limited-spots';
                urgencyEl.innerHTML = `
                    <i class="fas fa-user-clock"></i>
                    <span>Últimos 3 cupos disponibles</span>
                `;
                
                // Ajustar colores de la urgencia según el fondo
                if (activeColor === 'orange') {
                    urgencyEl.style.backgroundColor = 'rgba(255,255,255,0.2)';
                    urgencyEl.style.borderLeft = '3px solid rgba(255,255,255,0.5)';
                    urgencyEl.style.color = '#ffffff';
                }
                
                contentEl.appendChild(urgencyEl);
            }
            
            // Mini testimonial si está disponible, con colores adaptados
            if (creative.testimonio) {
                const testimonialEl = document.createElement('div');
                testimonialEl.className = 'mini-testimonial';
                testimonialEl.innerHTML = `
                    <div class="stars">★★★★★</div>
                    <div class="quote">${creative.testimonio}</div>
                `;
                
                // Ajustar colores del testimonial según el fondo
                if (activeService === 'auditoria' && activeColor === 'orange') {
                    testimonialEl.style.backgroundColor = 'rgba(255,255,255,0.2)';
                    testimonialEl.style.color = '#ffffff';
                }
                
                contentEl.appendChild(testimonialEl);
            }

            creativeEl.appendChild(contentEl);

            // Botón de descarga
            const downloadEl = document.createElement('div');
            downloadEl.className = 'creative-download';
            downloadEl.innerHTML = `<i class="fas fa-download" style="color: ${colors.light};"></i>`;
            downloadEl.addEventListener('click', (e) => {
                e.stopPropagation();
                generateAndDownloadImage();
            });
            creativeEl.appendChild(downloadEl);

            creativeEl.addEventListener('click', generateAndDownloadImage);

            creativesContainer.appendChild(creativeEl);
            updateAdCopy();
        }

        // Actualizar el ad copy según el servicio seleccionado
        function updateAdCopy() {
            adCopyText.textContent = adCopyData[activeService] || "Copy de anuncio no disponible para este servicio.";
            copyBtn.innerHTML = '<i class="fas fa-copy"></i> Copiar';
        }

        // Mostrar modal de carga durante procesos
        function showLoadingModal(message = "Generando imagen...", progress = null) {
            const existingModal = document.getElementById('loadingModal');
            
            if (existingModal) {
                const messageEl = existingModal.querySelector('.loading-container div:nth-child(2)');
                if (messageEl) messageEl.textContent = message;
                
                // Actualizar barra de progreso si se proporciona
                if (progress !== null) {
                    let progressBar = existingModal.querySelector('.progress-bar');
                    if (progressBar) {
                        progressBar.style.width = `${progress}%`;
                    }
                }
                return;
            }
            
            // Si no existe, crear uno nuevo
            const modalEl = document.createElement('div');
            modalEl.className = 'loading-modal';
            modalEl.id = 'loadingModal';
            
            let progressHTML = '';
            if (progress !== null) {
                progressHTML = `
                    <div class="progress-container">
                        <div class="progress-bar" style="width: ${progress}%;"></div>
                    </div>
                `;
            }
            
            modalEl.innerHTML = `
                <div class="loading-container">
                    <div class="loading-spinner"></div>
                    <div>${message}</div>
                    ${progressHTML}
                </div>`;
            document.body.appendChild(modalEl);
        }
        
        // Ocultar modal de carga
        function hideLoadingModal() {
            const modal = document.getElementById('loadingModal');
            if (modal) { document.body.removeChild(modal); }
        }

        // Función para precargar iconos Font Awesome
        async function precacheFontAwesomeIcons() {
            // Lista de iconos Font Awesome que se utilizan en los creativos
            const faIcons = [
                'fa-search-dollar', 'fa-bolt', 'fa-facebook', 
                'fa-google', 'fa-envelope-open-text', 'fa-robot',
                'fa-rocket', 'fa-shield-alt', 'fa-user-clock',
                'fa-arrow-right', 'fa-download', 'fa-copy',
                'fa-check', 'fa-info-circle', 'fa-check-circle',
                'fa-bullhorn', 'fa-chart-line', 'fa-tachometer-alt',
                'fa-thumbs-up', 'fa-search', 'fa-paper-plane',
                'fa-comments', 'fa-star', 'fa-exclamation-circle',
                'fa-users', 'fa-traffic-light', 'fa-lock'
            ];
            
            // Crear elementos temporales con cada icono para forzar la carga
            const container = document.createElement('div');
            container.style.opacity = '0';
            container.style.position = 'absolute';
            container.style.left = '-9999px';
            container.style.top = '-9999px';
            
            faIcons.forEach(iconClass => {
                const iconEl = document.createElement('i');
                iconEl.className = `fas ${iconClass}`;
                container.appendChild(iconEl);
            });
            
            // Añadir al DOM temporalmente
            document.body.appendChild(container);
            
            // Esperar un poco para permitir la carga
            await new Promise(resolve => setTimeout(resolve, 200));
            
            // Limpiar
            document.body.removeChild(container);
            console.log("Iconos de Font Awesome precargados");
        }

        // Verificar carga de fuentes de Google
        async function verifyGoogleFontsLoaded() {
            // Montserrat y Open Sans son las fuentes principales usadas en los creativos
            const fontFamilies = ['Montserrat', 'Open Sans'];
            const testString = 'ABCDEFGabcdefg123456789';
            const testSizes = [16, 36, 60]; // Verificar algunos tamaños clave
            const variants = ['normal', 'bold'];
            
            // Crear un canvas temporal para pruebas
            const canvas = document.createElement('canvas');
            canvas.width = 650;
            canvas.height = 50;
            const ctx = canvas.getContext('2d');
            
            let attempts = 0;
            const maxAttempts = 10;
            
            while (attempts < maxAttempts) {
                let allFontsLoaded = true;
                
                for (const fontFamily of fontFamilies) {
                    // Verificar cada combinación de tamaño y variante
                    for (const size of testSizes) {
                        for (const weight of variants) {
                            // Primero medir con una fuente fallback
                            ctx.font = `${weight} ${size}px Arial`;
                            const fallbackWidth = ctx.measureText(testString).width;
                            
                            // Luego medir con la fuente personalizada
                            ctx.font = `${weight} ${size}px ${fontFamily}, Arial`;
                            const actualWidth = ctx.measureText(testString).width;
                            
                            // Si las medidas son idénticas, la fuente personalizada no se cargó
                            if (Math.abs(fallbackWidth - actualWidth) < 1) {
                                console.log(`Fuente ${weight} ${size}px ${fontFamily} no cargada correctamente`);
                                allFontsLoaded = false;
                                break;
                            }
                        }
                        if (!allFontsLoaded) break;
                    }
                    if (!allFontsLoaded) break;
                }
                
                if (allFontsLoaded) {
                    console.log(`Todas las fuentes verificadas y cargadas correctamente`);
                    return true;
                }
                
                attempts++;
                console.log(`Intento ${attempts}/${maxAttempts}: esperando fuentes...`);
                
                // Esperar antes del siguiente intento
                await new Promise(resolve => setTimeout(resolve, 200));
            }
            
            console.warn('Advertencia: No se pudieron verificar todas las fuentes después de varios intentos');
            return false;
        }

        // Función para cargar fuentes explícitamente
        async function ensureFontsLoaded() {
            // Esperar a que las fuentes web se carguen
            await document.fonts.ready;
            
            // Cargar explícitamente las fuentes usadas en los creativos
            const fontSizes = [14, 18, 22, 24, 28, 30, 36, 42, 46, 56, 70, 80];
            const fontPromises = [];
            
            // Cargar variantes normal y bold para cada tamaño en ambas fuentes
            for (const fontFamily of ['Montserrat', 'Open Sans']) {
                fontSizes.forEach(size => {
                    fontPromises.push(document.fonts.load(`${size}px ${fontFamily}`));
                    fontPromises.push(document.fonts.load(`bold ${size}px ${fontFamily}`));
                });
            }
            
            // Font Awesome también necesita cargarse correctamente
            fontPromises.push(document.fonts.load('normal 16px "Font Awesome 5 Free"'));
            fontPromises.push(document.fonts.load('normal 16px "Font Awesome 5 Brands"'));
            
            // Esperar a que todas las promesas se resuelvan
            await Promise.all(fontPromises);
            console.log("Todas las fuentes cargadas explícitamente");
            
            // Dar un poco más de tiempo para que el navegador renderice las fuentes
            return new Promise(resolve => setTimeout(resolve, 100));
        }

        // Función principal para exportar a PNG
        async function generateAndDownloadImage() {
            if (isProcessing) return;
            isProcessing = true;
            showLoadingModal("Preparando la exportación del creativo...", 10);

            try {
                // 1. Esperar a que todas las fuentes estén cargadas
                showLoadingModal("Cargando fuentes...", 20);
                await ensureFontsLoaded();
                
                // 2. Obtener el elemento creativo
                const creativeEl = document.querySelector('.creative');
                if (!creativeEl) throw new Error("No se encontró el elemento creativo para exportar");
                
                // 3. Crear un clon para preservar el original y evitar modificaciones
                showLoadingModal("Preparando el elemento para exportación...", 30);
                const clonedEl = creativeEl.cloneNode(true);
                
                // 4. Configurar estilos para el clon para asegurar dimensiones correctas
                Object.assign(clonedEl.style, {
                    width: creativeEl.offsetWidth + 'px',
                    height: creativeEl.offsetHeight + 'px',
                    position: 'fixed',
                    top: '-9999px',
                    left: '-9999px',
                    transform: 'none',
                    boxShadow: 'none',
                    margin: '0',
                    padding: '0',
                    borderRadius: creativeEl.style.borderRadius
                });
                
                // 5. Ocultar los botones de descarga en el clon
                const downloadBtn = clonedEl.querySelector('.creative-download');
                if (downloadBtn) downloadBtn.style.display = 'none';
                
                // 6. Agregar temporalmente al DOM
                document.body.appendChild(clonedEl);
                
                // 7. Configurar opciones de html2canvas
                showLoadingModal("Configurando parámetros de renderizado...", 40);
                // Siempre usar escala 3 para alta calidad
                const scale = 3;
                
                const options = {
                    scale: scale,
                    useCORS: true, // Permitir recursos externos (importante para fuentes web)
                    allowTaint: true, // Permitir imágenes de otros dominios
                    backgroundColor: null, // Fondo transparente si corresponde
                    logging: false, // Desactivar logs en producción
                    onclone: (docClone) => {
                        // Asegurar que todos los elementos estén correctamente clonados y estilizados
                        console.log("Documento clonado correctamente");
                        
                        // Dar tiempo para que se carguen recursos externos y fuentes
                        return new Promise(resolve => setTimeout(resolve, 500));
                    }
                };
                
                // 8. Renderizar a canvas usando html2canvas
                showLoadingModal("Renderizando creativo (esto puede tomar unos segundos)...", 50);
                console.log("Iniciando renderizado con html2canvas...");
                const canvas = await html2canvas(clonedEl, options);
                console.log("Renderizado completado");
                
                // 9. Eliminar el clon
                document.body.removeChild(clonedEl);
                
                // 10. Obtener dimensiones esperadas según el formato
                showLoadingModal("Ajustando dimensiones...", 70);
                const isVertical = activeFormat === 'vertical';
                const expectedWidth = 1080;
                const expectedHeight = isVertical ? 1920 : 1080;
                
                // 11. Crear un canvas con las dimensiones exactas requeridas
                const finalCanvas = document.createElement('canvas');
                finalCanvas.width = expectedWidth;
                finalCanvas.height = expectedHeight;
                const ctx = finalCanvas.getContext('2d');
                
                // 12. Establecer fondo
                if (activeService === 'auditoria' && activeColor === 'orange') {
                    ctx.fillStyle = '#FF7200';
                } else {
                    ctx.fillStyle = '#ffffff';
                }
                ctx.fillRect(0, 0, expectedWidth, expectedHeight);
                
                // 13. Dibujar el contenido renderizado manteniendo la proporción
                const scaleFactor = Math.min(
                    expectedWidth / canvas.width,
                    expectedHeight / canvas.height
                );
                
                // 14. Centrar el contenido
                const offsetX = (expectedWidth - canvas.width * scaleFactor) / 2;
                const offsetY = (expectedHeight - canvas.height * scaleFactor) / 2;
                
                // 15. Dibujar el contenido renderizado en el canvas final
                ctx.drawImage(
                    canvas, 
                    0, 0, canvas.width, canvas.height,
                    offsetX, offsetY, canvas.width * scaleFactor, canvas.height * scaleFactor
                );
                
                // 16. Convertir a PNG y descargar
                showLoadingModal("Preparando descarga...", 90);
                
                // 17. Obtener el data URL
                const dataURL = finalCanvas.toDataURL('image/png');
                
                // 18. Crear enlace de descarga
                const link = document.createElement('a');
                link.href = dataURL;
                link.download = `orange-vapor-${activeService}-${activeColor}-${activeFormat}.png`;
                document.body.appendChild(link);
                
                // 19. Descargar
                showLoadingModal("¡Descargando imagen!", 100);
                link.click();
                document.body.removeChild(link);
                
                console.log("Imagen descargada correctamente");
                
                // Mostrar confirmación breve antes de cerrar el modal
                setTimeout(() => {
                    hideLoadingModal();
                }, 500);
                
            } catch (error) {
                console.error('Error al exportar creativo:', error);
                alert(`Hubo un problema al generar la imagen: ${error.message}. Por favor intentá nuevamente.`);
                hideLoadingModal();
            } finally {
                isProcessing = false;
            }
        }

        // Actualizar la interfaz de usuario
        function updateUI() {
            serviceTitle.textContent = getServiceTitle(activeService);
            
            // Actualizar botones de servicio
            tabButtons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.service === activeService) { 
                    btn.classList.add('active'); 
                }
            });
            
            // Actualizar botones de formato
            formatButtons.forEach(btn => btn.classList.remove('active'));
            if (activeFormat === 'square') { 
                squareBtn.classList.add('active'); 
            } else { 
                verticalBtn.classList.add('active'); 
            }
            
            // Actualizar botones de color
            colorButtons.forEach(btn => btn.classList.remove('active'));
            if (activeColor === 'white') {
                whiteBtn.classList.add('active');
            } else {
                orangeBtn.classList.add('active');
            }
            
            // Mostrar/ocultar opciones de color según el servicio seleccionado
            const colorToggle = document.querySelector('.color-toggle');
            if (activeService === 'auditoria') {
                colorToggle.style.display = 'block';
            } else {
                // Para otros servicios, ocultar las opciones de color y forzar blanco
                colorToggle.style.display = 'none';
                activeColor = 'white';
            }
            
            // Renderizar el creativo con las selecciones actuales
            renderCreative();
        }

        // Event listeners para los botones de servicio
        tabButtons.forEach(btn => btn.addEventListener('click', () => { 
            activeService = btn.dataset.service; 
            updateUI(); 
        }));
        
        // Event listeners para los botones de formato
        squareBtn.addEventListener('click', () => { 
            activeFormat = 'square'; 
            updateUI(); 
        });
        
        verticalBtn.addEventListener('click', () => { 
            activeFormat = 'vertical'; 
            updateUI(); 
        });
        
        // Event listeners para los botones de color
        whiteBtn.addEventListener('click', () => {
            activeColor = 'white';
            updateUI();
        });
        
        orangeBtn.addEventListener('click', () => {
            activeColor = 'orange';
            updateUI();
        });
        
        // Event listener para el botón de descarga
        downloadBtn.addEventListener('click', generateAndDownloadImage);

        // Precarga de recursos al inicio
        async function initializeResources() {
            try {
                // Mostrar mensaje de carga inicial
                showLoadingModal("Inicializando recursos...", 0);
                
                // Esperar a que las fuentes se carguen
                showLoadingModal("Cargando fuentes...", 30);
                await document.fonts.ready;
                
                // Precarga de iconos Font Awesome
                showLoadingModal("Preparando iconos...", 60);
                await precacheFontAwesomeIcons();
                
                // Verificar carga de Google Fonts
                showLoadingModal("Verificando fuentes web...", 90);
                await verifyGoogleFontsLoaded();
                
                // Ocultar modal de carga
                hideLoadingModal();
                
                console.log("Recursos inicializados correctamente");
            } catch (error) {
                console.error("Error al inicializar recursos:", error);
                hideLoadingModal();
            }
        }

        // Inicializar recursos y UI
        initializeResources().then(() => {
            // Inicializar la interfaz
            updateUI();
        });
    </script>
</body>
</html>
