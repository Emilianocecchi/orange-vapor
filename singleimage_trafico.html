<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creativos Orange Vapor - Campa√±as de Tr√°fico Ads</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- Estilos de la versi√≥n funcional anterior (con banner y zona segura b√°sica) --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Montserrat', sans-serif; background-color: #f5f5f5; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; background-color: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); }
        .header { text-align: center; margin-bottom: 20px; }
        .header h1 { font-size: 26px; color: #2c2c2c; margin-bottom: 8px; }
        .header p { color: #666; font-size: 15px; }
        .tabs { display: flex; justify-content: center; flex-wrap: wrap; margin-bottom: 20px; }
        .tab-group { display: inline-flex; border-radius: 6px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); margin-bottom: 10px; }
        .tab-button { padding: 8px 14px; font-size: 13px; font-weight: 500; background-color: white; color: #333; border: 1px solid #ddd; cursor: pointer; transition: all 0.2s ease; white-space: nowrap; }
        .tab-button:first-child { border-top-left-radius: 6px; border-bottom-left-radius: 6px; }
        .tab-button:last-child { border-top-right-radius: 6px; border-bottom-right-radius: 6px; }
        .tab-button.active { color: white; }
        .tab-button.optimizacion.active { background-color: #dc3545; border-color: #dc3545; }
        .tab-button.meta.active { background-color: #1877F2; border-color: #1877F2; }
        .tab-button.google.active { background-color: #4285F4; border-color: #4285F4; }
        .tab-button.email.active { background-color: #00829b; border-color: #00829b; }
        .tab-button.chatbot.active { background-color: #6f42c1; border-color: #6f42c1; }
        .tab-button.all.active { background-color: #333333; border-color: #333333; }
        .tab-button.auditoria.active { background-color: #28a745; border-color: #28a745; }

        .color-toggle { text-align: center; margin: 15px 0; }
        .color-btn { width: 32px; height: 32px; border-radius: 50%; margin: 0 4px; cursor: pointer; display: inline-block; border: 2px solid #ddd; transition: all 0.2s ease; overflow: hidden; vertical-align: middle;}
        .color-btn.active { border-color: #ff7e00; transform: scale(1.15); }
        .color-btn-original { background: linear-gradient(135deg, #28a745 14%, #dc3545 14% 28%, #1877F2 28% 42%, #4285F4 42% 56%, #00829b 56% 70%, #6f42c1 70% 84%, #333 84%); }
        .color-btn-orange { background-color: #ff7e00; }
        .color-btn-white { background-color: #ffffff; border: 2px solid #ccc; }
        .color-btn-black { background-color: #181818; }

        .download-section { text-align: center; margin: 20px 0; }
        .download-btn { background: #ff7e00; color: white; border: none; padding: 10px 20px; font-size: 15px; font-weight: bold; border-radius: 6px; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; box-shadow: 0 3px 6px rgba(255, 126, 0, 0.3); transition: all 0.3s ease; }
        .download-btn:hover { background: #e67300; transform: translateY(-1px); }

        /* Creatives Area */
        .creatives-container { display: flex; flex-wrap: wrap; justify-content: center; margin-top: 10px; gap: 15px;}
        .creative {
            width: 360px; height: 360px; position: relative;
            border-radius: 8px; overflow: hidden; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            color: white; cursor: pointer; background-color: #eee; /* Placeholder bg */
        }
        .creative-vertical { width: 240px; height: 427px; }

        /* Banner Superior */
        .creative-service-banner {
            position: absolute; top: 0; left: 0; width: 100%; height: 35px;
            background-color: #333; color: white; display: flex;
            align-items: center; justify-content: center; font-size: 13px;
            font-weight: 700; z-index: 5; text-transform: uppercase; letter-spacing: 0.5px;
        }

        /* Contenido Principal */
        .creative-content {
            position: relative; z-index: 2; padding: 15px;
            padding-top: 55px; /* Espacio banner(35) + logo(11) + margen(9) */
            height: 100%; display: flex; flex-direction: column;
            justify-content: center; text-align: center;
        }
        /* Zona Segura Preview Vertical (B√ÅSICA) */
        .creative-vertical .creative-content {
            padding-top: 70px; /* Un poco m√°s de espacio arriba */
            padding-bottom: 30px;
            justify-content: center;
        }

        /* Textos (Ajustados para nueva data) */
        .creative-hook { font-size: 24px; font-weight: 800; margin-bottom: 15px; line-height: 1.25; color: inherit; /* Hereda color principal */ }
        .creative-offer { font-size: 18px; font-weight: 700; margin-bottom: 10px; line-height: 1.2; padding: 5px 10px; background-color: rgba(0, 0, 0, 0.1); border-radius: 4px; display: inline-block; } /* Recuadro semi-transparente */
        .creative-benefit { font-size: 14px; line-height: 1.4; margin-bottom: 15px;}
        .creative-cta-visual { font-size: 15px; font-weight: bold; padding: 8px 15px; background-color: var(--service-color, #ff7e00); color: var(--banner-text-color, white); border-radius: 5px; display: inline-block; text-decoration: none; margin-top: 10px; } /* Bot√≥n simulado */
        .creative-credibility { font-size: 11px; margin-top: 8px; opacity: 0.9; font-weight: 500; }

        /* Logo */
        .logo-container {
            position: absolute;
            top: 43px; /* Debajo del banner */
            left: 15px;
            z-index: 20; text-align: left;
        }
        .logo-container div { font-size: 11px !important; font-weight: bold; }
        .creative-vertical .logo-container {
            top: 50px; /* Posici√≥n fija simple en vertical preview */
        }

        /* Acento lateral */
        .creative-accent { position: absolute; left: 0; top: 50%; transform: translateY(-50%); width: 5px; height: 60px; background: white; border-radius: 0 2px 2px 0; z-index: 10; }
        .creative-vertical .creative-accent { height: 80px; }

        /* Bot√≥n descarga overlay */
        .creative-download { position: absolute; top: 5px; right: 5px; width: 28px; height: 28px; border-radius: 50%; background: rgba(0, 0, 0, 0.6); display: flex; align-items: center; justify-content: center; cursor: pointer; opacity: 0; transition: opacity 0.3s; z-index: 30; }
        .creative-download i { font-size: 12px; color: white;}
        .creative:hover .creative-download { opacity: 1; }

        /* Info box, Note, etc. */
        .info-box { background-color: #e6f7ff; border-left: 4px solid #1890ff; padding: 12px 15px; margin: 20px auto; max-width: 800px; border-radius: 4px; display: flex; align-items: flex-start; gap: 10px;}
        .info-box i { color: #1890ff; font-size: 18px; margin-top: 1px; flex-shrink: 0;}
        .info-box p { color: #333; font-size: 13px; margin: 0; line-height: 1.5; }
        .info-box strong { font-weight: 600; }
        .info-box .fas.fa-download { font-size: 1em; vertical-align: middle; }

        .format-toggle { text-align: center; margin: 15px 0; }
        .format-btn { padding: 7px 14px; font-size: 13px; border: 1px solid #ddd; border-radius: 4px; background-color: white; margin: 0 4px; cursor: pointer; transition: all 0.2s ease; vertical-align: middle;}
        .format-btn.active { background-color: #ff7e00; color: white; border-color: #ff7e00; }

        .text-20-indicator { padding: 7px 12px; font-size: 12px; background-color: rgba(255, 126, 0, 0.1); border: 1px solid #ff7e00; color: #555; margin: 15px 0; border-radius: 4px; text-align: center; }
        .text-20-indicator i { color: #00b300; margin-right: 5px;}

        .best-practices { background-color: #f8f8f8; border-radius: 8px; padding: 15px; margin: 15px 0; display: none; }
        .best-practices h3 { font-size: 15px; color: #333; margin-bottom: 10px; }
        .best-practices ul { list-style-type: disc; margin-left: 20px; }
        .best-practices li { font-size: 12px; margin-bottom: 4px; color: #666; }
        .toggle-practices { display: block; margin: 10px auto; background: none; border: 1px solid #ddd; padding: 5px 10px; font-size: 12px; color: #666; cursor: pointer; border-radius: 4px; }

        .note { text-align: center; margin-top: 25px; color: #666; font-size: 11px; }

        /* Ad Copy Section */
        .ad-copy-section { margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px; }
        .ad-copy-section h3 { font-size: 16px; color: #333; text-align: center; margin-bottom: 12px; }
        .ad-copy-container { background-color: #f9f9f9; border: 1px solid #e0e0e0; border-radius: 8px; padding: 15px 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); max-width: 750px; margin: 0 auto; }
        .ad-copy-text { font-size: 14px; line-height: 1.6; color: #444; white-space: pre-line; }
        .copy-btn { background: #f1f1f1; border: 1px solid #ddd; border-radius: 4px; padding: 7px 14px; font-size: 13px; color: #555; cursor: pointer; display: flex; align-items: center; justify-content: center; margin: 12px auto 0; transition: all 0.3s ease; }
        .copy-btn:hover { background: #e9e9e9; }
        .copy-btn i { margin-right: 6px; }

        /* Loading Modal */
        .loading-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.65); display: none; justify-content: center; align-items: center; z-index: 9999; }
        .loading-container { background-color: #fff; padding: 25px 35px; border-radius: 8px; box-shadow: 0 5px 25px rgba(0,0,0,0.2); text-align: center; }
        .loading-spinner { display: inline-block; width: 28px; height: 28px; border: 3px solid rgba(0,0,0,.1); border-radius: 50%; border-top-color: #ff7e00; animation: spin 0.8s ease-in-out infinite; margin-bottom: 12px; }
        #loadingMessage { font-size: 14px; color: #555;}
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Canvas */
        #downloadCanvas { position: absolute; left: -9999px; top: -9999px; }

        /* Campaign Type Indicator */
        .campaign-type-indicator { background-color: #f8fafa; border: 1px dashed #1890ff; border-radius: 4px; padding: 8px 12px; margin: 15px 0; text-align: center; color: #1890ff; font-weight: 600; font-size: 13px; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .campaign-type-indicator i { font-size: 1.1em;}

    </style>
</head>
<body>
    <div class="container">
        <!-- Header, Tabs, Toggles, etc. (sin cambios) -->
        <div class="header"> <h1 id="serviceTitle">Creativos Ads para Instagram</h1> <p>Generador de anuncios visuales basados en tu propuesta.</p> </div>
        <div class="campaign-type-indicator"> <i class="fab fa-instagram"></i> <span>Anuncios Optimizados para Instagram Feed & Stories</span> </div>
        <div class="tabs">
             <div class="tab-group">
                 <!-- Cambiando tabs a los conceptos de anuncio -->
                 <button class="tab-button auditoria active" data-service="auditoria_ad">Auditor√≠a Gratis AD</button>
                 <button class="tab-button optimizacion" data-service="express_ad">Optimizaci√≥n Express AD</button>
                 <button class="tab-button meta" data-service="roi_ad">Resultados Garantizados AD</button>
                 <!-- Opcional: Podr√≠as a√±adir m√°s conceptos aqu√≠ -->
             </div>
         </div>
         <div class="format-toggle"> <button id="squareBtn" class="format-btn active">Cuadrado (1080x1080)</button> <button id="verticalBtn" class="format-btn">Vertical (1080x1920)</button> </div>
         <div class="color-toggle">
            <!-- Colores ahora aplican al fondo principal, banner usa color fijo -->
            <div class="color-btn color-btn-orange active" data-color="orange" title="Fondo Naranja (Recomendado)"></div>
            <div class="color-btn color-btn-white" data-color="white" title="Fondo Blanco"></div>
            <div class="color-btn color-btn-black" data-color="black" title="Fondo Negro"></div>
            <div class="color-btn color-btn-original" data-color="original_service" title="Fondo Color Servicio"></div>
         </div>
         <div class="download-section"> <button id="downloadBtn" class="download-btn"> <i class="fas fa-download"></i> Descargar Anuncio </button> </div>
         <div class="info-box"> <i class="fas fa-lightbulb"></i> <div> <p><strong>Idea:</strong> Seleccion√° un concepto de anuncio (Auditor√≠a, Express, ROI). Eleg√≠ formato y color de fondo. El texto y dise√±o se adaptar√°n.</p> <p>El banner superior siempre usar√° el color del concepto.</p> </div> </div>
         <div class="text-20-indicator"> <i class="fas fa-check-circle"></i> Texto optimizado (< 20%) - Aprobado para Meta </div>
         <button class="toggle-practices" id="togglePractices">Ver Tips Anuncios Instagram</button>
         <div class="best-practices">
             <h3>Tips Anuncios Instagram:</h3>
             <ul>
                 <li>Hook visual/texto potente y claro.</li>
                 <li>Propuesta de valor directa EN la imagen.</li>
                 <li>Beneficio clave conciso EN la imagen.</li>
                 <li>CTA (llamada a la acci√≥n) visible.</li>
                 <li>Branding (logo) presente.</li>
                 <li>Respetar zona segura en vertical (Stories).</li>
                 <li>Probar distintos conceptos (A/B testing).</li>
             </ul>
         </div>

        <!-- Contenedor Creativos -->
        <div id="creativesContainer" class="creatives-container">
            <!-- Creativo din√°mico -->
        </div>

        <div class="note">
            <p>Dimensiones: 1080x1080px (Feed), 1080x1920px (Stories/Reels).</p>
        </div>

        <!-- Ad Copy -->
        <div class="ad-copy-section">
            <h3>Copy Sugerido para Post (Voseo)</h3>
            <div class="ad-copy-container">
                <p id="adCopyText" class="ad-copy-text"></p>
                <button id="copyBtn" class="copy-btn"><i class="fas fa-copy"></i> Copiar</button>
            </div>
        </div>

        <!-- Canvas y Modal -->
        <canvas id="downloadCanvas"></canvas>
        <div id="loadingModal" class="loading-modal"> <div class="loading-container"> <div class="loading-spinner"></div> <div id="loadingMessage">Generando...</div> </div> </div>
    </div>

    <script>
        const colors = { // Colores base
            primary: '#ff7e00', dark: '#181818', light: '#ffffff',
            // Colores asociados a conceptos/servicios para banners
            auditoria_ad_color: '#28a745', // Verde para Auditor√≠a
            express_ad_color: '#dc3545', // Rojo para Express
            roi_ad_color: '#1877F2',      // Azul para ROI/Confianza
        };

        // --- DATOS PARA CONCEPTOS DE ANUNCIOS ---
        // Usamos nombres de servicio tipo 'concepto_ad'
        const creativesData = {
            auditoria_ad: {
                hook: '¬øTus Ads Pierden Plata? üí∏', // Texto principal grande
                offer: 'AUDITOR√çA DE ADS GRATIS',    // Oferta clara
                benefit: 'Descubr√≠ d√≥nde se va tu presupuesto.', // Beneficio
                cta: 'Agend√° Tu Auditor√≠a',         // Texto del bot√≥n visual
                credibility: 'Diagn√≥stico en 48hs',     // Peque√±o badge/texto
                serviceColor: colors.auditoria_ad_color // Color para banner/CTA
            },
            express_ad: {
                hook: '¬øADS ESTANCADOS? üõë',
                offer: 'OPTIMIZACI√ìN EXPRESS 48HS ‚ö°',
                benefit: 'Transform√° Gasto en Ganancia.',
                cta: 'Optimiz√° Ya',
                credibility: 'M√©todo Detecci√≥n de Fugas‚Ñ¢',
                serviceColor: colors.express_ad_color
            },
            roi_ad: {
                hook: 'MARKETING QUE S√ç RINDE ‚úÖ',
                offer: 'Resultados GARANTIZADOS*',
                benefit: 'Convertimos Clics en Ventas Reales.',
                cta: 'Descubr√≠ C√≥mo',
                credibility: '*Si no cumplimos KPIs, pag√°s la mitad.', // Credibilidad incluye la condici√≥n
                serviceColor: colors.roi_ad_color
            }
        };

        // Textos para el banner superior (m√°s cortos)
        const serviceBannerNames = {
             auditoria_ad: 'Auditor√≠a Gratis',
             express_ad: 'Optimizaci√≥n 48hs',
             roi_ad: 'Resultados Garantizados'
        };

        // --- AD COPY PARA POSTS (ajustado a conceptos) ---
        const adCopyData = {
             auditoria_ad: `¬øSent√≠s que invert√≠s en Meta y Google Ads pero no ves el retorno? üìâ El 67% de las empresas no sabe d√≥nde se va realmente su presupuesto.\n\nTe ofrecemos una **Auditor√≠a GRATUITA** para mostrarte:\n‚úÖ Qu√© funciona y qu√© no en tus campa√±as.\n‚úÖ D√≥nde est√°s perdiendo plata HOY.\n‚úÖ Pasos claros para optimizar.\n\n¬°Sin costo y sin compromiso! Agend√° tu auditor√≠a en 48hs tocando el enlace en nuestra bio.\nüëâ [Tu Link a Calendly/Contacto]\n\n#MarketingDigital #PublicidadOnline #MetaAds #GoogleAds #AuditoriaGratis #ROI #OrangeVapor #ResultadosReales`,
             express_ad: `¬øTus campa√±as de Ads parecen un pozo sin fondo? üò© ¬°Basta de tirar plata!\n\nCon nuestra **Optimizaci√≥n Express en 48hs**:\n‚ö° Detectamos fugas de presupuesto (¬°El 63% se puede desperdiciar!).\n‚ö° Aplicamos correcciones r√°pidas y efectivas.\n‚ö° Recib√≠s un plan claro y anuncios listos para usar.\n\n¬°Por solo US$299 y resultados que impactan tu ROI! (Garant√≠a: Si no cumplimos KPIs, pag√°s la mitad).\n\nConoc√© m√°s sobre la Optimizaci√≥n Express en el link de la bio.\nüëâ [Tu Link a Optimizacion Express]\n\n#OptimizacionAds #MarketingResultados #ROI #Campa√±asAds #SolucionMarketing #OrangeVapor #48hs`,
             roi_ad: `¬øCansado de agencias que prometen y no cumplen? üò† En Orange Vapor, hablamos con n√∫meros.\n\nNuestro **M√©todo ROI First‚Ñ¢** se enfoca 100% en resultados medibles para tus Ads, Email Marketing y Chatbots.\n\n‚ú® **¬°Con Resultados Garantizados!*** ‚ú®\n*Si no alcanzamos los KPIs acordados, solo pag√°s la mitad. As√≠ de simple.\n\nDej√° de gastar, empez√° a invertir con inteligencia. Descubr√≠ c√≥mo lo hacemos en el link de nuestra bio.\nüëâ [Tu Link a la Home o Servicios]\n\n#ROI #MarketingGarantizado #ResultadosMedibles #AgenciaMarketing #OrangeVapor #Conversion #VentasOnline`
        };


        let activeService = 'auditoria_ad'; // Default al primer concepto
        let activeFormat = 'square';
        let activeColor = 'orange'; // Default al naranja recomendado
        let isProcessing = false;

        // DOM Elements (sin cambios)
        const serviceTitle = document.getElementById('serviceTitle');
        const creativesContainer = document.getElementById('creativesContainer');
        const tabButtons = document.querySelectorAll('.tab-button');
        const formatButtons = document.querySelectorAll('.format-btn');
        const colorButtons = document.querySelectorAll('.color-btn');
        const squareBtn = document.getElementById('squareBtn');
        const verticalBtn = document.getElementById('verticalBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const togglePracticesBtn = document.getElementById('togglePractices');
        const bestPracticesBox = document.querySelector('.best-practices');
        const downloadCanvas = document.getElementById('downloadCanvas');
        const adCopyText = document.getElementById('adCopyText');
        const copyBtn = document.getElementById('copyBtn');
        const loadingModal = document.getElementById('loadingModal');
        const loadingMessage = document.getElementById('loadingMessage');


        // --- Helper Functions (Ajustadas levemente) ---
        function getServiceFriendlyName(service) {
             const nameMap = { auditoria_ad: 'Anuncio Auditor√≠a', express_ad: 'Anuncio Express', roi_ad: 'Anuncio ROI' };
             return nameMap[service] || 'Anuncio Gen√©rico';
        }

        function getMainBgColor() { // Ahora usa los colores b√°sicos
            if (activeColor === 'orange') return colors.primary;
            else if (activeColor === 'white') return colors.light;
            else if (activeColor === 'black') return colors.dark;
            // Nuevo 'original_service': usa el color del servicio como fondo
            else if (activeColor === 'original_service') return getServiceColor(activeService);
            return colors.primary; // Default naranja
        }
        function getServiceColor(service) { // Obtiene color del CONCEPTO
            return creativesData[service]?.serviceColor || colors.dark; // Usa el color definido en creativesData
        }
        function getTextColor(bgColor) { /* ... (sin cambios, robusta) ... */
            if(!bgColor)return colors.dark;let r,g,b;if(bgColor.startsWith('#')){if(bgColor.length===4){r=parseInt(bgColor[1]+bgColor[1],16);g=parseInt(bgColor[2]+bgColor[2],16);b=parseInt(bgColor[3]+bgColor[3],16)}else if(bgColor.length===7){const bigint=parseInt(bgColor.slice(1),16);r=(bigint>>16)&255;g=(bigint>>8)&255;b=bigint&255}else{return colors.dark}}else if(bgColor.startsWith('rgb')){const matches=bgColor.match(/\d+/g);if(!matches||matches.length<3)return colors.dark;[r,g,b]=matches.map(Number)}else{return colors.dark}if(isNaN(r)||isNaN(g)||isNaN(b))return colors.dark;const lum=(0.2126*r+0.7152*g+0.0722*b)/255;return lum>0.55?colors.dark:colors.light
        }
        function getAccentColor(mainBgColor, serviceColor) { // Acento usa color del servicio si fondo es b√°sico
             const mainTextColor = getTextColor(mainBgColor);
             // Si el fondo es naranja, blanco o negro, el acento es el color del servicio.
             if (activeColor === 'orange' || activeColor === 'white' || activeColor === 'black') {
                 return serviceColor;
             }
             // Si el fondo es el color del servicio ('original_service'), el acento es el color del texto.
             return mainTextColor;
        }


        // --- Core Functions ---
        function renderCreative() { // Actualizado para mostrar nuevos elementos
             creativesContainer.innerHTML = '';
             const adData = creativesData[activeService];
             if (!adData) { console.error("Datos de anuncio no encontrados:", activeService); return; }

             const mainBgColor = getMainBgColor();
             const serviceColor = getServiceColor(activeService); // Color para banner y CTA visual
             const mainTextColor = getTextColor(mainBgColor);
             const bannerTextColor = getTextColor(serviceColor);
             const accentColor = getAccentColor(mainBgColor, serviceColor);

             const creativeEl = document.createElement('div');
             creativeEl.className = `creative ${activeFormat === 'vertical' ? 'creative-vertical' : ''}`;
             creativeEl.style.backgroundColor = mainBgColor;
             // Variables CSS para colores din√°micos (usado en CTA visual)
             creativeEl.style.setProperty('--service-color', serviceColor);
             creativeEl.style.setProperty('--banner-text-color', bannerTextColor);


             // Banner Superior
             const bannerEl = document.createElement('div');
             bannerEl.className = 'creative-service-banner';
             bannerEl.style.backgroundColor = serviceColor;
             bannerEl.style.color = bannerTextColor;
             bannerEl.textContent = serviceBannerNames[activeService] || 'Orange Vapor'; // Nombre corto en banner
             creativeEl.appendChild(bannerEl);

             // Logo
             const logoContainerEl = document.createElement('div');
             logoContainerEl.className = 'logo-container';
             const logoEl = document.createElement('div');
             if (activeColor === 'white') { logoEl.innerHTML = `<span style="color: ${colors.dark};">Orange</span> <span style="color: ${colors.primary};">Vapor</span>`; }
             else if (mainBgColor === colors.primary && activeColor !== 'original_service') { logoEl.innerHTML = `<span style="color: ${colors.light};">Orange Vapor</span>`; }
             else { logoEl.innerHTML = `<span style="color: ${mainTextColor};">Orange</span> <span style="color: ${colors.primary};">Vapor</span>`; }
             logoContainerEl.appendChild(logoEl);
             creativeEl.appendChild(logoContainerEl);

             // Contenido de Texto (Adaptado a nuevos campos)
             const contentEl = document.createElement('div');
             contentEl.className = 'creative-content';
             contentEl.style.color = mainTextColor; // Color principal para textos

             const hookEl = document.createElement('div'); hookEl.className = 'creative-hook'; hookEl.textContent = adData.hook; contentEl.appendChild(hookEl);
             const offerEl = document.createElement('div'); offerEl.className = 'creative-offer'; offerEl.textContent = adData.offer; contentEl.appendChild(offerEl);
             const benefitEl = document.createElement('div'); benefitEl.className = 'creative-benefit'; benefitEl.textContent = adData.benefit; contentEl.appendChild(benefitEl);

             // CTA Visual (Bot√≥n simulado)
             const ctaEl = document.createElement('a'); // Usar 'a' aunque no tenga link real en preview
             ctaEl.className = 'creative-cta-visual';
             ctaEl.textContent = adData.cta;
             // El color de fondo y texto se definen con variables CSS arriba
             contentEl.appendChild(ctaEl);

             // Credibilidad (si existe)
             if (adData.credibility) {
                 const credibilityEl = document.createElement('div'); credibilityEl.className = 'creative-credibility'; credibilityEl.textContent = adData.credibility; contentEl.appendChild(credibilityEl);
             }

             creativeEl.appendChild(contentEl);

             // Acento Lateral
             const accentEl = document.createElement('div'); accentEl.className = 'creative-accent'; accentEl.style.background = accentColor; creativeEl.appendChild(accentEl);

             // Bot√≥n Descarga Overlay
             const downloadOverlayEl = document.createElement('div'); downloadOverlayEl.className = 'creative-download'; downloadOverlayEl.innerHTML = `<i class="fas fa-download"></i>`; downloadOverlayEl.addEventListener('click', (e) => { e.stopPropagation(); generateAndDownloadImage(); }); creativeEl.appendChild(downloadOverlayEl);

             creativeEl.addEventListener('click', generateAndDownloadImage);
             creativesContainer.appendChild(creativeEl);
             updateAdCopy();
        }

        function updateAdCopy() { // Actualiza copy del post
             adCopyText.textContent = adCopyData[activeService] || "Seleccion√° un concepto de anuncio.";
             copyBtn.innerHTML='<i class="fas fa-copy"></i> Copiar';
        }
        function showLoadingModal(message="Generando...") { loadingMessage.textContent=message;loadingModal.style.display='flex'; }
        function hideLoadingModal() { loadingModal.style.display='none'; }

        // --- CANVAS DRAWING (Versi√≥n FUNCIONAL Anterior + Contenido Nuevo) ---
        function generateAndDownloadImage() {
            if (isProcessing) return;
            isProcessing = true;
            showLoadingModal();
            console.log(`[Start] Generating Ad: ${activeService}, Format: ${activeFormat}, BG Color Key: ${activeColor}`);

            requestAnimationFrame(() => {
                setTimeout(() => { // Delay
                    try {
                        const adData = creativesData[activeService];
                        if (!adData) throw new Error(`Datos de anuncio no encontrados: ${activeService}`);

                        const isVertical = activeFormat === 'vertical';
                        const width = 1080;
                        const height = isVertical ? 1920 : 1080;
                        downloadCanvas.width = width;
                        downloadCanvas.height = height;
                        const ctx = downloadCanvas.getContext('2d');
                        ctx.clearRect(0, 0, width, height);

                        // Colores
                        const mainBgColor = getMainBgColor();
                        const serviceColor = getServiceColor(activeService); // Color del CONCEPTO
                        const mainTextColor = getTextColor(mainBgColor);
                        const bannerTextColor = getTextColor(serviceColor);
                        const accentColor = getAccentColor(mainBgColor, serviceColor);
                        console.log(`[Canvas] Concept: ${activeService}, Banner Color: ${serviceColor}, Banner Text: ${bannerTextColor}, Main BG: ${mainBgColor}, Main Text: ${mainTextColor}`);


                        // --- DIBUJAR (L√≥gica FUNCIONAL anterior adaptada a nuevos datos) ---

                        // 1. Fondo
                        ctx.fillStyle = mainBgColor;
                        ctx.fillRect(0, 0, width, height);

                        // 2. Banner Superior
                        const bannerHeight = isVertical ? 100 : 80; // Altura banner
                        ctx.fillStyle = serviceColor; // Color del CONCEPTO
                        ctx.fillRect(0, 0, width, bannerHeight);
                        const bannerText = serviceBannerNames[activeService] || 'ORANGE VAPOR';
                        const bannerFontSize = isVertical ? 45 : 40;
                        ctx.font = `bold ${bannerFontSize}px Montserrat, sans-serif`;
                        ctx.fillStyle = bannerTextColor; // Texto contrastante
                        ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
                        ctx.fillText(bannerText, width / 2, bannerHeight / 2);

                         // --- ZONA SEGURA (B√°sica - margen superior simple) ---
                         // Dejamos espacio arriba en vertical, pero menos estricto que antes para simplicidad
                        const safeTopMargin = isVertical ? 150 : bannerHeight + 20; // Espacio arriba
                        const safeBottomMargin = isVertical ? 100 : 40;
                        const safeZoneY = safeTopMargin;
                        const safeZoneHeight = height - safeTopMargin - safeBottomMargin;
                        const textMaxWidth = width - 140; // Margen lateral texto


                        // 3. Logo (Debajo del banner, respetando margen superior simple)
                        const logoFontSize = isVertical ? 36 : 32;
                        ctx.font = `bold ${logoFontSize}px Montserrat, sans-serif`;
                        ctx.textAlign = 'left'; ctx.textBaseline = 'top';
                        const logoX = 70;
                        const logoY = isVertical ? safeZoneY : bannerHeight + 30; // Empieza en margen o bajo banner
                        // Color Logo
                        if (activeColor === 'white') { ctx.fillStyle = colors.dark; ctx.fillText('Orange', logoX, logoY); ctx.fillStyle = colors.primary; ctx.fillText('Vapor', logoX + ctx.measureText('Orange ').width, logoY); }
                        else if (mainBgColor === colors.primary && activeColor !== 'original_service') { ctx.fillStyle = colors.light; ctx.fillText('Orange Vapor', logoX, logoY); }
                        else { ctx.fillStyle = mainTextColor; ctx.fillText('Orange', logoX, logoY); ctx.fillStyle = colors.primary; ctx.fillText('Vapor', logoX + ctx.measureText('Orange ').width, logoY); }


                        // 4. Bloque de Texto Principal (Hook, Offer, Benefit, CTA, Credibility)
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'top'; // Alinear desde arriba
                        ctx.fillStyle = mainTextColor;

                        // Tama√±os y Espacios
                        const hookFontSize = isVertical ? 75 : 65;
                        const hookLineHeight = hookFontSize * 1.15;
                        const offerFontSize = isVertical ? 48 : 42;
                        const offerLineHeight = offerFontSize * 1.2;
                        const benefitFontSize = isVertical ? 38 : 34;
                        const benefitLineHeight = benefitFontSize * 1.3;
                        const ctaFontSize = isVertical ? 42 : 38;
                        const credibilityFontSize = isVertical ? 26 : 22;

                        const spaceOffer = 30;
                        const spaceBenefit = 25;
                        const spaceCta = 40;
                        const spaceCred = 15;

                        // Calcular Altura Total (aproximada para centrar)
                        const measureCtx = downloadCanvas.getContext('2d'); // Contexto para medir
                        measureCtx.font = `800 ${hookFontSize}px Montserrat, sans-serif`; // Usar 800 bold para hook
                        const hookInfo = wrapTextAndMeasure(measureCtx, adData.hook, textMaxWidth, hookLineHeight);
                        measureCtx.font = `700 ${offerFontSize}px Montserrat, sans-serif`; // Bold para offer
                        const offerInfo = wrapTextAndMeasure(measureCtx, adData.offer, textMaxWidth * 0.9, offerLineHeight); // MaxWidth menor para recuadro
                        measureCtx.font = `${benefitFontSize}px Montserrat, sans-serif`;
                        const benefitInfo = wrapTextAndMeasure(measureCtx, adData.benefit, textMaxWidth, benefitLineHeight);
                        measureCtx.font = `bold ${ctaFontSize}px Montserrat, sans-serif`; // Bold para CTA
                        const ctaInfo = wrapTextAndMeasure(measureCtx, adData.cta, textMaxWidth * 0.8, ctaFontSize * 1.2); // MaxWidth menor
                        measureCtx.font = `500 ${credibilityFontSize}px Montserrat, sans-serif`; // Medium para cred
                        const credInfo = wrapTextAndMeasure(measureCtx, adData.credibility || '', textMaxWidth, credibilityFontSize * 1.2);

                        const totalTextBlockHeight = hookInfo.height + spaceOffer + offerInfo.height + spaceBenefit + benefitInfo.height + spaceCta + ctaInfo.height + (credInfo.lines > 0 ? spaceCred + credInfo.height : 0);

                        // Calcular Y inicial para centrar bloque en zona segura (bajo logo)
                        const availableTextHeight = height - logoY - logoFontSize - safeBottomMargin - 20;
                        const textBlockStartY = logoY + logoFontSize + Math.max(30, (availableTextHeight - totalTextBlockHeight) / 2); // M√≠nimo 30px bajo logo

                        // -- Dibujar Textos --
                        let currentY = textBlockStartY;

                        // Hook
                        ctx.font = `800 ${hookFontSize}px Montserrat, sans-serif`;
                        const hookDrawInfo = wrapTextAndDraw(ctx, adData.hook, width / 2, currentY, textMaxWidth, hookLineHeight);
                        currentY = hookDrawInfo.endY + spaceOffer;

                        // Offer (con recuadro simulado)
                        ctx.font = `700 ${offerFontSize}px Montserrat, sans-serif`;
                        // Dibujar recuadro primero (si hay texto)
                        if (offerInfo.lines > 0) {
                            const offerTextWidth = measureCtx.measureText(adData.offer.length > 25 ? adData.offer.substring(0,22)+'...' : adData.offer).width * 1.05; // Ancho aprox
                            const offerRectWidth = Math.min(textMaxWidth * 0.9, offerTextWidth);
                            const offerRectHeight = offerInfo.height + 15; // Padding vertical recuadro
                            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)'; // Color recuadro
                            // Centrar recuadro
                            ctx.fillRect(width/2 - offerRectWidth/2, currentY - 7, offerRectWidth, offerRectHeight);
                        }
                        // Dibujar texto encima
                        ctx.fillStyle = mainTextColor; // Restaurar color texto
                        const offerDrawInfo = wrapTextAndDraw(ctx, adData.offer, width / 2, currentY, textMaxWidth * 0.9, offerLineHeight);
                        currentY = offerDrawInfo.endY + spaceBenefit;


                        // Benefit
                        ctx.font = `${benefitFontSize}px Montserrat, sans-serif`;
                        const benefitDrawInfo = wrapTextAndDraw(ctx, adData.benefit, width / 2, currentY, textMaxWidth, benefitLineHeight);
                        currentY = benefitDrawInfo.endY + spaceCta;

                        // CTA (Bot√≥n simulado)
                        ctx.font = `bold ${ctaFontSize}px Montserrat, sans-serif`;
                         if (ctaInfo.lines > 0) {
                            const ctaTextWidth = measureCtx.measureText(adData.cta).width * 1.1; // Ancho aprox
                            const ctaRectWidth = Math.min(textMaxWidth * 0.8, ctaTextWidth);
                            const ctaRectHeight = ctaInfo.height + 20; // Padding vertical
                            const ctaRectY = currentY - 10;
                            // Dibujar bot√≥n
                            ctx.fillStyle = serviceColor; // Usar color del servicio para el bot√≥n
                            ctx.fillRect(width/2 - ctaRectWidth/2, ctaRectY, ctaRectWidth, ctaRectHeight);
                            // Dibujar texto del bot√≥n
                            ctx.fillStyle = bannerTextColor; // Texto contrastante
                            wrapTextAndDraw(ctx, adData.cta, width / 2, currentY, textMaxWidth * 0.8, ctaFontSize * 1.2);
                            currentY += ctaInfo.height + spaceCred;
                         }


                        // Credibility
                        if (credInfo.lines > 0) {
                            ctx.font = `500 ${credibilityFontSize}px Montserrat, sans-serif`;
                            ctx.fillStyle = mainTextColor; // Color normal
                            ctx.globalAlpha = 0.9; // Un poco transparente
                            wrapTextAndDraw(ctx, adData.credibility, width / 2, currentY, textMaxWidth, credibilityFontSize * 1.2);
                            ctx.globalAlpha = 1.0; // Restaurar opacidad
                        }


                        // 5. Acento Lateral (posici√≥n simple)
                         ctx.fillStyle = accentColor;
                         const accentWidth = isVertical ? 18 : 12;
                         const accentHeight = isVertical ? 120 : 80;
                         let accentY = textBlockStartY + (totalTextBlockHeight / 2) - (accentHeight / 2); // Centro del bloque
                         accentY = Math.max(bannerHeight + 10, Math.min(accentY, height - accentHeight - 10));
                         ctx.fillRect(0, accentY, accentWidth, accentHeight);


                        // 6. Descargar
                        const dataUrl = downloadCanvas.toDataURL('image/png');
                        const link = document.createElement('a');
                        link.href = dataUrl;
                        link.download = `instagram-ad-${activeService}-${activeColor}-${activeFormat}.png`;
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        console.log(`[Success] Image downloaded: ${link.download}`);

                        hideLoadingModal();
                        isProcessing = false;

                    } catch (error) {
                        console.error('Error al generar/descargar Ad:', error);
                        hideLoadingModal();
                        alert(`Hubo un error: ${error.message}. Intent√° de nuevo.`);
                        isProcessing = false;
                    }
                }, 100);
            });
        }

        // --- Wrap Text Helpers (sin cambios) ---
        function wrapTextAndMeasure(ctx,text,maxWidth,lineHeight){const words=text.split(/[\s\n]+/);let line='';let lines=0;let currentY=0;if(!text||text.trim()==='')return{lines:0,height:0,endY:0};for(let n=0;n<words.length;n++){const testLine=line+words[n]+' ';const metrics=ctx.measureText(testLine);if(metrics.width>maxWidth&&n>0){lines++;currentY+=lineHeight;line=words[n]+' '}else{line=testLine}}lines++;const totalHeight=lines*lineHeight;return{lines:lines,height:totalHeight,endY:currentY+lineHeight}}
        function wrapTextAndDraw(ctx,text,x,y,maxWidth,lineHeight){const words=text.split(/[\s\n]+/);let line='';let currentY=y;let lines=0;if(!text||text.trim()==='')return{lines:0,endY:y};for(let n=0;n<words.length;n++){const testLine=line+words[n]+' ';const metrics=ctx.measureText(testLine);if(metrics.width>maxWidth&&n>0){ctx.fillText(line.trim(),x,currentY);currentY+=lineHeight;lines++;line=words[n]+' '}else{line=testLine}}ctx.fillText(line.trim(),x,currentY);lines++;return{lines:lines,endY:currentY+lineHeight}}

        // --- UI Update & Event Listeners ---
        function updateUI() {
             serviceTitle.textContent = getServiceFriendlyName(activeService);
             tabButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.service === activeService));
             formatButtons.forEach(btn => btn.classList.remove('active'));
             document.getElementById(activeFormat === 'square' ? 'squareBtn' : 'verticalBtn').classList.add('active');
             // Ajustar bot√≥n de color activo
             colorButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.color === activeColor));
             renderCreative();
        }

        // Event Listeners (Ajustar para nuevos data-service)
        tabButtons.forEach(btn => btn.addEventListener('click', () => { if(isProcessing) return; activeService = btn.dataset.service; updateUI(); }));
        squareBtn.addEventListener('click', () => { if(isProcessing) return; activeFormat = 'square'; updateUI(); });
        verticalBtn.addEventListener('click', () => { if(isProcessing) return; activeFormat = 'vertical'; updateUI(); });
        colorButtons.forEach(btn => btn.addEventListener('click', () => { if(isProcessing) return; activeColor = btn.dataset.color; updateUI(); })); // Incluir 'original_service'
        downloadBtn.addEventListener('click', generateAndDownloadImage);
        copyBtn.addEventListener('click', () => { /* ... (copy logic) ... */
            const textToCopy=adCopyText.textContent||adCopyText.innerText;navigator.clipboard.writeText(textToCopy).then(()=>{copyBtn.innerHTML='<i class="fas fa-check"></i> Copiado!';setTimeout(()=>{copyBtn.innerHTML='<i class="fas fa-copy"></i> Copiar'},2000)}).catch(err=>{console.error('Error al copiar: ',err);copyBtn.innerHTML='<i class="fas fa-times"></i> Error';setTimeout(()=>{copyBtn.innerHTML='<i class="fas fa-copy"></i> Copiar'},2000)})
        });
        togglePracticesBtn.addEventListener('click', () => { const isHidden=bestPracticesBox.style.display==='none'||bestPracticesBox.style.display==='';bestPracticesBox.style.display=isHidden?'block':'none';togglePracticesBtn.textContent=isHidden?'Ocultar Tips':'Ver Tips Anuncios Instagram' });

        // Initial Load
        updateUI();

    </script>
</body>
</html>
