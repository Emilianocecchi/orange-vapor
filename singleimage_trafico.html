<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador Creativos Orange Vapor</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- Estilos Restaurados y Optimizados --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Montserrat', sans-serif; background-color: #f0f2f5; padding: 20px; color: #333; }
        .container { max-width: 1200px; margin: 20px auto; padding: 25px; background-color: white; border-radius: 10px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08); }

        /* Header */
        .header { text-align: center; margin-bottom: 25px; border-bottom: 1px solid #e0e0e0; padding-bottom: 20px; }
        .header h1 { font-size: 24px; font-weight: 700; color: #2c3e50; margin-bottom: 5px; }
        .header p { color: #555; font-size: 15px; }

        /* Tabs - Servicios Originales + Nuevos Ads */
        .tabs { display: flex; justify-content: center; flex-wrap: wrap; margin-bottom: 25px; gap: 8px; border-bottom: 1px solid #eee; padding-bottom: 15px;}
        .tab-group { display: flex; flex-wrap: wrap; justify-content: center; gap: 5px; width: 100%;}
        .tab-group-label { width: 100%; text-align: center; font-size: 11px; font-weight: 600; color: #888; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; }

        .tab-button {
            padding: 8px 12px; font-size: 11px; font-weight: 600; background-color: #fff; color: #444;
            border: 1px solid #ccc; cursor: pointer; transition: all 0.25s ease; border-radius: 6px;
            display: flex; align-items: center; gap: 5px; white-space: nowrap;
        }
        .tab-button i { font-size: 0.9em; margin-right: 2px; }
        .tab-button:hover { background-color: #f8f9fa; border-color: #aaa; }
        .tab-button.active { color: white; border-color: transparent; }

        /* Colores espec√≠ficos por servicio/ad */
        .tab-button.auditoria.active, .tab-button.ad_auditoria_gratis.active { background-color: #28a745; } /* Verde */
        .tab-button.optimizacion.active, .tab-button.ad_optimizacion_express.active { background-color: #dc3545; } /* Rojo */
        .tab-button.meta.active, .tab-button.ad_meta_ads.active { background-color: #1877F2; } /* Azul Meta */
        .tab-button.google.active, .tab-button.ad_google_ads.active { background-color: #4285F4; } /* Azul Google */
        .tab-button.email.active, .tab-button.ad_email_marketing.active { background-color: #00829b; } /* Teal Email */
        .tab-button.chatbot.active, .tab-button.ad_chatbot.active { background-color: #6f42c1; } /* Violeta Chatbot */
        .tab-button.all.active, .tab-button.ad_paquete_completo.active { background-color: #343a40; } /* Gris oscuro */

        /* Controles (Formato, Color Fondo) */
        .controls-grid { display: flex; justify-content: center; align-items: center; gap: 30px; margin-bottom: 25px; flex-wrap: wrap;}
        .control-group { text-align: center; }
        .control-group label { display: block; font-size: 13px; font-weight: 600; margin-bottom: 8px; color: #555; }
        .format-toggle, .color-toggle { display: inline-flex; gap: 8px; }

        .format-btn { padding: 7px 14px; font-size: 13px; border: 1px solid #ccc; border-radius: 4px; background-color: white; cursor: pointer; transition: all 0.2s ease; }
        .format-btn.active { background-color: #ff7e00; color: white; border-color: #ff7e00; }

        .color-btn { width: 30px; height: 30px; border-radius: 50%; cursor: pointer; border: 2px solid #ddd; transition: all 0.2s ease; display: inline-block; vertical-align: middle; }
        .color-btn.active { border-color: #ff7e00; transform: scale(1.15); box-shadow: 0 0 5px rgba(255,126,0,0.5); }
        .color-btn-orange { background-color: #ff7e00; }
        .color-btn-white { background-color: #ffffff; border-color: #ccc; }
        .color-btn-black { background-color: #181818; }
        .color-btn-service { background: linear-gradient(45deg, #28a745, #1877F2, #6f42c1); }

        /* Download Button */
        .download-section { text-align: center; margin-bottom: 25px; }
        .download-btn { background: #ff7e00; color: white; border: none; padding: 12px 25px; font-size: 16px; font-weight: 700; border-radius: 6px; cursor: pointer; display: inline-flex; align-items: center; gap: 10px; box-shadow: 0 4px 8px rgba(255, 126, 0, 0.3); transition: all 0.3s ease; }
        .download-btn:hover { background: #e67300; transform: translateY(-2px); box-shadow: 0 6px 12px rgba(255, 126, 0, 0.35); }
        .download-btn i { font-size: 1.1em; }

        /* Info Box & Tips */
        .info-box { background-color: #e9ecef; border-left: 5px solid #007bff; padding: 15px 20px; margin: 25px auto; max-width: 850px; border-radius: 5px; display: flex; align-items: flex-start; gap: 15px; font-size: 13px; line-height: 1.6; }
        .info-box i { color: #007bff; font-size: 20px; margin-top: 2px; flex-shrink: 0; }
        .info-box strong { font-weight: 600; }

        .toggle-practices { display: block; margin: 15px auto; background: #6c757d; color: white; border: none; padding: 6px 12px; font-size: 12px; font-weight: 500; cursor: pointer; border-radius: 4px; transition: background-color 0.2s; }
        .toggle-practices:hover { background: #5a6268; }
        .best-practices { background-color: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px 20px; margin: 15px 0; display: none; }
        .best-practices h3 { font-size: 14px; color: #343a40; margin-bottom: 12px; }
        .best-practices ul { list-style-type: disc; margin-left: 20px; padding-left: 5px; }
        .best-practices li { font-size: 12px; margin-bottom: 5px; color: #495057; }

        /* Creative Preview Area */
        .creatives-container { display: flex; flex-wrap: wrap; justify-content: center; margin-top: 20px; gap: 20px; padding: 20px; background-color: #f8f9fa; border-radius: 8px; }
        .creative { width: 360px; height: 360px; position: relative; border-radius: 8px; overflow: hidden; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15); color: white; cursor: pointer; background-color: #e0e0e0; }
        .creative-vertical { width: 240px; height: 427px; }

        /* Banner Superior (Solo para Ads nuevos) */
        .creative-service-banner { display: none; /* Oculto por defecto */ }
        .creative.is-ad-concept .creative-service-banner { /* Mostrar solo si es Ad Concept */
            display: flex; position: absolute; top: 0; left: 0; width: 100%; height: 35px;
            background-color: var(--service-color, #333); color: var(--banner-text-color, white);
            align-items: center; justify-content: center; font-size: 13px; font-weight: 700;
            z-index: 5; text-transform: uppercase; letter-spacing: 0.5px;
        }

        /* Content & Text Elements */
        .creative-content { position: relative; z-index: 2; padding: 20px; /* Padding base */ height: 100%; display: flex; flex-direction: column; justify-content: center; text-align: center; }

        /* Ajustes para Ad Concepts (con banner) */
        .creative.is-ad-concept .creative-content { padding-top: 55px; /* M√°s espacio para banner+logo */ }
        .creative.is-ad-concept.creative-vertical .creative-content { padding-top: 15%; padding-bottom: 10%; /* Zona segura */ }

        /* Estilos para elementos AD CONCEPT */
        .creative-hook { font-size: 22px; font-weight: 800; margin-bottom: 12px; line-height: 1.25; }
        .creative-offer { font-size: 17px; font-weight: 700; margin-bottom: 10px; line-height: 1.2; padding: 4px 8px; background-color: rgba(0, 0, 0, 0.15); border-radius: 4px; display: inline-block; }
        .creative-benefit { font-size: 13px; line-height: 1.4; margin-bottom: 12px; }
        .creative-cta-visual { font-size: 14px; font-weight: bold; padding: 8px 15px; background-color: var(--service-color, #ff7e00); color: var(--banner-text-color, white); border-radius: 5px; display: inline-block; text-decoration: none; margin-top: 8px; }
        .creative-credibility { font-size: 10px; margin-top: 8px; opacity: 0.85; font-weight: 500; }

        /* Estilos para elementos ORIGINALES */
        .creative-title { font-size: 22px; font-weight: 800; margin-bottom: 10px; line-height: 1.2; }
        .creative-subtitle { font-size: 18px; font-weight: 600; margin-bottom: 10px; line-height: 1.2; }
        .creative-description { font-size: 14px; line-height: 1.4; }

        /* Logo */
        .logo-container { position: absolute; top: 15px; left: 15px; z-index: 20; text-align: left; }
        /* Ajuste logo cuando hay banner */
        .creative.is-ad-concept .logo-container { top: 43px; }
        .creative.is-ad-concept.creative-vertical .logo-container { top: calc(14% + 5px); } /* Zona segura */
        .logo-container div { font-size: 10px !important; font-weight: bold; }


        /* Accent */
        .creative-accent { position: absolute; left: 0; top: 50%; transform: translateY(-50%); width: 5px; height: 60px; background: white; border-radius: 0 2px 2px 0; z-index: 10; }
        .creative-vertical .creative-accent { height: 80px; }

        /* Download Overlay */
        .creative-download { position: absolute; top: 5px; right: 5px; width: 28px; height: 28px; border-radius: 50%; background: rgba(0, 0, 0, 0.6); display: flex; align-items: center; justify-content: center; cursor: pointer; opacity: 0; transition: opacity 0.3s; z-index: 30; }
        .creative-download i { font-size: 12px; color: white;}
        .creative:hover .creative-download { opacity: 1; }

        /* Ad Copy Section ... (sin cambios) */
        /* Note & Loading Modal ... (sin cambios) */
         .ad-copy-section { margin-top: 30px; border-top: 1px solid #e0e0e0; padding-top: 25px; }
        .ad-copy-section h3 { font-size: 16px; color: #343a40; text-align: center; margin-bottom: 15px; font-weight: 600; }
        .ad-copy-container { background-color: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); max-width: 750px; margin: 0 auto; }
        .ad-copy-text { font-size: 14px; line-height: 1.65; color: #333; white-space: pre-line; }
        .copy-btn { background: #e9ecef; border: 1px solid #ced4da; border-radius: 4px; padding: 8px 15px; font-size: 13px; color: #495057; cursor: pointer; display: flex; align-items: center; justify-content: center; margin: 15px auto 0; transition: all 0.2s ease; }
        .copy-btn:hover { background-color: #dee2e6; }
        .copy-btn i { margin-right: 6px; }
        .note { text-align: center; margin-top: 20px; color: #6c757d; font-size: 11px; }
        .loading-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.65); display: none; justify-content: center; align-items: center; z-index: 9999; }
        .loading-container { background-color: #fff; padding: 25px 35px; border-radius: 8px; box-shadow: 0 5px 25px rgba(0,0,0,0.2); text-align: center; }
        .loading-spinner { display: inline-block; width: 28px; height: 28px; border: 3px solid rgba(0,0,0,.1); border-radius: 50%; border-top-color: #ff7e00; animation: spin 0.8s ease-in-out infinite; margin-bottom: 12px; }
        #loadingMessage { font-size: 14px; color: #555;}
        @keyframes spin { to { transform: rotate(360deg); } }
        #downloadCanvas { position: absolute; left: -9999px; top: -9999px; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
             <h1 id="serviceTitle">Generador Creativos Orange Vapor</h1>
             <p>Cre√° visuales para Tr√°fico o Anuncios espec√≠ficos de Instagram.</p>
         </div>

        <!-- Tabs Separados -->
        <div class="tabs">
             <div class="tab-group">
                 <span class="tab-group-label">Creativos Originales (Tr√°fico)</span>
                 <button class="tab-button auditoria active" data-service="auditoria"><i class="fas fa-search"></i>Auditor√≠a</button>
                 <button class="tab-button optimizacion" data-service="optimizacion"><i class="fas fa-tachometer-alt"></i>Optimizaci√≥n</button>
                 <button class="tab-button meta" data-service="meta"><i class="fab fa-facebook"></i>Meta</button>
                 <button class="tab-button google" data-service="google"><i class="fab fa-google"></i>Google</button>
                 <button class="tab-button email" data-service="email"><i class="fas fa-envelope"></i>Email</button>
                 <button class="tab-button chatbot" data-service="chatbot"><i class="fas fa-robot"></i>Chatbot</button>
                 <button class="tab-button all" data-service="all"><i class="fas fa-archive"></i>Pack</button>
             </div>
             <div class="tab-group">
                 <span class="tab-group-label">Nuevos Anuncios (Instagram)</span>
                 <button class="tab-button ad_auditoria_gratis" data-service="ad_auditoria_gratis"><i class="fas fa-search-dollar"></i>AD: Auditor√≠a</button>
                 <button class="tab-button ad_optimizacion_express" data-service="ad_optimizacion_express"><i class="fas fa-bolt"></i>AD: Express</button>
                 <button class="tab-button ad_meta_ads" data-service="ad_meta_ads"><i class="fab fa-facebook-square"></i>AD: Meta</button>
                 <button class="tab-button ad_google_ads" data-service="ad_google_ads"><i class="fab fa-google"></i>AD: Google</button>
                 <button class="tab-button ad_email_marketing" data-service="ad_email_marketing"><i class="fas fa-envelope-open-text"></i>AD: Email</button>
                 <button class="tab-button ad_chatbot" data-service="ad_chatbot"><i class="fas fa-comment-dots"></i>AD: Chatbot</button>
                 <button class="tab-button ad_paquete_completo" data-service="ad_paquete_completo"><i class="fas fa-boxes"></i>AD: Pack</button>
             </div>
         </div>

         <!-- Controles -->
         <div class="controls-grid">
            <div class="control-group">
               <label for="format-toggle">Formato</label>
               <div class="format-toggle" id="format-toggle">
                   <button id="squareBtn" class="format-btn active">Cuadrado</button>
                   <button id="verticalBtn" class="format-btn">Vertical</button>
               </div>
            </div>
            <div class="control-group">
               <label for="color-toggle">Color de Fondo Principal</label>
               <div class="color-toggle" id="color-toggle">
                   <div class="color-btn color-btn-orange active" data-color="orange" title="Fondo Naranja"></div>
                   <div class="color-btn color-btn-white" data-color="white" title="Fondo Blanco"></div>
                   <div class="color-btn color-btn-black" data-color="black" title="Fondo Negro"></div>
                   <div class="color-btn color-btn-service" data-color="original_service" title="Fondo Color Servicio"></div>
               </div>
            </div>
        </div>


        <!-- Bot√≥n Descarga -->
        <div class="download-section">
            <button id="downloadBtn" class="download-btn">
                <i class="fas fa-download"></i> Descargar Creativo
            </button>
        </div>

        <!-- Info Box -->
        <div class="info-box">
            <i class="fas fa-info-circle"></i>
            <div>
                <p>Eleg√≠ un tipo de creativo (Original o Anuncio IG), formato y color de fondo. Los anuncios IG tienen un dise√±o diferente con banner y CTA visual.</p>
                <p><strong>Vertical + Anuncio IG:</strong> respeta zona segura de Stories.</p>
            </div>
        </div>

        <!-- Toggle Tips -->
        <button class="toggle-practices" id="togglePractices">Ver Tips</button>
        <div class="best-practices">
             <h3>Tips Anuncios Instagram:</h3>
             <ul>
                 <li>Hook visual/texto potente y claro.</li>
                 <li>Propuesta de valor directa EN la imagen.</li>
                 <li>Beneficio clave conciso EN la imagen.</li>
                 <li>CTA (llamada a la acci√≥n) visible.</li>
                 <li>Branding (logo) presente.</li>
                 <li>Respetar zona segura en vertical (Stories).</li>
             </ul>
              <h3>Tips Creativos Originales (Tr√°fico):</h3>
             <ul>
                <li>Mensajes intrigantes que fomenten el clic.</li>
                <li>Im√°genes de alto impacto visual.</li>
                <li>Menos del 20% de texto (Meta Ads).</li>
                <li>Propuesta de valor clara del destino.</li>
                <li>CTA enfocado en visitar/descubrir.</li>
            </ul>
        </div>


        <!-- Previsualizaci√≥n -->
        <div id="creativesContainer" class="creatives-container">
            <!-- Creativo din√°mico aqu√≠ -->
        </div>

        <div class="note">Dimensiones: 1080x1080px (Cuadrado/Feed), 1080x1920px (Vertical/Stories).</div>

        <!-- Ad Copy -->
        <div class="ad-copy-section">
            <h3 id="adCopyTitle">Copy Sugerido para Post (Voseo)</h3>
            <div class="ad-copy-container"><p id="adCopyText" class="ad-copy-text"></p><button id="copyBtn" class="copy-btn"><i class="fas fa-copy"></i> Copiar</button></div>
        </div>

        <!-- Canvas y Modal -->
        <canvas id="downloadCanvas"></canvas>
        <div id="loadingModal" class="loading-modal"> <div class="loading-container"> <div class="loading-spinner"></div> <div id="loadingMessage">Generando...</div> </div> </div>
    </div>

    <script>
        const colors = { // Colores base y de servicios
            primary: '#ff7e00', dark: '#181818', light: '#ffffff',
            // Colores espec√≠ficos por servicio (para banner y CTA de Ads)
            auditoria_color: '#28a745', express_color: '#dc3545', meta_color: '#1877F2',
            google_color: '#4285F4', email_color: '#00829b', chatbot_color: '#6f42c1', all_color: '#343a40',
        };

        // --- DATOS PARA CREATIVOS ORIGINALES (Tr√°fico) ---
        const originalCreativesData = {
             auditoria: { title: '¬øTUS ADS GENERAN ROI REAL?', subtitle: 'DESCUBR√ç LA VERDAD AHORA', description: 'Auditor√≠a gratuita de tus campa√±as.\nAn√°lisis experto sin compromiso.', bgColor: colors.auditoria_color },
             optimizacion: { title: 'EVIT√Å PERDER PRESUPUESTO', subtitle: 'OPTIMIZ√Å TUS ADS EN 48HS', description: 'Sistema anti-fugas de presupuesto.\nAument√° conversiones.', bgColor: colors.express_color }, // NOTA: BG Color express aqu√≠
             meta: { title: 'MULTIPLIC√Å TUS VENTAS', subtitle: 'ROAS 2.8X GARANTIZADO', description: 'Campa√±as de Meta Ads que convierten.\nEstrategia personalizada.', bgColor: colors.meta_color },
             google: { title: 'CONVERT√ç B√öSQUEDAS EN VENTAS', subtitle: 'DOMIN√Å GOOGLE ADS AHORA', description: 'Palabras clave rentables ‚Ä¢ ROAS 2.8X.\nReducci√≥n del CPA.', bgColor: colors.google_color },
             email: { title: 'EMAIL MKT AUTOMATIZADO', subtitle: '38% TASA DE APERTURA', description: 'Convert√≠ suscriptores en clientes.\nIngresos recurrentes.', bgColor: colors.email_color },
             chatbot: { title: 'ATENCI√ìN AL CLIENTE 24/7', subtitle: 'AUTOMATIZACI√ìN INTELIGENTE', description: 'Reduc√≠ costos operativos.\nCaptur√° leads autom√°ticamente.', bgColor: colors.chatbot_color },
             all: { title: 'ESTRATEGIA DIGITAL COMPLETA', subtitle: 'AHORR√Å US$200/MES', description: 'Meta Ads ‚Ä¢ Google Ads ‚Ä¢ Email ‚Ä¢ Chatbot.\nTodo por US$1000/mes.', bgColor: colors.all_color }
        };

        // --- DATOS PARA NUEVOS ANUNCIOS (Instagram) ---
        const adConceptData = {
             ad_auditoria_gratis: { hook: '¬øTus Ads No Rinden? üìâ', offer: 'AUDITOR√çA DE ADS GRATIS', benefit: 'Descubr√≠ por qu√© y c√≥mo solucionarlo.', cta: 'Agend√° Tu Auditor√≠a', credibility: 'Sin costo, sin compromiso.', serviceColor: colors.auditoria_color },
             ad_optimizacion_express: { hook: '¬°SALV√Å TUS CAMPA√ëAS! ‚ö°', offer: 'OPTIMIZACI√ìN EXPRESS 48HS', benefit: 'Resultados r√°pidos por US$299.', cta: '¬°Optimiz√° Ya!', credibility: '*Garant√≠a ROI: Si no cumplimos KPIs, pag√°s la mitad.', serviceColor: colors.express_color },
             ad_meta_ads: { hook: '¬øFACEBOOK & INSTA NO VENDEN?', offer: 'GESTI√ìN META ADS', benefit: 'Maximiz√° tu ROI con expertos.', cta: 'Contrat√° por US$299/mes', credibility: 'Incluye optimizaci√≥n + 4 creativos/mes.', serviceColor: colors.meta_color },
             ad_google_ads: { hook: '¬øNO APAREC√âS EN GOOGLE?', offer: 'GESTI√ìN GOOGLE ADS', benefit: 'Atra√© clientes que buscan comprar.', cta: 'Contrat√° por US$299/mes', credibility: 'Palabras clave rentables + Optimizaci√≥n semanal.', serviceColor: colors.google_color },
             ad_email_marketing: { hook: "¬øTU LISTA NO CONVIERTE?", offer: "EMAIL MARKETING QUE VENDE", benefit: "Convert√≠ suscriptores en clientes.", cta: "Contrat√° por US$299/mes", credibility: "Secuencias + Campa√±as + Segmentaci√≥n.", serviceColor: colors.email_color },
             ad_chatbot: { hook: "¬øPERD√âS LEADS POR NO RESPONDER?", offer: "CHATBOT INTELIGENTE 24/7", benefit: "Captur√° m√°s clientes, autom√°ticamente.", cta: "Contrat√° por US$299/mes", credibility: "Atenci√≥n inmediata + Flujos optimizados.", serviceColor: colors.chatbot_color },
             ad_paquete_completo: { hook: "¬°MARKETING DIGITAL INTEGRAL!", offer: "PAQUETE COMPLETO: AHORR√Å US$200", benefit: "Meta + Google + Email + Chatbot = M√°ximo ROI.", cta: "¬°Quiero el Pack por US$1000/mes!", credibility: "Todos tus canales optimizados.", serviceColor: colors.all_color }
        };

        // Nombres para Banner (solo Ads)
        const serviceBannerNames = {
             ad_auditoria_gratis: 'Auditor√≠a Gratis', ad_optimizacion_express: 'Optimizaci√≥n 48hs', ad_meta_ads: 'Meta Ads Mensual', ad_google_ads: 'Google Ads Mensual', ad_email_marketing: 'Email Marketing Mensual', ad_chatbot: 'Chatbot Mensual', ad_paquete_completo: 'Paquete Completo'
        };

        // --- COPIES PARA CADA SERVICIO/AD ---
        const adCopyData = {
             // Copies para originales (Voseo)
             auditoria: `üîç ¬øQU√â EST√Å FALLANDO EN TUS CAMPA√ëAS? üîç\n\n¬øSab√≠as que el 67% de las empresas invierten sin saber qu√© m√©tricas impactan sus ventas? üí°\n\nDescubr√≠ por qu√© tu competencia consigue mejores resultados...\n\n‚úÖ An√°lisis completo\n‚úÖ Identificaci√≥n de fugas de dinero\n‚úÖ Comparativa con competidores\n‚úÖ 100% gratis y sin compromiso\n\nüëâ Visit√° nuestra web (link en bio) y descubr√≠ oportunidades de crecimiento.\n\n¬°Cupos limitados! ¬øPor qu√© esperar?\n\n‚û°Ô∏è www.orangevapor.com`,
             optimizacion: `‚ö° TRANSFORM√Å TUS CAMPA√ëAS EN 48 HORAS ‚ö°\n\nCada d√≠a con campa√±as mal optimizadas = plata perdida üí∏\n\nNuestro sistema "Detecci√≥n de Fugas‚Ñ¢" revela:\n‚úÖ 63% del presupuesto se desperdicia.\n‚úÖ Segmentaci√≥n imprecisa = CPA elevados.\n‚úÖ ¬°Solo 3 ajustes clave pueden aumentar ventas!\n\nDiagn√≥stico + Estructura optimizada con garant√≠a.\n\n¬øQuer√©s detener el sangrado presupuestario AHORA? Visit√° (link en bio) üëá\nwww.orangevapor.com`,
             meta: `üì± MULTIPLIC√Å TUS VENTAS CON META ADS üì±\n\n¬øCu√°nto recuper√°s en ventas reales por cada $1 invertido en FB/IG? ü§î\n\nNuestros clientes: M√çNIMO 2.8x ROAS garantizado.\n\n‚úÖ 35% reducci√≥n promedio CPA.\n‚úÖ 45% m√°s conversiones (misma inversi√≥n).\n‚úÖ Gesti√≥n pro que maximiza cada peso.\n\n¬øQuer√©s aprovechar el verdadero potencial de Meta Ads? Hac√© clic (link en bio) üëá\nwww.orangevapor.com`,
             google: `üîé CONVERT√ç B√öSQUEDAS EN VENTAS CON GOOGLE ADS üîé\n\nMientras tu competencia lidera Google, ¬ød√≥nde est√°s vos? üëÄ\n\nPosicionate con:\n‚úÖ 2.8x ROAS m√≠nimo garantizado.\n‚úÖ Palabras clave RENTABLES.\n‚úÖ Optimizaci√≥n semanal de pujas.\n‚úÖ An√°lisis de competencia.\n\n¬°Aparec√© donde te buscan tus clientes! (Link en bio) üëá\nwww.orangevapor.com`,
             email: `üìß EMAIL MARKETING QUE GENERA INGRESOS 24/7 üìß\n\n¬°El Email Marketing tiene el ROI m√°s alto (3600% promedio)! üìà\n\n¬øEst√°s aprovechando tu base de datos?\n\n‚úÖ 38% tasa de apertura promedio.\n‚úÖ Secuencias autom√°ticas que convierten.\n‚úÖ Segmentaci√≥n estrat√©gica.\n‚úÖ Ingresos recurrentes (¬°mientras dorm√≠s!).\n\n¬°Transform√° tu email marketing! (Link en bio) üëá\nwww.orangevapor.com`,
             chatbot: `ü§ñ ATENCI√ìN AUTOMATIZADA QUE VENDE 24/7 ü§ñ\n\n¬øCu√°ntos leads y ventas perd√©s por no responder YA? ‚è∞\n\nChatbots inteligentes:\n‚úÖ Atenci√≥n instant√°nea 24/7.\n‚úÖ Reducci√≥n costos hasta 70%.\n‚úÖ Captura leads mientras dorm√≠s.\n‚úÖ Respuestas en minutos vs. horas.\n\n¬°No pierdas ni una oportunidad m√°s! (Link en bio) üëá\nwww.orangevapor.com`,
             all: `üöÄ MARKETING DIGITAL INTEGRADO: ¬°RESULTADOS GLOBALES! üöÄ\n\n¬øPor qu√© conformarte con poco? Ten√© una estrategia COMPLETA:\n\n‚úÖ Meta Ads (2.8x ROAS min.)\n‚úÖ Google Ads (Posicionamiento)\n‚úÖ Email Marketing (38% apertura)\n‚úÖ Chatbot (Atenci√≥n 24/7)\n\n¬°Ahorr√° casi US$200/mes con el paquete! Solo US$1000/mes.\n\nPotenci√° todos tus canales (Link en bio) üëá\nwww.orangevapor.com`,

             // Copies para Ads (ya estaban en Voseo)
             ad_auditoria_gratis: adCopyData.auditoria, // Reutilizar o ajustar si es necesario
             ad_optimizacion_express: adCopyData.optimizacion,
             ad_meta_ads: adCopyData.meta,
             ad_google_ads: adCopyData.google,
             ad_email_marketing: adCopyData.email,
             ad_chatbot: adCopyData.chatbot,
             ad_paquete_completo: adCopyData.all
        };


        // Estado inicial
        let activeService = 'auditoria'; // Empezar con el original
        let activeFormat = 'square';
        let activeColor = 'orange'; // Fondo naranja por defecto
        let isProcessing = false;

        // DOM Elements (sin cambios)
        const serviceTitle = document.getElementById('serviceTitle'); const creativesContainer = document.getElementById('creativesContainer'); const tabButtons = document.querySelectorAll('.tab-button'); const formatButtons = document.querySelectorAll('.format-btn'); const colorButtons = document.querySelectorAll('.color-btn'); const squareBtn = document.getElementById('squareBtn'); const verticalBtn = document.getElementById('verticalBtn'); const downloadBtn = document.getElementById('downloadBtn'); const togglePracticesBtn = document.getElementById('togglePractices'); const bestPracticesBox = document.querySelector('.best-practices'); const downloadCanvas = document.getElementById('downloadCanvas'); const adCopyText = document.getElementById('adCopyText'); const copyBtn = document.getElementById('copyBtn'); const loadingModal = document.getElementById('loadingModal'); const loadingMessage = document.getElementById('loadingMessage'); const adCopyTitle = document.getElementById('adCopyTitle');


        // --- Helper Functions ---
        function getServiceFriendlyName(service) {
             // Devuelve un nombre legible para el H1
             if (service.startsWith('ad_')) {
                 const base = service.substring(3).replace(/_/g, ' ');
                 return `Anuncio Instagram: ${base.charAt(0).toUpperCase() + base.slice(1)}`;
             } else {
                  const base = service.replace(/_/g, ' ');
                 return `Creativo Tr√°fico: ${base.charAt(0).toUpperCase() + base.slice(1)}`;
             }
        }
        function isAdConcept(service) { // Verifica si es un nuevo Ad Concept
            return service.startsWith('ad_');
        }
        function getMainBgColor() { /* ... (igual) ... */
            if(activeColor==='orange')return colors.primary;else if(activeColor==='white')return colors.light;else if(activeColor==='black')return colors.dark;else if(activeColor==='original_service')return getServiceColor(activeService);return colors.primary
        }
        function getServiceColor(service) { // Obtiene color espec√≠fico del servicio/concepto
             // Para Ads, usa el color definido en adConceptData
             if (isAdConcept(service)) {
                 return adConceptData[service]?.serviceColor || colors.dark;
             }
             // Para originales, usa el color definido en originalCreativesData
             else {
                 // Extraer el nombre base del color (ej: 'auditoria_color')
                 const baseServiceName = service.split('_')[0]; // 'auditoria', 'optimizacion', etc.
                 const colorKey = `${baseServiceName}_color`;
                 return colors[colorKey] || originalCreativesData[service]?.bgColor || colors.dark;
             }
        }
        function getTextColor(bgColor) { /* ... (igual, robusta) ... */
             if(!bgColor)return colors.dark;let r,g,b;if(bgColor.startsWith('#')){if(bgColor.length===4){r=parseInt(bgColor[1]+bgColor[1],16);g=parseInt(bgColor[2]+bgColor[2],16);b=parseInt(bgColor[3]+bgColor[3],16)}else if(bgColor.length===7){const bint=parseInt(bgColor.slice(1),16);r=(bint>>16)&255;g=(bint>>8)&255;b=bint&255}else{return colors.dark}}else if(bgColor.startsWith('rgb')){const m=bgColor.match(/\d+/g);if(!m||m.length<3)return colors.dark;[r,g,b]=m.map(Number)}else{return colors.dark}if(isNaN(r)||isNaN(g)||isNaN(b))return colors.dark;const l=(0.2126*r+0.7152*g+0.0722*b)/255;return l>0.55?colors.dark:colors.light
        }
        function getAccentColor(mainBgColor, serviceColor) { /* ... (igual) ... */
             const t=getTextColor(mainBgColor);if(activeColor==='orange'||activeColor==='white'||activeColor==='black'){return serviceColor}return t
        }

        // --- Core Functions ---
        function renderCreative() { // MODIFICADO para manejar AMBOS tipos
             creativesContainer.innerHTML = '';
             const isAd = isAdConcept(activeService);
             const data = isAd ? adConceptData[activeService] : originalCreativesData[activeService];

             if (!data) { console.error("Datos no encontrados:", activeService); return; }

             const mainBgColor = getMainBgColor();
             const serviceColor = getServiceColor(activeService);
             const mainTextColor = getTextColor(mainBgColor);
             const bannerTextColor = getTextColor(serviceColor);
             const accentColor = getAccentColor(mainBgColor, serviceColor);

             // Elemento principal y clases condicionales
             const creativeEl = document.createElement('div');
             creativeEl.className = `creative ${activeFormat === 'vertical' ? 'creative-vertical' : ''} ${isAd ? 'is-ad-concept' : 'is-original-concept'}`;
             creativeEl.style.backgroundColor = mainBgColor;
             creativeEl.style.setProperty('--service-color', serviceColor);
             creativeEl.style.setProperty('--banner-text-color', bannerTextColor);

             // Banner (Solo si es Ad Concept)
             if (isAd) {
                 const bannerEl = document.createElement('div');
                 bannerEl.className = 'creative-service-banner';
                 // Estilos ya aplicados por CSS + :root variables
                 bannerEl.textContent = serviceBannerNames[activeService] || 'Orange Vapor';
                 creativeEl.appendChild(bannerEl);
             }

             // Logo (Posici√≥n depende si es Ad o no - manejado por CSS)
             const logoContainerEl = document.createElement('div');
             logoContainerEl.className = 'logo-container';
             const logoEl = document.createElement('div');
             // Color Logo
             if (activeColor === 'white') { logoEl.innerHTML = `<span style="color: ${colors.dark};">Orange</span> <span style="color: ${colors.primary};">Vapor</span>`; }
             else if (mainBgColor === colors.primary && activeColor !== 'original_service') { logoEl.innerHTML = `<span style="color: ${colors.light};">Orange Vapor</span>`; }
             else { logoEl.innerHTML = `<span style="color: ${mainTextColor};">Orange</span> <span style="color: ${colors.primary};">Vapor</span>`; }
             logoContainerEl.appendChild(logoEl);
             creativeEl.appendChild(logoContainerEl);

             // Contenido de Texto (Condicional)
             const contentEl = document.createElement('div');
             contentEl.className = 'creative-content';
             contentEl.style.color = mainTextColor;

             if (isAd) { // Renderizar Hook, Offer, Benefit, etc.
                 const hookEl = document.createElement('div'); hookEl.className = 'creative-hook'; hookEl.textContent = data.hook; contentEl.appendChild(hookEl);
                 const offerEl = document.createElement('div'); offerEl.className = 'creative-offer'; offerEl.textContent = data.offer; contentEl.appendChild(offerEl);
                 const benefitEl = document.createElement('div'); benefitEl.className = 'creative-benefit'; benefitEl.textContent = data.benefit; contentEl.appendChild(benefitEl);
                 const ctaEl = document.createElement('a'); ctaEl.className = 'creative-cta-visual'; ctaEl.textContent = data.cta; contentEl.appendChild(ctaEl);
                 if (data.credibility) { const credibilityEl = document.createElement('div'); credibilityEl.className = 'creative-credibility'; credibilityEl.textContent = data.credibility; contentEl.appendChild(credibilityEl); }
             } else { // Renderizar Title, Subtitle, Description
                 const titleEl = document.createElement('div'); titleEl.className = 'creative-title'; titleEl.textContent = data.title; contentEl.appendChild(titleEl);
                 const subtitleEl = document.createElement('div'); subtitleEl.className = 'creative-subtitle'; subtitleEl.textContent = data.subtitle; contentEl.appendChild(subtitleEl);
                 const descEl = document.createElement('div'); descEl.className = 'creative-description'; descEl.style.whiteSpace = 'pre-line'; descEl.textContent = data.description; contentEl.appendChild(descEl);
             }

             creativeEl.appendChild(contentEl);

             // Acento Lateral
             const accentEl = document.createElement('div'); accentEl.className = 'creative-accent'; accentEl.style.background = accentColor; creativeEl.appendChild(accentEl);

             // Bot√≥n Descarga Overlay
             const downloadOverlayEl = document.createElement('div'); downloadOverlayEl.className = 'creative-download'; downloadOverlayEl.innerHTML = `<i class="fas fa-download"></i>`; downloadOverlayEl.addEventListener('click', (e) => { e.stopPropagation(); generateAndDownloadImage(); }); creativeEl.appendChild(downloadOverlayEl);

             creativeEl.addEventListener('click', generateAndDownloadImage);
             creativesContainer.appendChild(creativeEl);
             updateAdCopy(); // Actualizar texto del copy asociado
        }

        function updateAdCopy() {
            adCopyText.textContent = adCopyData[activeService] || "Seleccion√° un servicio o anuncio.";
            copyBtn.innerHTML='<i class="fas fa-copy"></i> Copiar';
            // Cambiar t√≠tulo de la secci√≥n de copy
            adCopyTitle.textContent = isAdConcept(activeService) ? "Copy Sugerido para Anuncio IG (Voseo)" : "Copy Sugerido para Tr√°fico (Voseo)";
        }
        function showLoadingModal(message="Generando...") { /* ... */ loadingMessage.textContent=message;loadingModal.style.display='flex'; }
        function hideLoadingModal() { /* ... */ loadingModal.style.display='none'; }

        // --- CANVAS DRAWING (MODIFICADO para manejar AMBOS tipos) ---
        function generateAndDownloadImage() {
            if (isProcessing) return;
            isProcessing = true;
            showLoadingModal();
            const isAd = isAdConcept(activeService);
            const data = isAd ? adConceptData[activeService] : originalCreativesData[activeService];
            console.log(`[Start] Generating ${isAd ? 'Ad' : 'Original'}: ${activeService}, Format: ${activeFormat}, BG Color Key: ${activeColor}`);

            requestAnimationFrame(() => {
                setTimeout(() => {
                    try {
                        if (!data) throw new Error(`Datos no encontrados: ${activeService}`);

                        const isVertical = activeFormat === 'vertical';
                        const width = 1080;
                        const height = isVertical ? 1920 : 1080;
                        downloadCanvas.width = width;
                        downloadCanvas.height = height;
                        const ctx = downloadCanvas.getContext('2d');
                        ctx.clearRect(0, 0, width, height);

                        // Colores
                        const mainBgColor = getMainBgColor();
                        const serviceColor = getServiceColor(activeService);
                        const mainTextColor = getTextColor(mainBgColor);
                        const bannerTextColor = getTextColor(serviceColor);
                        const accentColor = getAccentColor(mainBgColor, serviceColor);
                        console.log(`[Canvas] Service: ${activeService}, ServiceColor: ${serviceColor}, BannerTxt: ${bannerTextColor}, MainBG: ${mainBgColor}, MainTxt: ${mainTextColor}`);

                        // --- DIBUJAR ---
                        ctx.fillStyle = mainBgColor; ctx.fillRect(0, 0, width, height); // 1. Fondo

                        // 2. Banner Superior (Solo si es Ad Concept)
                        const bannerHeight = isAd ? (isVertical ? 100 : 80) : 0; // Altura 0 si no es Ad
                        if (isAd) {
                            ctx.fillStyle = serviceColor; ctx.fillRect(0, 0, width, bannerHeight);
                            const bannerText = serviceBannerNames[activeService] || 'ORANGE VAPOR';
                            const bannerFontSize = isVertical ? 45 : 40;
                            ctx.font = `bold ${bannerFontSize}px Montserrat, sans-serif`; ctx.fillStyle = bannerTextColor;
                            ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
                            ctx.fillText(bannerText, width / 2, bannerHeight / 2);
                        }

                        // --- ZONA SEGURA (Condicional: M√°s estricta para Ads Verticales) ---
                        const safeTopMargin = isVertical ? (isAd ? Math.round(height * 0.14) : 150) : (isAd ? bannerHeight + 20 : 40);
                        const safeBottomMargin = isVertical ? (isAd ? Math.round(height * 0.14) : 100) : 40;
                        const safeZoneY = safeTopMargin;
                        const safeZoneHeight = height - safeTopMargin - safeBottomMargin;
                        const textMaxWidth = width - (isAd ? 140 : 100); // Margen texto

                        // 3. Logo (Posici√≥n depende de si hay banner y zona segura)
                        const logoFontSize = isVertical ? 36 : 32;
                        ctx.font = `bold ${logoFontSize}px Montserrat, sans-serif`;
                        ctx.textAlign = 'left'; ctx.textBaseline = 'top';
                        const logoX = 70;
                        const logoY = isAd ? (isVertical ? safeZoneY + 10 : bannerHeight + 30) : (isVertical ? 80 : 50); // Posici√≥n distinta si es Ad o Original
                        // Color Logo
                        if (activeColor === 'white') { ctx.fillStyle = colors.dark; ctx.fillText('Orange', logoX, logoY); ctx.fillStyle = colors.primary; ctx.fillText('Vapor', logoX + ctx.measureText('Orange ').width, logoY); }
                        else if (mainBgColor === colors.primary && activeColor !== 'original_service') { ctx.fillStyle = colors.light; ctx.fillText('Orange Vapor', logoX, logoY); }
                        else { ctx.fillStyle = mainTextColor; ctx.fillText('Orange', logoX, logoY); ctx.fillStyle = colors.primary; ctx.fillText('Vapor', logoX + ctx.measureText('Orange ').width, logoY); }


                        // 4. Bloque de Texto Principal (Condicional)
                        ctx.textAlign = 'center'; ctx.textBaseline = 'top'; ctx.fillStyle = mainTextColor;

                        if (isAd) {
                            // --- Dibujar AD CONCEPT (Hook, Offer, Benefit, CTA, Credibility) ---
                            const hookFontSize = isVertical ? 70 : 60; const hookLineHeight = hookFontSize * 1.15;
                            const offerFontSize = isVertical ? 46 : 40; const offerLineHeight = offerFontSize * 1.2;
                            const benefitFontSize = isVertical ? 36 : 32; const benefitLineHeight = benefitFontSize * 1.3;
                            const ctaFontSize = isVertical ? 40 : 36; const credibilityFontSize = isVertical ? 24 : 20;
                            const spaceOffer = 25; const spaceBenefit = 20; const spaceCta = 35; const spaceCred = 15;

                            // Medir altura total (aproximada)
                            const measureCtx = downloadCanvas.getContext('2d');
                            measureCtx.font = `800 ${hookFontSize}px Montserrat, sans-serif`; const hookInfo = wrapTextAndMeasure(measureCtx, data.hook, textMaxWidth, hookLineHeight);
                            measureCtx.font = `700 ${offerFontSize}px Montserrat, sans-serif`; const offerInfo = wrapTextAndMeasure(measureCtx, data.offer, textMaxWidth * 0.9, offerLineHeight);
                            measureCtx.font = `${benefitFontSize}px Montserrat, sans-serif`; const benefitInfo = wrapTextAndMeasure(measureCtx, data.benefit, textMaxWidth, benefitLineHeight);
                            measureCtx.font = `bold ${ctaFontSize}px Montserrat, sans-serif`; const ctaInfo = wrapTextAndMeasure(measureCtx, data.cta, textMaxWidth * 0.8, ctaFontSize * 1.2);
                            measureCtx.font = `500 ${credibilityFontSize}px Montserrat, sans-serif`; const credInfo = wrapTextAndMeasure(measureCtx, data.credibility || '', textMaxWidth, credibilityFontSize * 1.2);
                            const totalTextBlockHeight = hookInfo.height + (offerInfo.lines > 0 ? spaceOffer + offerInfo.height : 0) + (benefitInfo.lines > 0 ? spaceBenefit + benefitInfo.height : 0) + (ctaInfo.lines > 0 ? spaceCta + ctaInfo.height : 0) + (credInfo.lines > 0 ? spaceCred + credInfo.height : 0);

                            // Calcular Y inicial (centrado en zona segura bajo logo)
                            const availableTextHeight = height - logoY - logoFontSize - safeBottomMargin - 20;
                            const textBlockStartY = logoY + logoFontSize + Math.max(30, (availableTextHeight - totalTextBlockHeight) / 2);

                            // Dibujar
                            let currentY = textBlockStartY;
                            ctx.font = `800 ${hookFontSize}px Montserrat, sans-serif`; const hookDrawInfo = wrapTextAndDraw(ctx, data.hook, width / 2, currentY, textMaxWidth, hookLineHeight); currentY = hookDrawInfo.endY + spaceOffer;
                            if (offerInfo.lines > 0) { ctx.font = `700 ${offerFontSize}px Montserrat, sans-serif`; const offerTextWidth = measureCtx.measureText(data.offer.length > 25 ? data.offer.substring(0,22)+'...' : data.offer).width * 1.05; const offerRectWidth = Math.min(textMaxWidth * 0.9, offerTextWidth); const offerRectHeight = offerInfo.height + 15; ctx.fillStyle = 'rgba(0, 0, 0, 0.1)'; ctx.fillRect(width/2 - offerRectWidth/2, currentY - 7, offerRectWidth, offerRectHeight); ctx.fillStyle = mainTextColor; const offerDrawInfo = wrapTextAndDraw(ctx, data.offer, width / 2, currentY, textMaxWidth * 0.9, offerLineHeight); currentY = offerDrawInfo.endY + spaceBenefit; } else { currentY -= spaceOffer; currentY += spaceBenefit;}
                            if (benefitInfo.lines > 0) { ctx.font = `${benefitFontSize}px Montserrat, sans-serif`; const benefitDrawInfo = wrapTextAndDraw(ctx, data.benefit, width / 2, currentY, textMaxWidth, benefitLineHeight); currentY = benefitDrawInfo.endY + spaceCta; } else { currentY -= spaceBenefit; currentY += spaceCta;}
                            if (ctaInfo.lines > 0) { ctx.font = `bold ${ctaFontSize}px Montserrat, sans-serif`; const ctaTextWidth = measureCtx.measureText(data.cta).width * 1.1; const ctaRectWidth = Math.min(textMaxWidth * 0.8, ctaTextWidth); const ctaRectHeight = ctaInfo.height + 20; const ctaRectY = currentY - 10; ctx.fillStyle = serviceColor; ctx.fillRect(width/2 - ctaRectWidth/2, ctaRectY, ctaRectWidth, ctaRectHeight); ctx.fillStyle = bannerTextColor; wrapTextAndDraw(ctx, data.cta, width / 2, currentY, textMaxWidth * 0.8, ctaFontSize * 1.2); currentY += ctaInfo.height + spaceCred; } else { currentY -= spaceCta; currentY += spaceCred;}
                            if (credInfo.lines > 0) { ctx.font = `500 ${credibilityFontSize}px Montserrat, sans-serif`; ctx.fillStyle = mainTextColor; ctx.globalAlpha = 0.9; wrapTextAndDraw(ctx, data.credibility, width / 2, currentY, textMaxWidth, credibilityFontSize * 1.2); ctx.globalAlpha = 1.0; }

                        } else {
                             // --- Dibujar ORIGINAL (Title, Subtitle, Description) ---
                            const titleFontSize = isVertical ? 70 : 65; const titleLineHeight = titleFontSize * 1.1;
                            const subtitleFontSize = isVertical ? 50 : 45; const subtitleLineHeight = subtitleFontSize * 1.2;
                            const descFontSize = isVertical ? 38 : 34; const descLineHeight = descFontSize * 1.3;
                            const spaceSub = 20; const spaceDesc = 30;

                            // Medir altura
                            const measureCtx = downloadCanvas.getContext('2d');
                            measureCtx.font = `800 ${titleFontSize}px Montserrat, sans-serif`; const titleInfo = wrapTextAndMeasure(measureCtx, data.title, textMaxWidth, titleLineHeight);
                            measureCtx.font = `600 ${subtitleFontSize}px Montserrat, sans-serif`; const subtitleInfo = wrapTextAndMeasure(measureCtx, data.subtitle, textMaxWidth, subtitleLineHeight);
                            measureCtx.font = `${descFontSize}px Montserrat, sans-serif`; const descInfo = wrapTextAndMeasure(measureCtx, data.description, textMaxWidth, descLineHeight);
                            const totalTextBlockHeight = titleInfo.height + (subtitleInfo.lines > 0 ? spaceSub + subtitleInfo.height : 0) + (descInfo.lines > 0 ? spaceDesc + descInfo.height : 0);

                            // Calcular Y inicial (centrado bajo logo)
                            const availableTextHeight = height - logoY - logoFontSize - safeBottomMargin - 20;
                            const textBlockStartY = logoY + logoFontSize + Math.max(30, (availableTextHeight - totalTextBlockHeight) / 2);

                            // Dibujar
                            let currentY = textBlockStartY;
                            ctx.font = `800 ${titleFontSize}px Montserrat, sans-serif`; const titleDrawInfo = wrapTextAndDraw(ctx, data.title, width / 2, currentY, textMaxWidth, titleLineHeight); currentY = titleDrawInfo.endY + spaceSub;
                            if (subtitleInfo.lines > 0) { ctx.font = `600 ${subtitleFontSize}px Montserrat, sans-serif`; const subtitleDrawInfo = wrapTextAndDraw(ctx, data.subtitle, width / 2, currentY, textMaxWidth, subtitleLineHeight); currentY = subtitleDrawInfo.endY + spaceDesc; } else { currentY -= spaceSub; currentY += spaceDesc; }
                            if (descInfo.lines > 0) { ctx.font = `${descFontSize}px Montserrat, sans-serif`; wrapTextAndDraw(ctx, data.description, width / 2, currentY, textMaxWidth, descLineHeight); }
                        }


                        // 5. Acento Lateral (Posici√≥n simple)
                        ctx.fillStyle = accentColor; const accentWidth = isVertical ? 15 : 10; const accentHeight = isVertical ? 100 : 70;
                        let accentY = logoY + 50; // Posici√≥n fija simple relativa al logo
                        accentY = Math.max(bannerHeight + 10, Math.min(accentY, height - accentHeight - 10));
                        ctx.fillRect(0, accentY, accentWidth, accentHeight);

                        // 6. Descargar
                        const filename = `${isAd ? 'AD' : 'OG'}_${activeService}_${activeColor}_${activeFormat}.png`;
                        const dataUrl = downloadCanvas.toDataURL('image/png'); const link = document.createElement('a'); link.href = dataUrl; link.download = filename; document.body.appendChild(link); link.click(); document.body.removeChild(link); console.log(`[Success] Image downloaded: ${filename}`);
                        hideLoadingModal(); isProcessing = false;

                    } catch (error) { console.error('Error al generar/descargar Ad:', error); hideLoadingModal(); alert(`Hubo un error: ${error.message}. Intent√° de nuevo.`); isProcessing = false; }
                }, 100); }); // End setTimeout & requestAnimationFrame
        } // End generateAndDownloadImage

        // --- Wrap Text Helpers (sin cambios) ---
        function wrapTextAndMeasure(ctx,text,maxWidth,lineHeight){const w=text.split(/[\s\n]+/);let l='';let nL=0;let cY=0;if(!text||text.trim()==='')return{lines:0,height:0,endY:0};for(let i=0;i<w.length;i++){const tL=l+w[i]+' ';const m=ctx.measureText(tL);if(m.width>maxWidth&&i>0){nL++;cY+=lineHeight;l=w[i]+' '}else{l=tL}}nL++;const tH=nL*lineHeight;return{lines:nL,height:tH,endY:cY+lineHeight}}
        function wrapTextAndDraw(ctx,text,x,y,maxWidth,lineHeight){const w=text.split(/[\s\n]+/);let l='';let cY=y;let nL=0;if(!text||text.trim()==='')return{lines:0,endY:y};for(let i=0;i<w.length;i++){const tL=l+w[i]+' ';const m=ctx.measureText(tL);if(m.width>maxWidth&&i>0){ctx.fillText(l.trim(),x,cY);cY+=lineHeight;nL++;l=w[i]+' '}else{l=tL}}ctx.fillText(l.trim(),x,cY);nL++;return{lines:nL,endY:cY+lineHeight}}

        // --- UI Update & Event Listeners ---
        function updateUI() {
             serviceTitle.textContent = getServiceFriendlyName(activeService);
             tabButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.service === activeService));
             formatButtons.forEach(btn => btn.classList.remove('active'));
             document.getElementById(activeFormat === 'square' ? 'squareBtn' : 'verticalBtn').classList.add('active');
             colorButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.color === activeColor));
             renderCreative(); // Renderiza preview
        }

        // Event Listeners
        tabButtons.forEach(btn => btn.addEventListener('click', () => { if(isProcessing) return; activeService = btn.dataset.service; updateUI(); }));
        squareBtn.addEventListener('click', () => { if(isProcessing) return; activeFormat = 'square'; updateUI(); });
        verticalBtn.addEventListener('click', () => { if(isProcessing) return; activeFormat = 'vertical'; updateUI(); });
        colorButtons.forEach(btn => btn.addEventListener('click', () => { if(isProcessing) return; activeColor = btn.dataset.color; updateUI(); }));
        downloadBtn.addEventListener('click', generateAndDownloadImage);
        copyBtn.addEventListener('click', () => { const t=adCopyText.textContent||adCopyText.innerText;navigator.clipboard.writeText(t).then(()=>{copyBtn.innerHTML='<i class="fas fa-check"></i> Copiado!';setTimeout(()=>{copyBtn.innerHTML='<i class="fas fa-copy"></i> Copiar'},1500)}).catch(e=>{console.error('Copy err:',e);copyBtn.innerHTML='<i class="fas fa-times"></i> Error'})});
        togglePracticesBtn.addEventListener('click', () => { const i=bestPracticesBox.style.display==='none'||bestPracticesBox.style.display==='';bestPracticesBox.style.display=i?'block':'none';togglePracticesBtn.textContent=i?'Ocultar Tips':'Ver Tips' });

        // Initial Load
        updateUI();

    </script>
</body>
</html>
