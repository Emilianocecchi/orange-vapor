<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creativos Orange Vapor - Campañas de Tráfico Ads</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            font-size: 28px;
            color: #2c2c2c;
            margin-bottom: 10px;
        }
        .header p {
            color: #666;
            font-size: 16px;
        }
        .tabs {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        .tab-group {
            display: inline-flex;
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 10px;
        }
        .tab-button {
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 500;
            background-color: white;
            color: #333;
            border: 1px solid #ddd;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .tab-button:first-child {
            border-top-left-radius: 6px;
            border-bottom-left-radius: 6px;
        }
        .tab-button:last-child {
            border-top-right-radius: 6px;
            border-bottom-right-radius: 6px;
        }
        .tab-button.active {
            color: white;
        }
        .tab-button.optimizacion.active { background-color: #dc3545; border-color: #dc3545; }
        .tab-button.meta.active { background-color: #1877F2; border-color: #1877F2; }
        .tab-button.google.active { background-color: #4285F4; border-color: #4285F4; }
        .tab-button.email.active { background-color: #00829b; border-color: #00829b; }
        .tab-button.chatbot.active { background-color: #6f42c1; border-color: #6f42c1; }
        .tab-button.all.active { background-color: #333333; border-color: #333333; }
        .tab-button.auditoria.active { background-color: #28a745; border-color: #28a745; }

        /* Selector de color */
        .color-toggle { text-align: center; margin: 20px 0; }
        .color-btn {
            width: 36px; height: 36px; border-radius: 50%; margin: 0 5px;
            cursor: pointer; display: inline-block; border: 2px solid #ddd;
            transition: all 0.2s ease; overflow: hidden;
        }
        .color-btn.active { border-color: #ff7e00; transform: scale(1.1); }
        .color-btn-original { background: linear-gradient(135deg, #28a745 14%, #dc3545 14% 28%, #1877F2 28% 42%, #4285F4 42% 56%, #00829b 56% 70%, #6f42c1 70% 84%, #333 84%); }
        .color-btn-orange { background-color: #ff7e00; }
        .color-btn-white { background-color: #ffffff; border: 2px solid #ccc; }
        .color-btn-black { background-color: #181818; }

        /* Sección de descarga */
        .download-section { text-align: center; margin: 20px 0; }
        .download-btn {
            background: #ff7e00; color: white; border: none; padding: 12px 24px;
            font-size: 16px; font-weight: bold; border-radius: 6px; cursor: pointer;
            display: inline-flex; align-items: center; gap: 10px;
            box-shadow: 0 4px 8px rgba(255, 126, 0, 0.3); transition: all 0.3s ease;
        }
        .download-btn:hover { background: #e67300; transform: translateY(-2px); }

        /* Contenedor de creativos */
        .creatives-container { display: flex; flex-wrap: wrap; justify-content: center; margin-top: 20px; }
        .creative {
            width: 360px; height: 360px; margin: 10px; position: relative;
            border-radius: 8px; overflow: hidden; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            color: white; cursor: pointer;
        }
        .creative-vertical { width: 240px; height: 427px; }
        .creative-content {
            position: relative; z-index: 2; padding: 20px; height: 100%;
            display: flex; flex-direction: column; justify-content: center; text-align: center;
        }
        .creative-title { font-size: 22px; font-weight: bold; margin-bottom: 10px; line-height: 1.2; }
        .creative-subtitle { font-size: 18px; font-weight: bold; margin-bottom: 10px; line-height: 1.2; }
        .creative-description { font-size: 14px; line-height: 1.4; }
        .creative-accent {
            position: absolute; left: 0; top: 30%; width: 6px; height: 100px;
            background: white; border-radius: 0 3px 3px 0; z-index: 1;
        }
        .creative-download {
            position: absolute; top: 10px; right: 10px; width: 30px; height: 30px;
            border-radius: 50%; background: rgba(68, 68, 68, 0.8); display: flex;
            align-items: center; justify-content: center; cursor: pointer;
            opacity: 0; transition: opacity 0.3s; z-index: 10;
        }
        .creative:hover .creative-download { opacity: 1; }

        /* Estilo para el Ribbon */
        .creative-ribbon {
            position: absolute; background-color: #FFD700; color: #333;
            padding: 5px 8px; font-size: 12px; font-weight: bold; z-index: 3;
            top: 15px; right: -35px; width: 130px; text-align: center;
            transform: rotate(45deg); box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            text-transform: uppercase;
        }
        .creative-vertical .creative-ribbon { font-size: 13px; top: 20px; right: -40px; width: 150px; }

        /* Notas y cajas informativas */
        .note { text-align: center; margin-top: 30px; color: #666; font-size: 12px; }
        .info-box {
            background-color: #e6f7ff; border-left: 4px solid #1890ff; padding: 15px;
            margin: 20px auto; max-width: 800px; border-radius: 4px; display: flex;
            align-items: flex-start;
        }
        .info-box i { color: #1890ff; font-size: 20px; margin-right: 10px; margin-top: 2px; }
        .info-box p { color: #333; font-size: 14px; margin: 0; line-height: 1.5; }

        /* Toggle de formato */
        .format-toggle { text-align: center; margin: 20px 0; }
        .format-btn {
            padding: 8px 16px; border: 1px solid #ddd; border-radius: 4px;
            background-color: white; margin: 0 5px; cursor: pointer; transition: all 0.2s ease;
        }
        .format-btn.active { background-color: #ff7e00; color: white; border-color: #ff7e00; }

        /* Mejores prácticas */
        .best-practices { background-color: #f8f8f8; border-radius: 8px; padding: 15px; margin: 20px 0; }
        .best-practices h3 { font-size: 16px; color: #333; margin-bottom: 10px; }
        .best-practices ul { list-style-type: disc; margin-left: 20px; }
        .best-practices li { font-size: 13px; margin-bottom: 5px; color: #666; }
        .toggle-practices {
            display: block; margin: 10px auto; background: none; border: 1px solid #ddd;
            padding: 5px 10px; font-size: 12px; color: #666; cursor: pointer; border-radius: 4px;
        }

        /* Logo */
        .logo-container {
            position: absolute; top: 10px; left: 10px; padding: 5px 10px;
            border-radius: 4px; z-index: 2; text-align: left;
        }

        /* Modal de carga */
        .loading-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.7); display: flex; justify-content: center;
            align-items: center; z-index: 9999;
        }
        .loading-container {
            background-color: #fff; padding: 20px 30px; border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3); text-align: center;
        }
        .loading-spinner {
            display: inline-block; width: 30px; height: 30px; border: 4px solid rgba(0,0,0,.1);
            border-radius: 50%; border-top-color: #ff7e00;
            animation: spin 1s ease-in-out infinite; margin-bottom: 10px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Canvas oculto */
        #downloadCanvas { position: absolute; left: -9999px; top: -9999px; }

        /* Indicador 20% texto */
        .text-20-indicator {
            padding: 8px 12px; font-size: 13px; background-color: rgba(255, 126, 0, 0.1);
            border: 1px solid #ff7e00; color: #666; margin: 10px 0;
            border-radius: 4px; text-align: center;
        }
        .text-20-indicator i { color: #00b300; margin-right: 5px; }

        /* Sección Ad Copy */
        .ad-copy-section { margin-top: 40px; border-top: 1px solid #eee; padding-top: 20px; }
        .ad-copy-section h3 { font-size: 18px; color: #333; text-align: center; margin-bottom: 15px; }
        .ad-copy-container {
            background-color: #f9f9f9; border: 1px solid #e0e0e0; border-radius: 8px;
            padding: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            max-width: 800px; margin: 0 auto;
        }
        .ad-copy-text { font-size: 16px; line-height: 1.6; color: #444; white-space: pre-line; }
        .copy-btn {
            background: #f1f1f1; border: 1px solid #ddd; border-radius: 4px;
            padding: 8px 16px; font-size: 14px; color: #555; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            margin: 15px auto 0; transition: all 0.3s ease;
        }
        .copy-btn:hover { background: #e9e9e9; }
        .copy-btn i { margin-right: 8px; }

        /* Indicador tipo campaña */
        .campaign-type-indicator {
            background-color: #f8fafa; border: 1px dashed #1890ff; border-radius: 4px;
            padding: 10px; margin: 15px 0; text-align: center; color: #1890ff;
            font-weight: 600; font-size: 14px; display: flex; align-items: center;
            justify-content: center; gap: 8px;
        }
        .campaign-type-indicator i { margin-right: 8px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 id="serviceTitle">Creativos de Tráfico para Optimización Express de Ads</h1>
            <p>Anuncios optimizados para tus campañas de Ads (Meta, Google, etc.)</p>
        </div>

        <div class="campaign-type-indicator">
            <i class="fas fa-bullhorn"></i>
            <span>Creativos Optimizados para Campañas de Ads</span>
        </div>

        <div class="tabs">
            <div class="tab-group">
                <button class="tab-button auditoria" data-service="auditoria">Auditoría Gratis</button>
                <button class="tab-button optimizacion active" data-service="optimizacion">Optimización Express</button>
                <button class="tab-button meta" data-service="meta">Meta Ads</button>
                <button class="tab-button google" data-service="google">Google Ads</button>
                <button class="tab-button email" data-service="email">Email Marketing</button>
                <button class="tab-button chatbot" data-service="chatbot">Chatbot</button>
                <button class="tab-button all" data-service="all">Paquete Completo</button>
            </div>
        </div>

        <div class="format-toggle">
            <button id="squareBtn" class="format-btn active">Cuadrado (1080x1080)</button>
            <button id="verticalBtn" class="format-btn">Vertical (1080x1920)</button>
        </div>

        <div class="color-toggle">
            <div class="color-btn color-btn-original active" data-color="original" title="Color original del servicio"></div>
            <div class="color-btn color-btn-orange" data-color="orange" title="Fondo naranja"></div>
            <div class="color-btn color-btn-white" data-color="white" title="Fondo blanco"></div>
            <div class="color-btn color-btn-black" data-color="black" title="Fondo negro"></div>
        </div>

        <div class="download-section">
            <button id="downloadBtn" class="download-btn">
                <i class="fas fa-download"></i>
                Descargar Creativo
            </button>
        </div>

        <div class="info-box">
            <i class="fas fa-info-circle"></i>
            <div>
                <p><strong>Instrucciones:</strong></p>
                <p>1. Seleccioná el tipo de servicio de Ads que deseás generar.</p>
                <p>2. Elegí el formato (cuadrado 1080x1080 o vertical 1080x1920).</p>
                <p>3. Seleccioná el color de fondo (original, naranja, blanco o negro).</p>
                <p>4. Hacé clic en "Descargar Creativo" para obtener la imagen en alta resolución.</p>
                <p>5. También podés descargar el creativo pasando el mouse sobre la imagen y haciendo clic en el icono de descarga.</p>
            </div>
        </div>

        <div class="text-20-indicator">
            <i class="fas fa-check-circle"></i>
            Texto optimizado (menos del 20% del espacio) - Aprobado para Meta Ads
        </div>

        <div class="best-practices" style="display: none;">
            <h3>Mejores Prácticas para Anuncios de Tráfico Ads:</h3>
            <ul>
                <li><strong>Mensajes intrigantes</strong> - Copy que genera curiosidad y fomenta el clic</li>
                <li><strong>Imágenes de alto impacto</strong> - Elementos visuales llamativos que captan atención</li>
                <li><strong>Menos del 20% de texto</strong> - Facebook penaliza anuncios con exceso de texto</li>
                <li><strong>Colores contrastantes</strong> - Ajuste automático del contraste según el fondo seleccionado</li>
                <li><strong>Propuesta de valor clara</strong> - Qué beneficio obtienen al hacer clic</li>
                <li><strong>Llamada a la acción (CTA) clara</strong> - Enfocado en visitar, descubrir, explorar</li>
                <li><strong>Composición centrada</strong> - Elementos principales visibles a primera vista</li>
            </ul>
        </div>
        <button class="toggle-practices" id="togglePractices">Ver mejores prácticas para Ads</button>

        <div id="creativesContainer" class="creatives-container">
            <!-- El creativo se inserta dinámicamente aquí -->
        </div>

        <div class="note">
            <p>Dimensiones: 1080x1080 píxeles y 1080x1920 píxeles (imágenes descargadas en alta resolución)</p>
        </div>

        <div class="ad-copy-section">
            <h3>Copy Sugerido para Campañas de Ads (Tráfico)</h3>
            <div class="ad-copy-container">
                <p id="adCopyText" class="ad-copy-text"></p>
                <button id="copyBtn" class="copy-btn">
                    <i class="fas fa-copy"></i> Copiar
                </button>
            </div>
        </div>

        <canvas id="downloadCanvas"></canvas>
    </div>

    <script>
        const colors = {
            primary: '#ff7e00', dark: '#181818', light: '#ffffff',
            auditoria: '#28a745', optimizacion: '#dc3545', meta: '#1877F2',
            google: '#4285F4', googleRed: '#DB4437', googleYellow: '#F4B400',
            googleGreen: '#0F9D58', email: '#00829b', chatbot: '#6f42c1'
        };

        const creativesData = {
            auditoria: { title: 'AUDITORÍA GRATIS DE ADS', subtitle: 'DESCUBRÍ QUÉ FALLA', description: 'Análisis experto de tus campañas\nMeta Ads y Google Ads. Sin compromiso.', bgColor: colors.auditoria },
            optimizacion: { title: 'OPTIMIZACIÓN EXPRESS DE ADS', subtitle: 'MEJORÁ TU ROAS EN 48HS', description: 'Ajuste rápido de campañas de Ads\nReducí costes, aumentá conversiones.', bgColor: colors.optimizacion },
            meta: { title: 'META ADS: VENTAS ASEGURADAS', subtitle: 'CAMPAÑAS QUE SÍ CONVIERTEN', description: 'Gestión experta de campañas\nMeta Ads (FB/IG). ROAS 2.8X garantizado.', bgColor: colors.meta },
            google: { title: 'GOOGLE ADS: MÁS CLIENTES', subtitle: 'DOMINÁ LAS BÚSQUEDAS YA', description: 'Campañas rentables en Google Ads\nAtrae clientes listos para comprar.', bgColor: colors.google },
            email: { title: 'CAMPAÑAS DE EMAIL MARKETING', subtitle: 'CONVERTÍ SUSCRIPTORES', description: 'Optimización Express de campañas\nde Email Marketing. Más aperturas y ventas.', bgColor: colors.email },
            chatbot: { title: 'CAMPAÑAS CON CHATBOTS', subtitle: 'AUTOMATIZÁ Y VENDÉ MÁS', description: 'Optimización Express de Chatbots\npara tus campañas. Capturá leads 24/7.', bgColor: colors.chatbot },
            all: { title: 'PAQUETE ADS COMPLETO', subtitle: 'MAXIMIZÁ TU ROI GLOBAL', description: 'Meta Ads + Google Ads + Email + Chatbot\nOptimización integral por $1000/mes.', bgColor: '#333333' }
        };

        const ribbonData = {
            auditoria: 'GRATUITA', optimizacion: 'EN 48HS', meta: 'ROAS 2.8X GARANT.',
            google: 'ROAS 2.8X GARANT.', email: '+ VENTAS', chatbot: 'LEADS 24/7',
            all: 'AHORRÁ $200'
        };

        const adCopyData = {
            auditoria: `🔍 ¿Tus campañas de Meta Ads y Google Ads no rinden como esperabas? 🔍\n\nDescubrí EXACTAMENTE dónde estás perdiendo dinero y qué corregir.\n\n¡Solicitá tu Auditoría de Ads GRATUITA! ⏱️\n\n✅ Análisis detallado de estructura y configuración.\n✅ Identificación de fugas de presupuesto.\n✅ Recomendaciones claras para optimizar YA.\n✅ 100% Gratis, sin compromiso.\n\n👉 Visitá nuestra web y pedí tu auditoría antes de que se acaben los cupos semanales. ¡Dejá de tirar dinero!\n\n➡️ www.orangevapor.com`,
            optimizacion: `⚡ ¿Campañas de Ads activas pero SIN resultados? ¡Optimización Express en 48hs! ⚡\n\nDetené el gasto innecesario y empezá a ver conversiones REALES.\n\nNuestro servicio rápido incluye:\n✅ Diagnóstico de puntos débiles.\n✅ Reestructuración para máximo rendimiento.\n✅ Ajuste de segmentaciones y creativos.\n✅ ¡Resultados visibles en días!\n\n👉 Descubrí en nuestra web cómo recuperamos campañas "perdidas" y multiplicamos su ROAS.\n\n¿Listo/a para transformar tus Ads? Visitá 👇\nwww.orangevapor.com`,
            meta: `📱 ¿Invertís en Meta Ads (Facebook/Instagram) pero las ventas no llegan? 📱\n\n¡Dejá de adivinar! Nuestras campañas tienen un ROAS mínimo GARANTIZADO de 2.8x.\n\n✅ Estrategia personalizada para TU negocio.\n✅ Optimización continua basada en datos.\n✅ Reducción del costo por adquisición (CPA).\n✅ Reportes claros y enfocados en ROI.\n\n👉 Mirá casos de éxito en nuestra web y comprobá cómo escalamos ventas con Meta Ads.\n\n¡Es hora de que tus Ads trabajen para vos! Hacé clic 👇\nwww.orangevapor.com`,
            google: `🔎 ¿Tu competencia aparece en Google Ads y vos no? ¡Perdés clientes! 🔎\n\nConvertí búsquedas activas en ventas con campañas de Google Ads OPTIMIZADAS.\n\n✅ ROAS mínimo 2.8x GARANTIZADO.\n✅ Palabras clave que SÍ convierten.\n✅ Optimización de concordancias y negativas.\n✅ Anuncios atractivos que destacan.\n\n👉 Visitá nuestra web y descubrí cómo llevamos negocios a la cima de Google, reduciendo su CPA.\n\n¡Aparecé donde te buscan tus clientes! 👇\nwww.orangevapor.com`,
            email: `📧 ¿Tenés una lista de emails pero no genera ventas? ¡Optimizá tus Campañas de Email Marketing! 📧\n\nConvertí suscriptores inactivos en clientes recurrentes.\n\n✅ Secuencias automatizadas que nutren y venden.\n✅ Segmentación avanzada para mensajes relevantes.\n✅ Aumento de tasa de apertura y clics (CTR).\n✅ Generá ingresos pasivos con tu base de datos.\n\n👉 Descubrí en nuestra web cómo revitalizamos campañas de email marketing olvidadas.\n\n¡Monetizá tu lista AHORA! 👇\nwww.orangevapor.com`,
            chatbot: `🤖 ¿Perdés leads y ventas por no responder al instante? ¡Potenciá tus Campañas con Chatbots! 🤖\n\nIntegrá chatbots inteligentes para MAXIMIZAR la conversión de tus Ads.\n\n✅ Capturá y cualificá leads 24/7.\n✅ Respondé preguntas frecuentes al instante.\n✅ Guiá a los usuarios hacia la compra.\n✅ Liberá a tu equipo para tareas complejas.\n\n👉 Visitá nuestra web y mirá cómo los chatbots mejoran el ROI de las campañas de marketing.\n\n¡No pierdas ni un lead más! 👇\nwww.orangevapor.com`,
            all: `🚀 ¡La Estrategia de Ads COMPLETA que tu negocio necesita! 🚀\n\n¿Por qué optimizar un solo canal cuando podés dominar TODOS?\n\nNuestro Paquete Integral incluye Optimización Express para:\n✅ Meta Ads (Facebook & Instagram)\n✅ Google Ads (Búsqueda, Display, etc.)\n✅ Campañas de Email Marketing\n✅ Campañas con Chatbots\n\n👉 Ahorrá $200/mes con el paquete completo ($1000 vs $1200 por separado) y obtené resultados sinérgicos. ¡Visitá nuestra web!\n\nMaximizá tu presencia y ROI en todos los frentes 👇\nwww.orangevapor.com`
        };

        let activeService = 'optimizacion';
        let activeFormat = 'square';
        let activeColor = 'original';
        let isProcessing = false;

        const serviceTitle = document.getElementById('serviceTitle');
        const creativesContainer = document.getElementById('creativesContainer');
        const tabButtons = document.querySelectorAll('.tab-button');
        const formatButtons = document.querySelectorAll('.format-btn');
        const colorButtons = document.querySelectorAll('.color-btn');
        const squareBtn = document.getElementById('squareBtn');
        const verticalBtn = document.getElementById('verticalBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const togglePracticesBtn = document.getElementById('togglePractices');
        const bestPracticesBox = document.querySelector('.best-practices');
        const downloadCanvas = document.getElementById('downloadCanvas');
        const adCopyText = document.getElementById('adCopyText');
        const copyBtn = document.getElementById('copyBtn');

        copyBtn.addEventListener('click', () => {
            const textToCopy = adCopyText.textContent || adCopyText.innerText;
            navigator.clipboard.writeText(textToCopy)
                .then(() => {
                    copyBtn.innerHTML = '<i class="fas fa-check"></i> ¡Copiado!';
                    setTimeout(() => { copyBtn.innerHTML = '<i class="fas fa-copy"></i> Copiar'; }, 2000);
                })
                .catch(err => {
                    console.error('Error al copiar: ', err);
                    copyBtn.innerHTML = '<i class="fas fa-times"></i> Error';
                    setTimeout(() => { copyBtn.innerHTML = '<i class="fas fa-copy"></i> Copiar'; }, 2000);
                });
        });

        togglePracticesBtn.addEventListener('click', () => {
            const isHidden = bestPracticesBox.style.display === 'none' || bestPracticesBox.style.display === '';
            bestPracticesBox.style.display = isHidden ? 'block' : 'none';
            togglePracticesBtn.textContent = isHidden ? 'Ocultar mejores prácticas' : 'Ver mejores prácticas para Ads';
        });

        function getServiceTitle(service) {
            const titleMap = {
                auditoria: 'Creativos para Auditoría Gratis de Ads', optimizacion: 'Creativos para Optimización Express de Ads',
                meta: 'Creativos para Campañas de Meta Ads', google: 'Creativos para Campañas de Google Ads',
                email: 'Creativos para Campañas de Email Marketing', chatbot: 'Creativos para Campañas con Chatbots',
                all: 'Creativos para Paquete de Ads Completo'
            };
            return titleMap[service] ? `Tráfico: ${titleMap[service]}` : 'Creativos de Tráfico para Ads';
        }

        function getBgColor() {
            if (activeColor === 'original') return creativesData[activeService]?.bgColor || colors.primary;
            if (activeColor === 'orange') return colors.primary;
            if (activeColor === 'white') return colors.light;
            if (activeColor === 'black') return colors.dark;
            return colors.primary;
        }

        function getTextColor(bgColor) {
            if (!bgColor) return colors.dark;
            let rgb;
            if (bgColor.startsWith('#')) {
                const bigint = parseInt(bgColor.slice(1), 16);
                rgb = { r: (bigint >> 16) & 255, g: (bigint >> 8) & 255, b: bigint & 255 };
            } else if (bgColor.startsWith('rgb')) {
                const matches = bgColor.match(/\d+/g);
                if (!matches || matches.length < 3) return colors.dark;
                rgb = { r: parseInt(matches[0]), g: parseInt(matches[1]), b: parseInt(matches[2]) };
            } else { return colors.dark; }
            const luminance = (0.299 * rgb.r + 0.587 * rgb.g + 0.114 * rgb.b) / 255;
            return luminance > 0.5 ? colors.dark : colors.light;
        }

        function getAccentColor(bgColor) {
            const textColor = getTextColor(bgColor);
            if (activeColor === 'orange') return textColor;
            if (activeColor === 'white' || activeColor === 'black') return colors.primary;
            return textColor;
        }

        function renderCreative() {
            creativesContainer.innerHTML = '';
            const creative = creativesData[activeService];
            if (!creative) {
                console.error("Datos no encontrados para el servicio:", activeService);
                creativesContainer.innerHTML = '<p>Error: Datos del creativo no disponibles.</p>';
                return;
            }

            const bgColor = getBgColor();
            const textColor = getTextColor(bgColor);
            const accentColor = getAccentColor(bgColor);

            const creativeEl = document.createElement('div');
            creativeEl.className = `creative ${activeFormat === 'vertical' ? 'creative-vertical' : ''}`;
            creativeEl.style.backgroundColor = bgColor;

            const ribbonText = ribbonData[activeService];
            if (ribbonText) {
                const ribbonEl = document.createElement('div');
                ribbonEl.className = 'creative-ribbon';
                ribbonEl.textContent = ribbonText;
                creativeEl.appendChild(ribbonEl);
            }

            const accentEl = document.createElement('div');
            accentEl.className = 'creative-accent';
            accentEl.style.background = accentColor;
            creativeEl.appendChild(accentEl);

            const contentEl = document.createElement('div');
            contentEl.className = 'creative-content';

            const logoContainerEl = document.createElement('div');
            logoContainerEl.className = 'logo-container';
            const logoEl = document.createElement('div');
            logoEl.style.fontWeight = 'bold';
            logoEl.style.fontSize = '14px';
            if (activeColor === 'white') {
                logoEl.innerHTML = `<span style="color: ${colors.dark};">Orange</span> <span style="color: ${colors.primary};">Vapor</span>`;
            } else if (activeColor === 'orange') {
                logoEl.innerHTML = `<span style="color: ${colors.light};">Orange Vapor</span>`;
            } else {
                logoEl.innerHTML = `<span style="color: ${textColor};">Orange</span> <span style="color: ${colors.primary};">Vapor</span>`;
            }
            logoContainerEl.appendChild(logoEl);
            contentEl.appendChild(logoContainerEl);

            const titleEl = document.createElement('div');
            titleEl.className = 'creative-title';
            titleEl.textContent = creative.title;
            titleEl.style.color = textColor;
            titleEl.style.paddingTop = '50px';
            contentEl.appendChild(titleEl);

            const subtitleEl = document.createElement('div');
            subtitleEl.className = 'creative-subtitle';
            subtitleEl.textContent = creative.subtitle;
            subtitleEl.style.color = textColor;
            contentEl.appendChild(subtitleEl);

            const descEl = document.createElement('div');
            descEl.className = 'creative-description';
            descEl.style.whiteSpace = 'pre-line';
            descEl.textContent = creative.description;
            descEl.style.color = textColor;
            contentEl.appendChild(descEl);

            creativeEl.appendChild(contentEl);

            const downloadEl = document.createElement('div');
            downloadEl.className = 'creative-download';
            downloadEl.innerHTML = `<i class="fas fa-download" style="color: ${colors.light};"></i>`;
            downloadEl.addEventListener('click', (e) => {
                e.stopPropagation();
                generateAndDownloadImage(); // Llama a la función modificada
            });
            creativeEl.appendChild(downloadEl);

            creativeEl.addEventListener('click', generateAndDownloadImage); // Llama a la función modificada

            creativesContainer.appendChild(creativeEl);

            updateAdCopy();
        }

        function updateAdCopy() {
            adCopyText.textContent = adCopyData[activeService] || "Copy de anuncio no disponible para este servicio.";
            copyBtn.innerHTML = '<i class="fas fa-copy"></i> Copiar';
        }

        function showLoadingModal(message = "Generando imagen...") {
            if (document.getElementById('loadingModal')) return;
            const modalEl = document.createElement('div');
            modalEl.className = 'loading-modal';
            modalEl.id = 'loadingModal';
            modalEl.innerHTML = `
                <div class="loading-container">
                    <div class="loading-spinner"></div>
                    <div>${message}</div>
                </div>`;
            document.body.appendChild(modalEl);
        }
        function hideLoadingModal() {
            const modal = document.getElementById('loadingModal');
            if (modal) { document.body.removeChild(modal); }
        }

        // --- MODIFICADO: Función para dibujar y descargar la imagen ---
        async function generateAndDownloadImage() { // --- NUEVO: async ---
            if (isProcessing) return;
            isProcessing = true;
            showLoadingModal("Preparando fuentes y generando imagen..."); // Mensaje actualizado

            try {
                // --- ¡NUEVO: Esperar a que las fuentes estén listas! ---
                console.log("Esperando fuentes...");
                await Promise.all([
                    document.fonts.load('bold 70px Montserrat'), // Título Cuadrado
                    document.fonts.load('bold 80px Montserrat'), // Título Vertical
                    document.fonts.load('bold 46px Montserrat'), // Subtítulo Cuadrado
                    document.fonts.load('bold 56px Montserrat'), // Subtítulo Vertical
                    document.fonts.load('normal 36px Montserrat'), // Desc Cuadrado
                    document.fonts.load('normal 42px Montserrat'), // Desc Vertical
                    document.fonts.load('bold 36px Montserrat'), // Logo
                    document.fonts.load('bold 42px Montserrat'), // Logo Vertical (por si acaso)
                    document.fonts.load('bold 18px Montserrat'), // Ribbon Cuadrado
                    document.fonts.load('bold 22px Montserrat')  // Ribbon Vertical
                ]);
                console.log("Fuentes cargadas.");

                // --- El código de dibujo ahora se ejecuta DESPUÉS de cargar fuentes ---
                const creative = creativesData[activeService];
                if (!creative) throw new Error(`Datos no encontrados para ${activeService}`);

                const isVertical = activeFormat === 'vertical';
                const width = 1080;
                const height = isVertical ? 1920 : 1080;

                downloadCanvas.width = width;
                downloadCanvas.height = height;
                const ctx = downloadCanvas.getContext('2d');
                ctx.clearRect(0, 0, width, height);

                const bgColor = getBgColor();
                const textColor = getTextColor(bgColor);
                const accentColor = getAccentColor(bgColor);

                // 1. Fondo
                ctx.fillStyle = bgColor;
                ctx.fillRect(0, 0, width, height);

                // 2. Acento lateral
                ctx.fillStyle = accentColor;
                const accentWidth = isVertical ? 20 : 15;
                const accentHeightRatio = isVertical ? 0.4 : 0.3;
                const accentYRatio = isVertical ? 0.3 : 0.35;
                ctx.fillRect(0, height * accentYRatio, accentWidth, height * accentHeightRatio);

                // 3. Logo
                const logoFontSize = isVertical ? 42 : 36;
                ctx.font = `bold ${logoFontSize}px Montserrat, sans-serif`; // --- MODIFICADO: Usa fuente cargada ---
                ctx.textAlign = 'left';
                const logoX = 40;
                const logoY = 60;
                if (activeColor === 'white') {
                    ctx.fillStyle = colors.dark;
                    ctx.fillText('Orange', logoX, logoY);
                    const orangeWidth = ctx.measureText('Orange ').width;
                    ctx.fillStyle = colors.primary;
                    ctx.fillText('Vapor', logoX + orangeWidth, logoY);
                } else if (activeColor === 'orange') {
                    ctx.fillStyle = colors.light;
                    ctx.fillText('Orange Vapor', logoX, logoY);
                } else {
                    ctx.fillStyle = textColor;
                    ctx.fillText('Orange', logoX, logoY);
                    const orangeWidth = ctx.measureText('Orange ').width;
                    ctx.fillStyle = colors.primary;
                    ctx.fillText('Vapor', logoX + orangeWidth, logoY);
                }

                // 4. Textos
                ctx.textAlign = 'center';
                const contentStartY = logoY + 80; // Y donde empieza el contenido principal
                // Calcular el centro vertical del área disponible para texto
                const availableHeightForText = height - contentStartY - 40; // Deja un margen inferior
                const contentCenterY = contentStartY + availableHeightForText / 2;
                const textMaxWidth = width - 100; // Ancho máximo del texto

                // Título
                const titleFontSize = isVertical ? 80 : 70;
                ctx.font = `bold ${titleFontSize}px Montserrat, sans-serif`; // --- MODIFICADO: Usa fuente cargada ---
                ctx.fillStyle = textColor;
                const titleLineHeight = titleFontSize * 1.1;
                // Ajustar Y inicial para centrar bloque de texto
                const titleLines = calculateWrappedLines(ctx, creative.title, textMaxWidth);
                const subtitleFontSize = isVertical ? 56 : 46;
                const descFontSize = isVertical ? 42 : 36;
                const descLineHeight = descFontSize * 1.2;
                const descLines = calculateWrappedLines(ctx, creative.description, textMaxWidth);
                const totalTextHeight = (titleLines * titleLineHeight) + subtitleFontSize + (isVertical ? 80 : 70) + (descLines * descLineHeight);
                const titleStartY = contentCenterY - (totalTextHeight / 2);

                wrapText(ctx, creative.title, width / 2, titleStartY, textMaxWidth, titleLineHeight);

                // Subtítulo
                const subtitleY = titleStartY + (titleLines * titleLineHeight) + (isVertical ? 20 : 30);
                ctx.font = `bold ${subtitleFontSize}px Montserrat, sans-serif`; // --- MODIFICADO: Usa fuente cargada ---
                ctx.fillStyle = textColor;
                ctx.fillText(creative.subtitle, width / 2, subtitleY);

                // Descripción
                const descY = subtitleY + subtitleFontSize + (isVertical ? 60 : 50);
                ctx.font = `${descFontSize}px Montserrat, sans-serif`; // --- MODIFICADO: Usa fuente cargada ---
                ctx.fillStyle = textColor;
                wrapText(ctx, creative.description, width / 2, descY, textMaxWidth, descLineHeight);

                // 5. Ribbon
                const ribbonText = ribbonData[activeService];
                if (ribbonText) {
                    ctx.save();
                    ctx.translate(width, 0);
                    ctx.rotate(45 * Math.PI / 180);

                    const ribbonBgColor = '#FFD700';
                    const ribbonTextColor = '#333';
                    const ribbonHeight = isVertical ? 50 : 45; // Ligeramente más alto
                    const ribbonWidth = isVertical ? 280 : 230; // Ligeramente más ancho
                    // --- NUEVO: Coordenadas de offset para ajustar posición ---
                    const ribbonXOffset = isVertical ? 40 : 35; // Empuja más a la derecha (en el sistema rotado)
                    const ribbonYOffset = isVertical ? 40 : 35; // Empuja más hacia abajo (en el sistema rotado)

                    // Opcional: Añadir sombra al ribbon (si se desea)
                    // ctx.shadowColor = 'rgba(0, 0, 0, 0.2)';
                    // ctx.shadowBlur = 5;
                    // ctx.shadowOffsetX = 2;
                    // ctx.shadowOffsetY = 2;

                    ctx.fillStyle = ribbonBgColor;
                    ctx.fillRect(ribbonXOffset, -ribbonHeight / 2 + ribbonYOffset, ribbonWidth, ribbonHeight);

                    // Resetear sombra antes de dibujar texto si se activó
                    // ctx.shadowColor = 'transparent';
                    // ctx.shadowBlur = 0; ctx.shadowOffsetX = 0; ctx.shadowOffsetY = 0;

                    ctx.fillStyle = ribbonTextColor;
                    const ribbonFontSize = isVertical ? 22 : 18;
                    ctx.font = `bold ${ribbonFontSize}px Montserrat, sans-serif`; // --- MODIFICADO: Usa fuente cargada ---
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(ribbonText, ribbonXOffset + ribbonWidth / 2, ribbonYOffset); // Centro Y simplificado

                    ctx.restore();
                }

                // 6. Descargar
                console.log("Generando Data URL...");
                const dataUrl = downloadCanvas.toDataURL('image/png');
                const link = document.createElement('a');
                link.href = dataUrl;
                link.download = `trafico-ads-${activeService}-${activeColor}-${activeFormat}.png`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                console.log("Descarga iniciada.");

            } catch (error) { // --- NUEVO: Catch para errores (carga de fuente o dibujo) ---
                console.error('Error al generar/descargar la imagen:', error);
                alert(`Hubo un error al generar la imagen: ${error.message}. Por favor, intentá de nuevo.`);
            } finally { // --- NUEVO: Finally para asegurar limpieza ---
                hideLoadingModal();
                isProcessing = false;
                console.log("Proceso finalizado.");
            }
        }
        // --- FIN FUNCIÓN MODIFICADA ---

        function wrapText(ctx, text, x, y, maxWidth, lineHeight) {
            const words = text.split(/[\s\n]+/); // Split por espacios O saltos de línea
            let line = '';
            let currentY = y;
            for (let n = 0; n < words.length; n++) {
                // Si la palabra contiene un salto de línea explícito (\n), forzar salto
                if (words[n].includes('\n')) {
                     const parts = words[n].split('\n');
                     // Dibuja la parte antes del \n si existe
                     let testLineBeforeBreak = line + parts[0] + ' ';
                     if (ctx.measureText(testLineBeforeBreak).width <= maxWidth || line === '') {
                         line = testLineBeforeBreak;
                     } else {
                         ctx.fillText(line.trim(), x, currentY);
                         line = parts[0] + ' ';
                     }
                     ctx.fillText(line.trim(), x, currentY); // Dibuja la línea actual
                     currentY += lineHeight; // Salto de línea
                     line = parts[1] ? parts[1] + ' ' : ''; // Empieza nueva línea con la parte después del \n
                     if (!parts[1] && n === words.length -1) return; // Si era la última palabra y solo \n, no añadir línea extra
                     if (!parts[1]) continue; // Si solo había \n al final, procesar siguiente palabra
                }

                // Lógica normal de word wrap
                const testLine = line + words[n] + ' ';
                const metrics = ctx.measureText(testLine);
                const testWidth = metrics.width;
                if (testWidth > maxWidth && n > 0 && line !== '') { // Asegurarse que line no está vacía
                    ctx.fillText(line.trim(), x, currentY);
                    line = words[n] + ' ';
                    currentY += lineHeight;
                } else {
                    line = testLine;
                }
            }
             if (line.trim() !== '') { // Dibuja la última línea si no está vacía
                 ctx.fillText(line.trim(), x, currentY);
             }
        }


         function calculateWrappedLines(ctx, text, maxWidth) {
             const words = text.split(/[\s\n]+/); // Split por espacios O saltos de línea
             let line = '';
             let lines = 1;
             for (let n = 0; n < words.length; n++) {
                 // Manejar saltos de línea explícitos
                 if (words[n].includes('\n')) {
                     const parts = words[n].split('\n');
                     let testLineBeforeBreak = line + parts[0] + ' ';
                     // Si la parte antes del \n cabe, añadirla a la línea actual, si no, cuenta como una línea adicional
                     if (ctx.measureText(testLineBeforeBreak).width > maxWidth && line !== '') {
                         lines++; // La línea anterior cuenta
                         line = parts[0] + ' '; // Esta parte empieza una nueva línea
                     } else {
                        line = testLineBeforeBreak; // Añadir a la línea actual
                     }
                     lines++; // El \n siempre añade una línea
                     line = parts[1] ? parts[1] + ' ' : ''; // Resetear línea con la parte después del \n
                     if (!parts[1]) line = ''; // Si solo era \n al final, resetear
                     continue; // Ir a la siguiente palabra
                 }

                 // Lógica normal de word wrap
                 const testLine = line + words[n] + ' ';
                 const metrics = ctx.measureText(testLine);
                 const testWidth = metrics.width;
                 if (testWidth > maxWidth && n > 0 && line !== '') {
                     lines++;
                     line = words[n] + ' ';
                 } else {
                     line = testLine;
                 }
             }
             // Si la última palabra tenía un \n al final y no texto después, lines ya se incrementó.
             // Si no, y quedó texto en 'line', no se ha contado esa última línea aún.
             // PERO la lógica de arriba ya cuenta la línea CUANDO SE SUPERA el maxWidth O hay un \n.
             // El 'lines = 1' inicial cuenta la primera línea.
             // Creo que la lógica actual podría ser suficiente o incluso contar de más con los \n.
             // Simplifiquemos: contar los \n y añadir el wrap normal.
             const explicitBreaks = (text.match(/\n/g) || []).length;
             lines = 1 + explicitBreaks; // Empieza con 1 línea + saltos explícitos
             line = '';
             const wordsForWrap = text.replace(/\n/g, ' ').split(/\s+/); // Quita \n para wrap normal
             for (let n = 0; n < wordsForWrap.length; n++) {
                 const testLine = line + wordsForWrap[n] + ' ';
                 const metrics = ctx.measureText(testLine);
                 const testWidth = metrics.width;
                 if (testWidth > maxWidth && n > 0 && line !== '') {
                     lines++;
                     line = wordsForWrap[n] + ' ';
                 } else {
                     line = testLine;
                 }
             }

             // Corrección: La lógica anterior es compleja. Volvamos a una versión más simple y probada.
             // Esta versión recalcula desde cero cómo wrapText lo haría.
             lines = 0;
             line = '';
             let currentY = 0; // Dummy Y
             const lineHeight = 10; // Dummy lineHeight
             const wordsRecalc = text.split(/[\s\n]+/);
             let firstWord = true; // Flag para la primera palabra/línea

             for (let n = 0; n < wordsRecalc.length; n++) {
                if (firstWord) {
                    lines++; // Siempre hay al menos una línea
                    firstWord = false;
                }
                 const testLine = line + wordsRecalc[n] + ' ';
                 const metrics = ctx.measureText(testLine);
                 const testWidth = metrics.width;
                 if (testWidth > maxWidth && n > 0 && line !== '') {
                     lines++; // Se necesita una nueva línea
                     line = wordsRecalc[n] + ' ';
                 } else {
                     line = testLine;
                 }
             }
              // Considerar saltos de línea explícitos aparte
              lines += (text.match(/\n/g) || []).length;

             return lines || 1; // Devolver al menos 1
         }


        function updateUI() {
            serviceTitle.textContent = getServiceTitle(activeService);
            tabButtons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.service === activeService) { btn.classList.add('active'); }
            });
            formatButtons.forEach(btn => btn.classList.remove('active'));
            if (activeFormat === 'square') { squareBtn.classList.add('active'); } else { verticalBtn.classList.add('active'); }
            colorButtons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.color === activeColor) { btn.classList.add('active'); }
            });
            renderCreative();
        }

        tabButtons.forEach(btn => btn.addEventListener('click', () => { activeService = btn.dataset.service; updateUI(); }));
        squareBtn.addEventListener('click', () => { activeFormat = 'square'; updateUI(); });
        verticalBtn.addEventListener('click', () => { activeFormat = 'vertical'; updateUI(); });
        colorButtons.forEach(btn => btn.addEventListener('click', () => { activeColor = btn.dataset.color; updateUI(); }));
        downloadBtn.addEventListener('click', generateAndDownloadImage); // --- MODIFICADO: Llama a la nueva función async ---

        // Inicializar
        updateUI();
    </script>
</body>
</html>
